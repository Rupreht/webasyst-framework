var WaLoginAbstractForm=function(s){var r=function(){},o=(r.className="WaLoginAbstractForm",r.def=function(t,e){for(var r=0,o=arguments.length;r<o;r++)if(void 0!==arguments[r])return arguments[r]},r.def);return r.inherit=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t},r.prototype.init=function(t){var e=this;e.initVars(t),e.initSubmit(),e.initErrorsAutoCleaner(),e.showErrors(e.errors),e.setFocus(),e.initCaptcha()},r.prototype.initVars=function(t){var e=this;e.$wrapper=o(e.$wrapper,(t=t||{}).$wrapper,s()),e.$form||(e.$form=e.$wrapper.find(".js-wa-form-item"),e.$form.length||(e.$form=e.$wrapper.find("form")),e.$form.length)||(e.$form=s()),e.namespace=o(e.namespace,t.namespace,""),e.$templates=o(e.$templates,t.$templates,{}),e.$templates=s.extend({error_msg:s('<em class="wa-error-msg"></em>'),info_msg:s('<div class="wa-info-msg"></div>')},e.$templates),e.classes=o(e.classes,t.classes,{}),e.classes=s.extend({error_input:"wa-error",error_msg:"wa-error-msg",uncaught_errors:"wa-uncaught-errors",messages:"wa-info-messages",messages_wrapper:"wa-info-messages-wrapper",message_msg:"wa-info-msg",field:"field"},e.classes),e.errors=o(e.errors,t.errors,{}),e.locale=o(e.locale,t.locale,{}),e.js_validate=o(e.js_validate,t.js_validate,!0),e.is_json_mode=o(e.is_json_mode,t.is_json_mode),e.className=o(e.className,r.className),e.$captcha=o(e.$captcha,e.$wrapper.find(".wa-captcha-field")),e.need_redirects=void 0===t.need_redirects||!!t.need_redirects,e.env="",e.form_type=""},r.prototype.getFormItem=function(){return this.$form},r.prototype.getFormAction=function(){var t=this;return t.$form.is("form")?t.$form.attr("action"):t.$form.data("action")},r.prototype.getSerializedFormData=function(){var t=this.getFormItem();return(t.is("form")?t:(t.find("[data-turn-off=1]").find(":input").attr("disabled",!0),t.find(":input:not(:disabled)"))).serializeArray()},r.prototype.beforeSubmit=function(){this.getFormItem().find('[name="_csrf"]').val(function(){var t=document.cookie.match(new RegExp("(?:^|; )_csrf=([^;]*)"));return t&&t[1]?decodeURIComponent(t[1]):""})},r.prototype.setFocus=function(){},r.prototype.triggerEvent=function(t){var e=this,r={env:e.env,form_type:e.form_type,form_wrapper_id:e.$wrapper.attr("id")},o=(o=Array.prototype.slice.call(arguments)).slice(1);e.$wrapper.trigger(t,o.concat([r]))},r.prototype.initCaptcha=function(){var r=this,t=r.$wrapper;t.find(".wa-captcha-field").length?(s(window).one("wa_recaptcha_loaded wa_captcha_loaded wa_smartcaptcha_loaded",function(){r.triggerEvent("wa_auth_form_loaded"),r.triggerEvent("wa_auth_form_change_view"),r.captchaInitialized=!0,r.processPendingSubmit()}),t.find(".wa-captcha-field").find('[name="g-recaptcha-response"]').length&&new MutationObserver(t=>{for(var e of t)"attributes"===e.type&&"value"===e.attributeName&&(r.captchaInitialized=!0,r.processPendingSubmit())}).observe(t.find(".wa-captcha-field").find('[name="g-recaptcha-response"]')[0],{attributes:!0})):(r.triggerEvent("wa_auth_form_loaded"),r.captchaInitialized=!0,r.processPendingSubmit())},r.prototype.turnOffBlock=function(t){var o=this;t.data("turnOff",1).attr("data-turn-off",1).hide(),t.find(":input").attr("disabled",!0),t.find("[type=button],:submit").each(function(){var t=s(this),e=s('<div class="wa-js-old-button-place"></div>'),r=s('<div class="wa-js-new-button-place"></div>');t.after(e),e.data("button",t),r.hide(),o.getFormItem().append(r),r.html(t)}),o.triggerEvent("wa_auth_form_change_view")},r.prototype.turnOnBlock=function(t){t.find(".wa-js-old-button-place").each(function(){var t=s(this),e=t.data("button"),r=e.parent();t.after(e),t.remove(),r.remove()}),t.data("turnOff","").attr("data-turn-off","").show(),t.find(":input").attr("disabled",!1),this.triggerEvent("wa_auth_form_change_view")},r.prototype.isJsonMode=function(){return this.is_json_mode},r.prototype.formatInfoMessage=function(t,e,r){e=void 0===e||e;var o=this.$templates.info_msg.clone();return void 0!==r&&o.data("name",r).attr("data-name",r),e?o.text(s.trim(""+t)):o.html(s.trim(""+t))},r.prototype.getInfoMessages=function(t){var e=this.$wrapper,r="."+this.classes.message_msg;return t&&(r+='[data-name="'+t+'"]'),e.find(r)},r.prototype.clearInfoMessages=function(t){this.getInfoMessages(t).remove(),this.triggerEvent("wa_auth_form_change_view")},r.prototype.showInfoMessages=function(t){var n=this,a=n.$wrapper.find("."+n.classes.messages);s.each(t||{},function(r,t){var e=n.getFormInput(r),o=[];s.each((t="string"==typeof t?[t]:t)||[],function(t,e){e=n.formatInfoMessage(e,!1,r);e.data("code",t).attr("data-code",t),o.push(e)}),e.length?e.after(o):a.show().append(o)}),n.triggerEvent("wa_auth_form_change_view")},r.prototype.clearErrors=function(t){var e=this,r=e.$wrapper,o=r.find("."+e.classes.error_input),n=!1,o=(o.removeClass(e.classes.error_input),n=n||0<o.length,r.find("."+e.classes.error_msg));t||(o=o.not("[data-not-clear=1]")),n=n||0<o.length,o.each(function(){var t=s(this);"timeout"===t.data("name")&&t.data("timer")&&t.data("timer")&&"function"==typeof t.data("timer").finish&&t.data("timer").finish()}),o.remove(),r.find("."+e.classes.uncaught_errors).find("."+e.classes.error_msg).length<=0&&(r.find("."+e.classes.uncaught_errors).hide(),n=!0),n&&e.triggerEvent("wa_auth_form_change_view")},r.prototype.getErrorTemplate=function(t,e,r){return this.$templates.error_msg},r.prototype.escape=function(t){var e=s("<div>");return e.text(s.trim(""+t)),t=e.text(),e.remove(),t},r.prototype.prepareErrorText=function(t,e,r){return this.escape(e)},r.prototype.prepareErrorItem=function(t,e,r){var o=this.getErrorTemplate(t,e,r).clone().clone();return o.data("name",t).data("code",r).attr("data-name",t).attr("data-code",r),o.html(this.prepareErrorText(t,e,r)),o},r.prototype.showInputError=function(t,e){t=this.getFormInput(t);return!!t.length&&(t.parent().append(e),t.addClass(this.classes.error_input),!0)},r.prototype.getFormInput=function(t){var e=this.getFormItem(),t=this.buildFormInputName(t);return e.find('[name="'+t+'"]')},r.prototype.buildFormInputName=function(t){var e=this.namespace;return e?e+"["+t+"]":t},r.prototype.getFormField=function(t){return this.$wrapper.find("."+this.classes.field+'[data-field-id="'+t+'"]')},r.prototype.getInfoMessageItem=function(t,e){t=this.$wrapper.find("."+this.classes.message_msg+'[data-name="'+t+'"]');return void 0!==e?t.filter('[data-code="'+e+'"]'):t},r.prototype.getErrorItem=function(t,e){t=this.$wrapper.find("."+this.classes.error_msg+'[data-name="'+t+'"]');return void 0!==e?t.filter('[data-code="'+e+'"]'):t},r.prototype.showUncaughtErrors=function(t,e,r){var o=this.$wrapper.find("."+this.classes.uncaught_errors);return!!o.length&&(o.show(),r&&o.html(""),o.show().append(e),!0)},r.prototype.afterShowErrors=function(){},r.prototype.showErrors=function(t){var r=this;s.each(t||{},function(t,e){e=r.prepareErrorItems(t,e="string"==typeof e?[e]:e);r.showInputError(t,e)||r.showUncaughtErrors(t,e,!0)||!console||!console.error||s.each(e,function(){var t="Uncaught validate error: "+s(this).text();console.error(t)})}),r.afterShowErrors(),r.triggerEvent("wa_auth_form_change_view")},r.prototype.initSubmit=function(){function r(t){(t=e.onSubmit(t))&&(n&&n.abort(),n=t)}var e=this,o=e.getFormItem(),n=null;o.is("form")?o.submit(function(t){r(t)}):(o.on("click",":submit,button",function(t){var e=s(this);e.is(":disabled")||e.data("ignore")||(t.preventDefault(),r(t))}),o.on("keydown","input",function(t){13==t.keyCode&&(t.preventDefault(),o.find(":submit,button").not(":disabled").filter(":first").trigger("click"))}))},r.prototype.validate=function(){return{}},r.prototype.initErrorsAutoCleaner=function(){var n=this,t=n.getFormItem(),a={},e=":text:not([name="+n.buildFormInputName("captcha")+"]),:password";t.find(e).each(function(){var t=s(this),e=t.attr("name"),t=t.val();a[e]={val:s.trim(t||""),timer:null}}),t.on("keydown",e,function(t){var e,r,o;13!=t.keyCode&&(t=(e=s(this)).attr("name"),r=a[t]||{},o=s.trim(r.val||""),(t=r.timer||null)&&clearTimeout(t),r.timer=setTimeout(function(){var t=s.trim(e.val()||"");t!==o&&n.clearErrors(),r.val=t},300))}),t.on("change",":input",function(){var t=s(this),e=t.attr("name"),e=a[e]||{},r=s.trim(e.val||""),t=s.trim(t.val()||"");t!==r&&n.clearErrors(),e.val=t})},r.prototype.onDoneSubmitHandlers=function(){var r=this;return{errors:function(t,e){return r.showErrors(t),!0},redirect:function(t){return-1!==(t=t||"").indexOf("#")&&t===window.location.href?window.location.reload():window.location.href=t,!0},messages:function(t){return r.showInfoMessages(t),!0},rest:function(t){return!0}}},r.prototype.onDoneSubmit=function(t){var e=this.onDoneSubmitHandlers(),r=t&&"ok"===t.status,o=(t&&t.data||{}).messages||{},n=t&&t.errors||{};if(r||!e.errors||!e.errors(n,t)){if(this.isRedirectResponse(t)){r=this.getRedirectUrl(t);if(e.redirect&&e.redirect(r,t))return}!s.isEmptyObject(o)&&(e.messages&&e.messages(o,t))||e.rest&&e.rest(t)}},r.prototype.submit=function(t){t=t||{};var e=this;if(e.beforeSubmit(),e.clearErrors(!0),e.js_validate){var r=e.validate();if(!s.isEmptyObject(r))return void e.showErrors(r)}var r=e.getFormItem(),o=t.$button||r.find(":submit"),n=t.$loading||r.find(".wa-loading"),r=t.url||e.getFormAction(),a=e.getSerializedFormData();if(n.show(),o.attr("disabled",!0),e.captchaInitialized)return e.jsonPost(r,a).done(function(t){e.isRedirectResponse(t)||(o.attr("disabled",!1),n.hide()),e.onDoneSubmit(t)}).fail(function(){o.attr("disabled",!1)});e.pendingSubmit=function(){e.submit(t)}},r.prototype.processPendingSubmit=function(){this.pendingSubmit&&(this.pendingSubmit(),this.pendingSubmit=null)},r.prototype.onSubmit=function(t){if(this.isJsonMode())return t.preventDefault(),this.submit()},r.prototype.mixinVarsInData=function(t,r){return s.isPlainObject(r)?r=s.extend(r,t):s.isArray(r)?s.each(t,function(t,e){r.push({name:t,value:e})}):r&&s.each(t,function(t,e){r+="&"+t+"="+e}),r},r.prototype.beforeJsonPost=function(t,e){var r={wa_json_mode:1,need_redirects:this.need_redirects?1:0};return e=this.mixinVarsInData(r,e)},r.prototype.isRedirectResponse=function(t){return null!==this.getRedirectUrl(t)},r.prototype.getRedirectUrl=function(t){t=t&&"ok"===t.status&&t.data&&t.data.redirect_url;return"string"==typeof t?t:null},r.prototype.jsonPost=function(t,e){var r=this;return e=r.beforeJsonPost(t,e),s.post(t,e,"json").always(function(t){r.isRedirectResponse(t)||s(".wa-captcha-refresh").trigger("click")})},r.prototype.beforeErrorTimerStart=function(t,e,r){},r.prototype.afterErrorTimerFinish=function(t,e,r){},r.prototype.prepareTimeoutErrorItem=function(t,e,r){var o=this,n=o.prepareErrorItem("timeout",t);return r=r||{},o.beforeErrorTimerStart(t,e,r),n.data("notClear",1).attr("data-not-clear",1),o.runTimeoutMessage(n,{timeout:e,onFinish:function(){n.remove(),o.afterErrorTimerFinish(t,e,r)}}),n},r.prototype.prepareErrorItems=function(r,t){var e,o,n=this,a=[];return"timeout"===r?(e=t.message,o=t.timeout,a=[n.prepareTimeoutErrorItem(e,o,{error_namespace:r})]):s.each(t||[],function(t,e){e="timeout"===t?n.prepareTimeoutErrorItem(e.message,e.timeout,{error_namespace:r,error_code:t}):n.prepareErrorItem(r,e,t);a.push(e)}),a},r.prototype.runTimeoutMessage=function(o,t){var n,a=t.timeout,e=s.trim(o.html()),r=t.onFinish,i=null,a=parseInt(a,10);if(a=!isNaN(a)&&0<a?a:60,r="function"==typeof r?r:null,e.match(/\d+:\d/))return this.triggerEvent("wa_auth_form_change_view"),n=function(){i&&clearInterval(i),o.remove(),r&&r()},i=setInterval(function(){var t,e,r;--a<=0?n():(r=o.html(),t=parseInt(a/60,10),e=a%60,r=r.replace(/\d+:\d+/,(t<=9?"0"+t:t)+":"+(e<=9?"0"+e:e)),o.html(r))},1e3),o.data("timer",t={finish:n}),t},r}(jQuery),WaLoginAbstractForgotPasswordForm=function(a){var r=WaLoginAbstractForgotPasswordForm=function(){},i=(r.className="WaLoginAbstractForgotPasswordForm",WaLoginAbstractForm),o=WaLoginAbstractForm.def;return WaLoginAbstractForm.inherit(r,i),r.prototype.init=function(t){i.prototype.init.call(this,t)},r.prototype.initVars=function(t){var e=this;e.classes=o(e.classes,{}),e.classes=a.extend({hide_wrapper:"wa-hide-wrapper"},e.classes),e.timeout=o(e.timeout,0),e.timeout=isNaN(e.timeout)||e.timeout<=0?60:e.timeout,e.login_url=o(e.login_url,""),e.className=o(e.className,r.className),i.prototype.initVars.call(e,t),e.form_type="forgotpassword"},r.prototype.showErrors=function(t){i.prototype.showErrors.call(this,t)},r.prototype.onDoneSubmitHandlers=function(){var e=this,t=i.prototype.onDoneSubmitHandlers.call(e);return t.messages=function(t){return e.showSentMessages(t)||e.showInfoMessages(t),!0},t},r.prototype.keysCount=function(t){var e;return t=t||{},Object.keys?Object.keys(t).length:(e=0,a.each(t,function(){e++}),e)},r.prototype.makeDiv=function(t){return a("<div>").addClass(t)},r.prototype.makeA=function(t,e){return a("<a>").attr("href",t).html(e)},r.prototype.showSentMessages=function(t){var e=this,r=e.keysCount(t);if(!t.sent||1!==r)return!1;e.showInfoMessages(t);var r=e.$wrapper,t=r.find("."+e.classes.messages),o=e.makeDiv(e.classes.messages_wrapper),n=e.makeDiv(e.classes.hide_wrapper),a=r.children();return r.append(o),r.append(n.hide()),n.append(a),o.append(t),o.append(e.makeA(e.login_url,e.locale.login_page)),!0},r.prototype.validate=function(){var o=this,t=o.getSerializedFormData(),n={};return a.each(t,function(t,e){var r=e.name,e=a.trim(e.value||"");r!==o.buildFormInputName("login")||e?r!==o.buildFormInputName("captcha")||e?r!==o.buildFormInputName("confirmation_code")||e||(n.confirmation_code=[o.locale.confirmation_code_required||o.locale.required||""]):n.captcha=[o.locale.captcha_required||o.locale.required||""]:n.login=[o.locale.login_required||o.locale.required||""]}),n},r.prototype.prepareErrorItem=function(t,e,r){var o,n,a=i.prototype.prepareErrorItem.apply(this,arguments);return"confirmation_code"===t&&"out_of_tries"===r&&(o=this.getFormInput("confirmation_code"),n=this.getFormItem(),o.attr("readonly",!0),n.find(".wa-confirmation-code-input-submit").attr("disabled",!0)),a},r}(jQuery),WaFrontendForgotPassword=function(n){var e=function(t){this.init(t)},s=(e.className="WaFrontendForgotPassword",WaLoginAbstractForgotPasswordForm);return WaLoginAbstractForm.inherit(e,s),e.prototype.initVars=function(t){this.className=e.className,this.classes={field:"wa-field"},s.prototype.initVars.call(this,t),this.env="frontend"},e.prototype.init=function(t){function e(){r.turnOffBlock(r.getFormField("confirmation_code")),r.$wrapper.find("."+r.classes.message_msg).hide(),r.getFormInput("login").removeAttr("readonly"),r.turnOnBlock(r.$wrapper.find(".wa-forgotpassword-button")),r.$wrapper.find(".wa-edit-login-link-wrapper").hide(),r.$wrapper.find(".wa-send-again-confirmation-code-link-wrapper").hide()}var r=this,o=(s.prototype.init.call(r,t),e(),r.$wrapper.find(".wa-edit-login-link-wrapper").click(function(){e()}),r.$wrapper.find(".wa-confirmation-code-input-submit").click(function(t){t.preventDefault(),r.submit({$button:n(this),$loading:r.$wrapper.find(".wa-confirmation-code-input-submit-loading")})}),r.$wrapper.find(".wa-send-again-confirmation-code-link"));o.click(function(t){t.preventDefault(),r.getFormInput("confirmation_code").attr("disabled",!0),r.submit({$button:o,$loading:r.$wrapper.find(".wa-send-again-confirmation-code-link-loading")}),r.getFormInput("confirmation_code").attr("disabled",!1)})},e.prototype.onDoneSubmitHandlers=function(){var a=this,t=s.prototype.onDoneSubmitHandlers.call(a),i=function(t){a.$wrapper.find("."+a.classes.message_msg).html(""),a.showInfoMessages({sent:t.data.sent_message})};return t.rest=function(t){var e,r,o,n;!0===t.data.generated_password_sent?a.triggerEvent("wa_auth_resent_password"):t.data.code_confirmed?a.triggerEvent("wa_auth_set_password",[t.data.hash||""]):"sms"===t.data.channel_type?(e=t,r=a.getFormField("confirmation_code"),a.getFormInput("confirmation_code").removeAttr("readonly"),a.turnOnBlock(r),a.getFormInput("confirmation_code").val(""),a.turnOffBlock(a.$wrapper.find(".wa-forgotpassword-button")),i(e),r=a.formatInfoMessage(e.data.timeout_message,!1),a.$wrapper.find(".wa-confirmation-code-input-message").html(r),a.getFormInput("login").attr("readonly",1),o=a.$wrapper.find(".wa-edit-login-link-wrapper").hide(),n=a.$wrapper.find(".wa-send-again-confirmation-code-link-wrapper").hide(),a.runTimeoutMessage(r,{timeout:e.data.timeout,onFinish:function(){o.show(),n.show()}})):"email"===t.data.channel_type&&(i(t),a.$wrapper.find(".js-forgotpassword-form-fields").remove(),a.$wrapper.find(".js-forgotpassword-form-actions").remove())},t},e}(jQuery);
//# sourceMappingURL=forgotpassword-frontend-form.min.js.map
