var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.findInternal=function(a,b,f){a instanceof String&&(a=String(a));for(var l=a.length,h=0;h<l;h++){var d=a[h];if(b.call(f,d,h,a))return{i:h,v:d}}return{i:-1,v:void 0}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,f){if(a==Array.prototype||a==Object.prototype)return a;a[b]=f.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var f=a[b];if(f&&f.Math==Math)return f}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var f=$jscomp.propertyToPolyfillSymbol[b];if(null==f)return a[b];f=a[f];return void 0!==f?f:a[b]};
$jscomp.polyfill=function(a,b,f,l){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,f,l):$jscomp.polyfillUnisolated(a,b,f,l))};$jscomp.polyfillUnisolated=function(a,b,f,l){f=$jscomp.global;a=a.split(".");for(l=0;l<a.length-1;l++){var h=a[l];if(!(h in f))return;f=f[h]}a=a[a.length-1];l=f[a];b=b(l);b!=l&&null!=b&&$jscomp.defineProperty(f,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,f,l){var h=a.split(".");a=1===h.length;l=h[0];l=!a&&l in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var d=0;d<h.length-1;d++){var g=h[d];if(!(g in l))return;l=l[g]}h=h[h.length-1];f=$jscomp.IS_SYMBOL_NATIVE&&"es6"===f?l[h]:null;b=b(f);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,h,{configurable:!0,writable:!0,value:b}):b!==f&&(void 0===$jscomp.propertyToPolyfillSymbol[h]&&(f=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[h]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(h):$jscomp.POLYFILL_PREFIX+f+"$"+h),$jscomp.defineProperty(l,$jscomp.propertyToPolyfillSymbol[h],{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill("Array.prototype.find",function(a){return a?a:function(b,f){return $jscomp.findInternal(this,b,f).v}},"es6","es3");var NO_JQUERY={};
(function(a,b,f){if(!("console"in a)){var l=a.console={};l.log=l.warn=l.error=l.debug=function(){}}b===NO_JQUERY&&(b={fn:{},extend:function(){for(var d=arguments[0],g=1,p=arguments.length;g<p;g++){var c=arguments[g],e;for(e in c)d[e]=c[e]}return d}});b.fn.pm=function(){console.log("usage: \nto send: $.pm(options)\nto receive: $.pm.bind(type, fn, [origin])");return this};b.pm=a.pm=function(d){h.send(d)};b.pm.bind=a.pm.bind=function(d,g,p,c,e){h.bind(d,g,p,c,!0===e)};b.pm.unbind=a.pm.unbind=function(d,
g){h.unbind(d,g)};b.pm.origin=a.pm.origin=null;b.pm.poll=a.pm.poll=200;var h={send:function(d){d=b.extend({},h.defaults,d);var g=d.target;if(d.target)if(d.type){var p={data:d.data,type:d.type};d.success&&(p.callback=h._callback(d.success));d.error&&(p.errback=h._callback(d.error));"postMessage"in g&&!d.hash?(h._bind(),g.postMessage(JSON.stringify(p),d.origin||"*")):(h.hash._bind(),h.hash.send(d,p))}else console.warn("postmessage type required");else console.warn("postmessage target window required")},
bind:function(d,g,p,c,e){h._replyBind(d,g,p,c,e)},_replyBind:function(d,g,p,c,e){"postMessage"in a&&!c?h._bind():h.hash._bind();c=h.data("listeners.postmessage");c||(c={},h.data("listeners.postmessage",c));var m=c[d];m||(m=[],c[d]=m);m.push({fn:g,callback:e,origin:p||b.pm.origin})},unbind:function(d,g){var p=h.data("listeners.postmessage");if(p)if(d)if(g){var c=p[d];if(c){for(var e=[],m=0,q=c.length;m<q;m++){var n=c[m];n.fn!==g&&e.push(n)}p[d]=e}}else delete p[d];else for(m in p)delete p[m]},data:function(d,
g){return g===f?h._data[d]:h._data[d]=g},_data:{},_CHARS:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),_random:function(){for(var d=[],g=0;32>g;g++)d[g]=h._CHARS[0|32*Math.random()];return d.join("")},_callback:function(d){var g=h.data("callbacks.postmessage");g||(g={},h.data("callbacks.postmessage",g));var p=h._random();g[p]=d;return p},_bind:function(){h.data("listening.postmessage")||(a.addEventListener?a.addEventListener("message",h._dispatch,!1):a.attachEvent&&a.attachEvent("onmessage",
h._dispatch),h.data("listening.postmessage",1))},_dispatch:function(d){try{var g=JSON.parse(d.data)}catch(n){console.warn("postmessage data invalid json: ",n);return}if(g.type){var p=(h.data("callbacks.postmessage")||{})[g.type];if(p)p(g.data);else{p=(h.data("listeners.postmessage")||{})[g.type]||[];for(var c=0,e=p.length;c<e;c++){var m=function(n){g.callback&&h.send({target:d.source,data:n,type:g.callback})},q=p[c];if(q.origin&&"*"!==q.origin&&d.origin!==q.origin)console.warn("postmessage message origin mismatch",
d.origin,q.origin),g.errback&&h.send({target:d.source,data:{message:"postmessage origin mismatch",origin:[d.origin,q.origin]},type:g.errback});else try{q.callback?q.fn(g.data,m,d):m(q.fn(g.data,d))}catch(n){if(g.errback)h.send({target:d.source,data:n,type:g.errback});else throw n;}}}}else console.warn("postmessage message type required")},hash:{send:function(d,g){var p=d.target;if(d=d.url){d=h.hash._url(d);var c=h.hash._url(a.location.href);if(a==p.parent)var e="parent";else try{for(var m=0,q=parent.frames.length;m<
q;m++)if(parent.frames[m]==a){e=m;break}}catch(n){e=a.name}null==e?console.warn("postmessage windows must be direct parent/child windows and the child must be available through the parent window.frames list"):(g={"x-requested-with":"postmessage",source:{name:e,url:c},postmessage:g},e="#x-postmessage-id="+h._random(),p.location=d+e+encodeURIComponent(JSON.stringify(g)))}else console.warn("postmessage target window url is required")},_regex:/^#x\-postmessage\-id=(\w{32})/,_regex_len:50,_bind:function(){h.data("polling.postmessage")||
(setInterval(function(){var d=""+a.location.hash,g=h.hash._regex.exec(d);g&&(g=g[1],h.hash._last!==g&&(h.hash._last=g,h.hash._dispatch(d.substring(h.hash._regex_len))))},b.pm.poll||200),h.data("polling.postmessage",1))},_dispatch:function(d){if(d){try{if(d=JSON.parse(decodeURIComponent(d)),!("postmessage"===d["x-requested-with"]&&d.source&&null!=d.source.name&&d.source.url&&d.postmessage))return}catch(x){return}var g=d.postmessage,p=(h.data("callbacks.postmessage")||{})[g.type];if(p)p(g.data);else{var c=
"parent"===d.source.name?a.parent:a.frames[d.source.name];p=(h.data("listeners.postmessage")||{})[g.type]||[];for(var e=0,m=p.length;e<m;e++){var q=function(x){g.callback&&h.send({target:c,data:x,type:g.callback,hash:!0,url:d.source.url})},n=p[e];if(n.origin){var v=/https?:\/\/[^\/]*/.exec(d.source.url)[0];if("*"!==n.origin&&v!==n.origin){console.warn("postmessage message origin mismatch",v,n.origin);g.errback&&h.send({target:c,data:{message:"postmessage origin mismatch",origin:[v,n.origin]},type:g.errback,
hash:!0,url:d.source.url});continue}}try{n.callback?n.fn(g.data,q):q(n.fn(g.data))}catch(x){if(g.errback)h.send({target:c,data:x,type:g.errback,hash:!0,url:d.source.url});else throw x;}}}}},_url:function(d){return(""+d).replace(/#.*$/,"")}}};b.extend(h,{defaults:{target:null,url:null,type:null,data:null,success:null,error:null,origin:"*",hash:!1}})})(this,"undefined"===typeof jQuery?NO_JQUERY:jQuery);"JSON"in window&&window.JSON||(JSON={});
(function(){function a(e){return 10>e?"0"+e:e}function b(e){h.lastIndex=0;return h.test(e)?'"'+e.replace(h,function(m){var q=p[m];return"string"===typeof q?q:"\\u"+("0000"+m.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function f(e,m){var q=d,n=m[e];n&&"object"===typeof n&&"function"===typeof n.toJSON&&(n=n.toJSON(e));"function"===typeof c&&(n=c.call(m,e,n));switch(typeof n){case "string":return b(n);case "number":return isFinite(n)?String(n):"null";case "boolean":case "null":return String(n);
case "object":if(!n)return"null";d+=g;var v=[];if("[object Array]"===Object.prototype.toString.apply(n)){var x=n.length;for(e=0;e<x;e+=1)v[e]=f(e,n)||"null";m=0===v.length?"[]":d?"[\n"+d+v.join(",\n"+d)+"\n"+q+"]":"["+v.join(",")+"]";d=q;return m}if(c&&"object"===typeof c)for(x=c.length,e=0;e<x;e+=1){var t=c[e];"string"===typeof t&&(m=f(t,n))&&v.push(b(t)+(d?": ":":")+m)}else for(t in n)Object.hasOwnProperty.call(n,t)&&(m=f(t,n))&&v.push(b(t)+(d?": ":":")+m);m=0===v.length?"{}":d?"{\n"+d+v.join(",\n"+
d)+"\n"+q+"}":"{"+v.join(",")+"}";d=q;return m}}"function"!==typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return this.getUTCFullYear()+"-"+a(this.getUTCMonth()+1)+"-"+a(this.getUTCDate())+"T"+a(this.getUTCHours())+":"+a(this.getUTCMinutes())+":"+a(this.getUTCSeconds())+"Z"},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var l=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
h=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,d,g,p={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},c;"function"!==typeof JSON.stringify&&(JSON.stringify=function(e,m,q){var n;g=d="";if("number"===typeof q)for(n=0;n<q;n+=1)g+=" ";else"string"===typeof q&&(g=q);if((c=m)&&"function"!==typeof m&&("object"!==typeof m||"number"!==typeof m.length))throw Error("JSON.stringify");return f("",{"":e})});
"function"!==typeof JSON.parse&&(JSON.parse=function(e,m){function q(n,v){var x,t=n[v];if(t&&"object"===typeof t)for(x in t)if(Object.hasOwnProperty.call(t,x)){var y=q(t,x);void 0!==y?t[x]=y:delete t[x]}return m.call(n,v,t)}l.lastIndex=0;l.test(e)&&(e=e.replace(l,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,
"")))return e=eval("("+e+")"),"function"===typeof m?q({"":e},""):e;throw new SyntaxError("JSON.parse");})})();(function(a){a.wa_blog.editor={options:{blogs:{},content_id:"post_text",current_blog_id:null,dateMonthCount:2,dateShowWeek:!1,cut_link_label_default:"",version:"1.0"},transliterated:!1,blog_statuses:{"private":"private","public":"public"},reInit:function(){this.init(this.options)},init:function(b){function f(c){a(this).show();a(this).parent().find(".datetime").hide();c&&a("#current-time").text(c);a("#current-time").show()}function l(c){var e=c.siblings(".hint:first");0>=e.length&&(e=c.parent().siblings(".hint:first"));
return e}function h(c){c.parent().find("input[type=text]").removeClass("error");l(c).removeClass("errormsg")}function d(c){c.parent().find("input[type=text]").addClass("error");l(c).addClass("errormsg")}function g(){return a.datepicker._defaults.dateFormat.toUpperCase().replace("YY","YYYY")}var p=this;p.options=a.extend(p.options,b);p.postUrlWidget=function(){function c(r,w,z,A){var B=null,E={post_title:z,post_id:w,blog_id:r},F=[r,w].join("&");!x[F]||!v&&z?(v&&(E.slug=v),a.ajax({url:"?module=post&action=getPostUrl",
data:E,dataType:"json",type:"post",async:!1,success:function(D){B=D.data;x[F]=B;a.wa_blog.editor.transliterated=!0;A(B)}})):A(x[F])}function e(r){a("#pure-url").text(r.link);a("#preview-url").data("preview-url",r.preview_link);r.slug&&!v?(a("#post-url").val(r.slug),v=r.slug):a("#post-url").val(v);var w=r.is_adding?"small":r.is_published?"small":"hint",z=a("#post-url-field span:first").contents().filter(function(){return 3==this.nodeType}).get(0).nodeValue;if(r.other_links&&r.other_links instanceof
Array){var A=[];for(k in r.other_links)A.push({previewText:z,className:w,slug:v,link:r.other_links[k],preview_link:r.other_preview_links[k],href:r.preview_hash?r.other_links[k]+v+"/?preview="+r.preview_hash:r.other_links[k]+v+"/"});r=r.is_adding?'<span class="${className}">${previewText}${link}<span class="slug">{{if slug}}${slug}/{{/if}}</span></span><br>':'<span class="${className}">${previewText}<a target="_blank" href="${href}" data-preview-url="${preview_link}">${link}<span class="slug">{{if slug}}${slug}/{{/if}}</span></a></span><br>';
w=a("#post-url-field").children(":first");if(w.is(".fas")||w.is("[data-icon]"))r=w.get(0).outerHTML+r;a("#other-urls").html(a.tmpl(r,A))}}function m(r){r=r||"hidden";"empty"==r?a("#post-url-field-no-settlements").show("fast"):a("#post-url-field-no-settlements").hide("fast");v=null;a("#post-url").val("");a("#post-url-field").hide("fast").trigger(a.Event("change",{status:r}))}function q(r,w){r&&(v=r);a(".slug").each(function(){if(v){var z=a(this).text(v+"/").parents("a:first");z.attr("href",z.text()+
(w?"?preview="+w:""))}else a(this).text("")})}function n(){a("#url-editable").hide();a("#url-edit").show();a("#post-url").focus()}var v=null,x={},t=function(){},y={};(function(){var r=t=function(){if(a("#post-url-field").length){var w=a("#post-title").val(),z=a("input[name=blog_id]").val();if(y[z]&&y[z].no_frontend)w?m("empty"):m("hidden_empty");else{w||m("hidden");var A=a("input[name=post_id]").val();c(z,A,w,function(B){B&&(y[z]||(y[z]={id:z,no_frontend:B.is_private_blog||!B.link}),y[z].no_frontend?
w?m("empty"):m("hidden_empty"):w?(a("#post-url-field-no-settlements").hide("fast"),B&&e(B),a("#post-url-field").show("fast").trigger(a.Event("change",{status:"visible"}))):(e(B),m("hidden")))})}}else m("empty")};a("#post-title").blur(r);a("#post-form").find("input[name=post_id]").val()&&r();a("#url-edit-link").click(n);a("#post-url").keyup(function(w){9!=w.keyCode&&this.value!=v&&q(this.value)})})();return{setEditReady:n,resetEditReady:function(){a("#url-editable").show();a("#url-edit").hide()},updateSlugs:q,
changeBlog:t}}();p.inlineSaveController=function(c){function e(){!1!==x()&&m(t)}function m(y){var r=a.wa_blog.editor.wysiwygToHtml(a("#post_text","#post-form").val());a("#post_text","#post-form").val(r);r=a("#post-form").serialize()+"&"+n+"=1";r+=v?"&inline=1":"";r+=a.wa_blog.editor.transliterated?"":"&transliterate=1";a.wa_blog.editor.currentDialog&&"b-post-edit-custom-params-dialog"===a.wa_blog.editor.currentDialog.$wrapper.attr("id")&&(r+="&"+a.wa_blog.editor.currentDialog.$wrapper.find("[name]").serialize());
y=y||function(){};q("loading");a.ajax({url:"?module=post&action=save",data:r,dataType:"json",type:"post",success:function(w){if("fail"==w.status){w.errors.datetime||a.wa_blog.editor.closeCurrentDialog();var z=w.errors;if(z.url){a("#post-url-field").show();var A=a("#post-url"),B=z.url,E="#message-"+A.attr("id");A.addClass("error");a(E).addClass("errormsg").text(B)}z.datetime&&(z=a(".datepicker:not(:disabled)"),z.length&&d(z));w.errors.datetime||"deadline"!=n||((w=a("#deadline-dialog .datepicker").val())?
a("#publication-deadline-changable-part").html(a.tmpl("publication-deadline-setted",{date:w})):a("#publication-deadline-changable-part").html(a.tmpl("publication-deadline-setted")),a("#b-post-save-draft-button").attr("name","deadline"))}else w.data.redirect?location.href=w.data.redirect:(y(w.data),w.data.id&&a("#post-id").val(w.data.id),q("saved"));v=!1;q("")},error:function(w,z,A){}})}function q(y,r){y?(a("#form-status span").hide(),a("#form-status #"+y+"-status").show(),a("#form-status").show()):
a("#form-status").fadeOut(r&&"function"==typeof r?r:function(){})}c=c||{};var n="",v=!1,x=c.beforeSave||function(){},t=c.afterSave||function(){};(function(){a(document).on("click","[type=submit], input[type=button], a.js-submit",function(){function y(){!a("#post-id").val()||"b-post-save-button"!=this.id&&"b-post-save-draft-button"!=this.id&&"b-post-save-custom-params"!=this.id||(v=!0);n=this.name;"deadline"!=n&&"schedule"!=n||a("#"+this.name+"-dialog").find("input[name^=datetime]").attr("disabled",
!1);e()}if(a(this).hasClass("dialog-edit"))return!1;if(a(this).hasClass("js-submit")){var r=this,w=a(r).attr("title")||a(r).text()||"Are you sure?";a.waDialog.confirm({text:w,success_button_title:a.wa.locale.Confirm,success_button_class:"danger",cancel_button_title:a.wa.locale.Cancel,cancel_button_class:"light-gray",onSuccess:function(){y&&y.apply(r)}});return!1}y.apply(this)});a("#post-url").focus(function(){})})();return{save:e,setAction:function(y){n=y},getAction:function(){return n}}}({beforeSave:function(){var c=
a(".datepicker:not(:disabled)"),e=!0;if(0<c.length){var m=c.parent(".datetime").find(".time");if(0<m.length){var q;if(q=m.get(0))q=m.eq(0).val(),q=!(0<=q&&24>=q);q&&(e=!1);if(q=m.get(1))m=m.eq(1).val(),q=!(0<=m&&60>=m);q&&(e=!1)}e||d(c)}if(!e)return!1;a.wa_blog.editor.onSubmit()},afterSave:function(c){a("#b-post-save-button").removeClass("yellow").addClass("blue");a("#postpublish-edit").removeClass("yellow").addClass("blue");p.postUrlWidget.resetEditReady();p.postUrlWidget.updateSlugs(c.url,c.preview_hash||
!1);f.call(a("#inline-edit-datetime").get(0),c.formatted_datetime);"draft"==p.inlineSaveController.getAction()&&a("#post-url-field .small").removeClass("small").addClass("hint");var e,m=null==c?void 0:null==(e=c.meta)?void 0:e.title,q;e=null==c?void 0:null==(q=c.meta)?void 0:q.keywords;var n;q=null==c?void 0:null==(n=c.meta)?void 0:n.description;c=null==c?void 0:c.params;n=a("#b-post-edit-custom-params-dialog");n.find(":input[name=meta_description]").val(q);n.find(":input[name=params]").val(c);m?
(a("#b-post-edit-meta-title").show().find(".val").text(m),n.find(":input[name=meta_title]").val(m)):a("#b-post-edit-meta-title").hide();e?(a("#b-post-edit-meta-keywords").show().find(".val").text(e),n.find(":input[name=meta_keywords]").val(e)):a("#b-post-edit-meta-keywords").hide();q?(a("#b-post-edit-meta-description").show().find(".val").text(q),n.find(":input[name=meta_description]").val(q)):a("#b-post-edit-meta-description").hide();c?(a("#b-post-edit-custom-params").show().html(c.trim().split("\n").join("<br>")+
"<br>"),n.find(":input[name=params]").val(c)):a("#b-post-edit-custom-params").hide();m||e||q||c?a("#b-post-edit-no-meta").hide():a("#b-post-edit-no-meta").show()}});(function(c){c={changeMonth:!0,changeYear:!0,shortYearCutoff:2,showOtherMonths:2>c.dateMonthCount,selectOtherMonths:2>c.dateMonthCount,stepMonths:c.dateMonthCount,numberOfMonths:c.dateMonthCount,showWeek:c.dateShowWeek,gotoCurrent:!0,constrainInput:!1,beforeShow:function(){setTimeout(function(){10>a("#ui-datepicker-div").css("z-index")&&
a("#ui-datepicker-div").css("z-index",10)},0)}};a(".datepicker").datepicker(c).filter("input[name^=schedule_datetime]").datepicker("option","minDate",new Date);a("#ui-datepicker-div").hide();a(".datepicker").on("focus",function(){h(a(this))})})(p.options);(function(){function c(){var m=a(this).attr("id").replace(/-.*$/,""),q;(null==(q=e[m])?0:q.length)||(e[m]=a("#"+m+"-dialog").detach());a.wa_blog.editor.currentDialog=a.waDialog({$wrapper:e[m],append_to:a(this).closest("form"),onOpen:function(n){n.find("input,select").removeAttr("disabled");
a(".user-date-format").text(g())},onClose:function(n){a(this).find("input:text,select").each(function(v){a(this).value=a(this).defaultValue;a(this).attr("disabled","disabled")});if("schedule"===m)return n.hide(),!1}});return!1}var e={};a(".dialog-edit").each(function(){a(this).on("click",function(m){m.preventDefault();return c.call(m.target)})})})();b=null;try{b=localStorage.getItem("blog/editor")||"redactor",b=b.replaceAll('"',"")}catch(c){this.log("Exception: "+c.message+"\nline: "+c.fileName+":"+
c.lineNumber)}if(!b||!this.editors[b])for(b in this.editors)break;if(!this.selectEditor(b,!0))for(b in this.editors)if(this.selectEditor(b,!0))break;a("#post-form").find("input[name=post_id]").val()||a("#post-title").focus();a(".change-blog").click(a.wa_blog.editor.changeBlogHandler);a(document).on("change",'#postpublish-dialog input[name="publish_blog_id"]',a.wa_blog.editor.changePublishBlogHandler);a("#post-title").keyup(function(){var c=a(this),e=c.next(".maxlength"),m=parseInt(c.attr("maxlength"));
m&&c.val().length>=m&&!e.length?c.after('<em class="hint maxlength">'+$_("input_maxlength").replace(/%d/,m)+"</em>"):(!m||c.val().length<m)&&e.length&&e.remove()});a("#inline-edit-datetime").click(function(){a(this).hide();a(this).parent().find(".datetime").show();a("#current-time").hide();a(".user-date-format").text(g())});a(".b-post-editor-toggle li a").click(this.handleToggleEditor);a(document).keydown(function(c){if(c.ctrlKey&&83==c.keyCode)p.onSaveHotkey(c)});a(".time").focus(function(){h(a(this).parent().find(".datepicker"))});
a("#post-form").submit(function(){return!1});a("#b-post-edit-custom-params-link").on("click",function(){a.waDialog({$wrapper:a("#b-post-edit-custom-params-dialog").clone(),append_to:"#post-form",onOpen:function(c,e){a.wa_blog.editor.currentDialog=e;c.find('[type="button"]').on("click",function(){e.close();a.wa_blog.editor.currentDialog=null})}});return!1});(function(){function c(u){var C;null!=(C=t[0])&&C.contentWindow&&a.pm({target:t[0].contentWindow,type:"update_title",data:u})}function e(){var u=
q();u&&u!=t.attr("src")&&(t.attr("src",u),t.one("load",function(){}))}function m(u){return u.data("preview-url")||""}function q(){var u=null;a("#post-url-field a").each(function(){var C=m(a(this));if(C&&"javascript:"!=C.substr(0,11)){if(t.attr("src")==C)return u=null,!1;u=C}});u||(u=t.attr("src"),"about:blank"==u&&(u=null));u&&(u+=0<=u.indexOf("?")?"&":"?",u+="parent_url="+encodeURIComponent(location.origin));return u}function n(){!a("#post-url-field-no-settlements").is(":visible")&&q()?(t.show(),
A.hide(),D=!0,e()):(t.hide(),A.show(),D=!1);F.val("1");r=!0;var u=a.storage.get("blog/editor/preview_sidebar_width")||600;a(".sidebar").hide().first().width();x.closest(".content").animate({marginLeft:0},400);x.find(".content").animate({marginRight:u+"px"},400);y.css("width",0).show().animate({width:u+"px"},400);B.slideUp(400);setTimeout(function(){r=!1;a(window).resize().scroll()},410)}function v(){F.val("");var u=a(".sidebar"),C=u.first().width()-0;r=!0;var H=x.closest(".content").animate({marginLeft:C+
"px"},400),I=x.find(".content").animate({marginRight:C+"px"},400);y.hide();B.slideDown(400);setTimeout(function(){u.show();y.hide();r=!1;H.css("marginLeft","");I.css("marginRight","");a(window).resize().scroll()},410)}var x=a("#post-form"),t=a("#realtime-preview-iframe"),y=t.closest(".sidebar"),r=!1,w=a("<textarea>").hide().appendTo(y),z=a("#post-title"),A=a("#not-available-message"),B=a("#wa-header"),E=a('#blog-photo_bridge-editor [name="album_id"]'),F=y.find('[name="realtime_on"]'),D=!1,G=!1;t.one("load",
function(){G=!0});a.pm.bind("updater_loaded",function(u){G=!0});a.widget("ui.blog_draghandler",a.ui.mouse,{_init:function(){this._mouseInit();this.$content=x.find(".content")},_mouseStart:function(u){this.xStart=u.pageX;this.sidebar_width=y.width();this.window_width=a(window).width();D&&t.hide()},_mouseDrag:function(u){this.sidebar_width+=this.xStart-u.pageX;this.xStart=u.pageX;320>this.sidebar_width?this.sidebar_width=320:380>this.window_width-this.sidebar_width&&(this.sidebar_width=this.window_width-
380);y.width(this.sidebar_width);this.$content.css({marginRight:this.sidebar_width+"px"});a(window).resize()},_mouseStop:function(){D&&t.show();a.storage.set("blog/editor/preview_sidebar_width",this.sidebar_width)}});y.find(".column-resize-handler:first").blog_draghandler();a("#realtime-preview-toggle").click(function(){r||(x.hasClass("realtime-edit-mode")?(x.removeClass("realtime-edit-mode"),a(this).removeClass("b-close-live-editor"),v()):(x.addClass("realtime-edit-mode"),a(this).addClass("b-close-live-editor"),
n()))});z.keyup(function(){c(z.val())});setInterval(function(){if(G&&x.hasClass("realtime-edit-mode")){var u;(u=a("#post-form .b-post-editor-toggle li.selected a").attr("id"))&&a.wa_blog.editor.editors[u]&&a.wa_blog.editor.editors[u].update(w);c(z.val());u=w.val();E.val()&&(u=u+'<p class="attached-album-description"><em>'+$_("Photos from the attached album will be displayed here."),u+="</em></p>");a.pm({target:t[0].contentWindow,type:"update_text",data:u})}},500);a("#post-url-field").on("click","a",
function(){if(x.hasClass("realtime-edit-mode")){var u=m(a(this));u!=t.attr("src")&&(t.attr("src",u),t.one("load",function(){}));return!1}});a("#post-url-field").change(function(u){x.hasClass("realtime-edit-mode")&&("empty"!=u.status&&"hidden_empty"!=u.status?(t.show(),A.hide(),D=!0,e()):(t.hide(),A.show(),D=!1))});a(window).resize(function(){t.height(a(window).height()-30);t.width(y.width()-10)})})()},cloneTextarea:function(b,f,l){var h="editor_container_"+l;a(f).append(b.clone(!0).attr({id:h,name:"text_"+
l,disabled:!0}));b.hide();return h},cut_hr:'<span class="b-elrte-wa-split-vertical elrte-wa_post_cut">%text%</span>',cut_str:"\x3c!-- more %text%--\x3e",htmlToWysiwyg:function(b){return b.replace(/\x3c!--[\s]*?more[\s]*?(text[\s]*?=[\s]*?['"]([\s\S]*?)['"])*[\s]*?--\x3e/g,function(f,l,h){return h?a.wa_blog.editor.cut_hr.replace("%text%",h):a.wa_blog.editor.cut_hr.replace("%text%",a.wa_blog.editor.options.cut_link_label_default)})},wysiwygToHtml:function(b){var f=a("<p></p>").html(b),l=f.find(".elrte-wa_post_cut");
return l.length?((b=l.html())&&"<br>"!==b&&b!==a.wa_blog.editor.options.cut_link_label_default?l.replaceWith(a.wa_blog.editor.cut_str.replace("%text%",'text="'+b+'" ')):l.replaceWith(a.wa_blog.editor.cut_str.replace("%text%","")),f.html().replace("<span></span>","")):b},editors:{ace:{editor:null,container:null,inited:!1,init:function(b){if(!this.inited){var f=function(){"dark"===document.documentElement.dataset.theme?l.editor.setTheme("ace/theme/monokai"):l.editor.setTheme("ace/theme/eclipse")},l=
this;this.inited=!0;this.container=a('<div id="blog-ace-editor"></div>').appendTo("#post_text_wrapper");this.container.wrap('<div class="ace"></div>');this.editor=ace.edit("blog-ace-editor");ace.config.set("basePath",wa_url+"wa-content/js/ace/");f();document.documentElement.addEventListener("wa-theme-change",f);f=this.editor.getSession();f.setMode("ace/mode/javascript");f.setMode("ace/mode/css");f.setMode("ace/mode/html");f.setMode("ace/mode/smarty");f.setUseWrapMode(!0);this.editor.$blockScrolling=
Infinity;this.editor.renderer.setShowGutter(!1);this.editor.setShowPrintMargin(!1);this.editor.setFontSize(13);a(".ace_editor").css("fontFamily","");f.setValue(b.hide().val());this.editor.moveCursorTo(0,0);-1!=navigator.appVersion.indexOf("Mac")?this.editor.setFontSize(13):-1!=navigator.appVersion.indexOf("Linux")?this.editor.setFontSize(16):this.editor.setFontSize(14);this.editor.commands.addCommand({name:"unfind",bindKey:{win:"Ctrl-F",mac:"Command-F"},exec:function(g,p){return!1},readOnly:!0});
var h=a("#post-form .sidebar .b-edit-options:first").height(),d=function(g,p){var c=g.getSession().getScreenLength()*g.renderer.lineHeight+g.renderer.scrollBar.getWidth();c*=1.02;var e=h-163;c<e&&(c=e);a("#"+p).height(c.toString()+"px");g.resize()};f.on("change",function(){d(l.editor,"blog-ace-editor")});setTimeout(function(){d(l.editor,"blog-ace-editor")},50);a(window).resize(function(){l.editor.resize();d(l.editor,"blog-ace-editor")});this.container.on("keydown",a.wa_blog.editor.editorKeyCallback());
this.container.on("keypress",a.wa_blog.editor.editorKeyCallback(!0))}return!0},show:function(b){this.container.show();this.container.parent().show();if(this.editor){b=b.val();b=a.wa_blog.editor.wysiwygToHtml(b);var f=this.editor.getCursorPosition();this.editor.setValue(b);""!=a("#post-title").val()&&this.editor.focus();this.editor.navigateTo(f.row,f.column)}else"object"==typeof console&&console.log("wait for ace editor init"),this.show(b)},hide:function(){this.container.hide();this.container.parent().hide()},
update:function(b){this.inited&&b.val(this.editor.getValue())},correctEditorHeight:function(b){return Math.max(b,a.wa_blog.editor.getMinEditorHeight())+a.wa_blog.editor.getExtHeightShift()}},redactor:{options:{},inited:!1,callback:!1,editor:null,init:function(b){if(!this.inited){a(window);var f=a("#b-post-save-button"),l=a("#postpublish-edit");a("#post-form .sidebar .b-edit-options:first").height();var h=!0;""==a("#post-title").val()&&(h=!1);var d=a.extend({focus:h,deniedTags:!1,minHeight:300,linkify:!1,
source:!1,paragraphy:!1,replaceDivs:!1,toolbarFixed:!0,toolbarFixedTopOffset:a("#wa-nav").outerHeight()+a(".b-post-editor-toggle").outerHeight(),replaceTags:{b:"strong",i:"em",strike:"del"},removeNewlines:!1,removeComments:!1,imagePosition:!0,imageResizable:!0,imageFloatMargin:"1.5em",imageTypes:["image/png","image/jpeg","image/gif","image/webp"],buttons:"format bold italic underline deleted lists image video file table link alignment fontcolor fontsize fontfamily".split(" "),plugins:"fontcolor fontfamily alignment fontsize table video cut".split(" "),
lang:wa_lang,imageUpload:"?action=upload&r=2&absolute=1",imageUploadFields:b.data("uploadFields"),callbacks:{change:function(){l.is(":visible")&&l.removeClass("green").addClass("yellow");f.is(":visible")&&f.removeClass("green").addClass("yellow")}}},d||{});d.callbacks=a.extend({imageUploadError:function(g){console.log("imageUploadError",g);alert(g.error)},syncClean:function(g){return g.replace(/\{[a-z\$'"_\(!+\-][^\}]*\}/gi,function(p){return p.replace(/-&gt;/g,"->")})},syncBefore:function(g){return g=
g.replace(/{[a-z$][^}]*}/gi,function(p,c,e){var m=e.indexOf("\x3c/script",c+p.length);c=e.indexOf("<script",c+p.length);if(-1==m||-1!=c&&c<m)p=p.replace(/&gt;/g,">"),p=p.replace(/&lt;/g,"<"),p=p.replace(/&amp;/g,"&"),p=p.replace(/&quot;/g,'"');return p})}},d.callbacks||{});a.wa_blog_options.photos_bridge_available&&(d.callbacks.modalOpened=function(g,p){if("image"==g){var c=this;this.modal.width=1100;g=this.modal.getModal();var e=a('<div id="photos-image-selector-wrapper">'),m=a('<div class="redactor-modal-tab redactor-tab1" data-title="'+
$_("Select from Photos app")+'">').hide().append(e).append('<div class="clear-both">'),q=m.find(".total-photos-selected");g.append(m);this.modal.buildTabber();(function(){function n(){e.find("input:checkbox").each(function(){x[this.value]&&a(this).prop("checked",!0).change()});a(window).resize()}var v=0,x={},t=a('<button id="redactor-modal-button-action" style="margin-top: 16px;">'+c.lang.get("insert")+"</button>").hide();m.append(t);var y=a('<button id="redactor-modal-button-cancel" style="margin-top: 16px;">'+
c.lang.get("cancel")+"</button>").hide();m.append(y);a('#redactor-modal-tabber a[rel="1"]').on("click",function(){t.is(":visible")||(t.show(),y.show(),e.html('<div class="block"><i class="icon16 loading"></i></div>'),a.post("../photos/?module=photo&action=embedSelector",{app_id:"blog"},function(r){e.html(r);n()}))});y.off("click").on("click",function(){c.modal.close()});t.on("click",function(){if(0<v){var r=[];a.each(x,function(w,z){r.push('<figure><img src="'+z+'"></figure>')});c.insert.html(r.join("\n"))}c.modal.close()});
a('#redactor-modal-tabber a[rel="0"]').on("click",function(){t.hide();y.hide()});e.on("change","input:checkbox",function(){var r=a(this),w=r.val();this.checked?x[w]||(x[w]=r.data("photoUrl"),v++):x[w]&&(delete x[w],v--);0<v?q.text(v).closest(".hidden").show():q.text(v).closest(".hidden").hide()});e.on("reloaded",function(r){n()})})()}});b.redactor(d);b.redactor("core.box").css("z-index",0);b.redactor("core.toolbar").css("z-index",1);this.editor=b.data("redactor");this.inited=!0}return!0},show:function(b){var f=
a.wa_blog.editor.htmlToWysiwyg(b.val());b.val(f);a(".redactor-box").show();b.redactor("core.editor").find('img[src*="$wa_url"]').each(function(){var l=decodeURIComponent(a(this).attr("src"));a(this).attr("data-src",l);a(this).attr("src",l.replace(/\{\$wa_url\}/,wa_url))});this.editor.code.set(b.val());this.editor.observe.load();this.editor.focus.start()},hide:function(b){a(".redactor-box").hide()},update:function(b){if(this.inited){var f=this.editor.code.get();f=this.editor.clean.onSync(this.editor.clean.onSet(f));
f=a.wa_blog.editor.wysiwygToHtml(f);b.val(f)}}},photo_bridge:{container:null,inited:!1,init:function(b){if(!this.inited){this.inited=!0;b.hide();this.container=a("#blog-photo_bridge-editor");if(!this.container.length)return;var f=a("#album-frontend-link"),l=this.container.find('select[name="album_id"]'),h=this.container.find(".js-post-url"),d=0;l.change(function(){if(l.val()){var g=l.children(":selected").data("frontend-link");g?(h.slideDown(d),f.text(g)):(h.slideUp(d),h.find('[name="album_link_type"]:checkbox').prop("checked",
!1));a("#post-editor .show-when-album-selected").show()}else h.slideUp(d),a("#post-editor .show-when-album-selected").hide()}).change();d=300;b=a("#post-form .sidebar .b-edit-options:first").height();this.container.css("min-height",b-100)}return!0},show:function(b){this.container.show()},hide:function(){this.container.hide()},update:function(b){}}},getMinEditorHeight:function(){return 200},getExtHeightShift:function(){return-70},handleToggleEditor:function(b){b.preventDefault();b=a.wa_blog.editor.toggleEditor.bind(this);
var f=a.wa_blog.editor.options;f.can_use_smarty&&"redactor"===this.id?a.waDialog.confirm({title:$_("Message"),text:f.locale.switch_to_WYSIWYG,success_button_title:$_("Continue"),success_button_class:"yellow",cancel_button_title:$_("Cancel"),cancel_button_class:"light-gray",onSuccess:b}):b()},toggleEditor:function(){var b=window.scrollY,f=a(this);!f.parent().hasClass("selected")&&a.wa_blog.editor.selectEditor(f.attr("id"))&&(a(".b-post-editor-toggle li.selected").removeClass("selected"),f.parent().addClass("selected"),
window.scrollTo(0,b+1))},selectEditor:function(b,f){if(this.editors[b]){var l=a("#"+this.options.content_id);if(l.length){try{if(this.editors[b].init(l)){var h=null;if(!f)try{a.storage.set("blog/editor",b)}catch(g){this.log("Exception: "+g.message+"\nline: "+g.fileName+":"+g.lineNumber)}var d=a(".b-post-editor-toggle li.selected a");d.length&&(d.parent().removeClass("selected"),h=d.attr("id"))&&(this.editors[h].update(l),this.editors[h].hide());a("#"+b).parent().addClass("selected");this.editors[b].show(l)}}catch(g){return this.log("Exception: "+
g.message+"\nline: "+g.fileName+":"+g.lineNumber,g.stack),!1}return!0}this.log('Text container for "'+b+'" not found');return!1}this.log('Blog editor "'+b+'" not found');return!1},editor_key:!1,editorKeyCallback:function(b){var f=this;return b?function(l){if(l.ctrlKey&&115==l.which&&!a.wa_blog.editor.editor_key)f.onSaveHotkey(l)}:function(l){a.wa_blog.editor.editor_key=!1;l.ctrlKey&&83==l.which&&(a.wa_blog.editor.editor_key=!0,f.onSaveHotkey(l));l.metaKey||!((33>l.which||40<l.which)&&(27<l.which||
8==l.which||13==l.which)&&(112>l.which||124<l.which))||l.ctrlKey&&67==l.which||(a("#b-post-save-button").removeClass("green").addClass("yellow"),a("#postpublish-edit").removeClass("green").addClass("yellow"))}},onSubmit:function(){var b=a.wa_blog;for(f in b)if("editor"!=f&&b[f].onSubmit&&"function"==typeof b[f].onSubmit)try{b[f].onSubmit()}catch(h){"object"==typeof console&&console.log(h)}b=a("#"+this.options.content_id);if(b.length){var f=null;var l=a(".b-post-editor-toggle li.selected a");l.length&&
(f=l.attr("id"))&&this.editors[f].update(b)}b=a("#b-post-save-button");"draft"!=b.attr("name")&&"deadline"!=b.attr("name")&&(b.removeClass("yellow").addClass("blue"),a("#postpublish-edit").removeClass("yellow").addClass("blue"))},onSaveHotkey:function(b){b.preventDefault();b=a("#b-post-save-draft-button");var f=a("#b-post-save-button");b.length?b.click():f.length&&f.click()},currentDialog:null,closeCurrentDialog:function(){this.currentDialog&&this.currentDialog.close()},registerEditor:function(b,
f){if(this.editors[b])return this.log('Editor "'+b+'" already registered'),!1;this.editors[b]=f;return!0},log:function(b,f){"object"==typeof console&&(console.log(b),f&&console.log(f))},changeBlogHandler:function(){var b=parseInt(a(this).find("[data-id]").data("id"));a.wa_blog.editor.selectCurrentBlog(b)&&(a(".dialog :input:checked").attr("checked",!1),a(".dialog #b-post-publish-blog-"+b).attr("checked",!0))},changePublishBlogHandler:function(){if(this.checked){var b=parseInt(a(this).val());a.wa_blog.editor.selectCurrentBlog(b)}},
selectCurrentBlog:function(b){var f=a.wa_blog.editor.options.blogs[b],l=a.wa_blog.editor.options.current_blog_id;if(f&&l!=b){var h=a.tmpl("selected-blog",{blog:f});a(".current-blog").html(h);a("#blog-selector-"+l).removeClass("selected");h=a("#blog-selector-"+b).addClass("selected");l=a.wa_blog.editor.options.blogs[l];a.wa_blog.editor.options.current_blog_id=parseInt(b);b=a(".b-post");l&&b.removeClass(l.color);b.addClass(f.color);a.wa_blog.editor.postUrlWidget.changeBlog(h.attr("data-blog-status"));
return!0}}}})(jQuery);
//# sourceMappingURL=blog-post-edit.min.js.map