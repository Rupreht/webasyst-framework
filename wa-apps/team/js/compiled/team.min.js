!function(e){"object"==typeof exports&&exports&&"object"==typeof module&&module&&module.exports===exports?e(require("jquery")):"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function(y){function o(e){e=e[0];return 0<e.offsetWidth&&0<e.offsetHeight}function s(e){var t;if(e.minTime&&(e.minTime=T(e.minTime)),e.maxTime&&(e.maxTime=T(e.maxTime)),e.durationTime&&"function"!=typeof e.durationTime&&(e.durationTime=T(e.durationTime)),"now"==e.scrollDefault?e.scrollDefault=function(){return e.roundingFunction(T(new Date),e)}:e.scrollDefault&&"function"!=typeof e.scrollDefault?(t=e.scrollDefault,e.scrollDefault=function(){return e.roundingFunction(T(t),e)}):e.minTime&&(e.scrollDefault=function(){return e.roundingFunction(e.minTime,e)}),"string"===y.type(e.timeFormat)&&e.timeFormat.match(/[gh]/)&&(e._twelveHourTime=!0),!1===e.showOnFocus&&-1!=e.showOn.indexOf("focus")&&e.showOn.splice(e.showOn.indexOf("focus"),1),0<e.disableTimeRanges.length){for(var i in e.disableTimeRanges)e.disableTimeRanges[i]=[T(e.disableTimeRanges[i][0]),T(e.disableTimeRanges[i][1])];e.disableTimeRanges=e.disableTimeRanges.sort(function(e,t){return e[0]-t[0]});for(i=e.disableTimeRanges.length-1;0<i;i--)e.disableTimeRanges[i][0]<=e.disableTimeRanges[i-1][1]&&(e.disableTimeRanges[i-1]=[Math.min(e.disableTimeRanges[i][0],e.disableTimeRanges[i-1][0]),Math.max(e.disableTimeRanges[i][1],e.disableTimeRanges[i-1][1])],e.disableTimeRanges.splice(i,1))}return e}function r(t){var i,e=t.data("timepicker-settings"),a=t.data("timepicker-list");if(a&&a.length&&(a.remove(),t.data("timepicker-list",!1)),e.useSelect?i=a=y("<select />",{class:"ui-timepicker-select"}):(a=y("<ul />",{class:"ui-timepicker-list"}),(i=y("<div />",{class:"ui-timepicker-wrapper",tabindex:-1})).css({display:"none",position:"absolute"}).append(a)),e.noneOption)if(!0===e.noneOption&&(e.noneOption=e.useSelect?"Time...":"None"),y.isArray(e.noneOption))for(var n in e.noneOption)parseInt(n,10)==n&&(o=b(e.noneOption[n],e.useSelect),a.append(o));else{var o=b(e.noneOption,e.useSelect);a.append(o)}e.className&&i.addClass(e.className),null===e.minTime&&null===e.durationTime||!e.showDuration||("function"!=typeof e.step&&e.step,i.addClass("ui-timepicker-with-duration"),i.addClass("ui-timepicker-step-"+e.step));var s=e.minTime,r=("function"==typeof e.durationTime?s=T(e.durationTime()):null!==e.durationTime&&(s=e.durationTime),null!==e.minTime?e.minTime:0),l=null!==e.maxTime?e.maxTime:r+j-1,d=(l<r&&(l+=j),l===j-1&&"string"===y.type(e.timeFormat)&&e.show2400&&(l=j),e.disableTimeRanges),c=0,p=d.length,u=e.step;"function"!=typeof u&&(u=function(){return e.step});for(var f,n=r,h=0;n<=l;n+=60*u(++h)){var m,g,v,w=n,_=x(w,e);(e.useSelect?m=y("<option />",{value:_}):((m=y("<li />")).addClass(w%86400<43200?"ui-timepicker-am":"ui-timepicker-pm"),m.data("time",w<=86400?w:w%86400),m)).text(_),null===e.minTime&&null===e.durationTime||!e.showDuration||(_=n-s,v=e.step,f=g=void 0,_=Math.abs(_),_=Math.round(_/60),f=[],_<60?f=[_,S.mins]:(g=Math.floor(_/60),_=_%60,30==v&&30==_&&(g+=S.decimal+5),f.push(g),f.push(1==g?S.hr:S.hrs),30!=v&&_&&(f.push(_),f.push(S.mins))),g=f.join(" "),e.useSelect?m.text(m.text()+" ("+g+")"):((v=y("<span />",{class:"ui-timepicker-duration"})).text(" ("+g+")"),m.append(v))),c<p&&(w>=d[c][1]&&(c+=1),d[c])&&w>=d[c][0]&&w<d[c][1]&&(e.useSelect?m.prop("disabled",!0):m.addClass("ui-timepicker-disabled")),a.append(m)}i.data("timepicker-input",t),t.data("timepicker-list",i),e.useSelect?(t.val()&&a.val($(T(t.val()),e)),a.on("focus",function(){y(this).data("timepicker-input").trigger("showTimepicker")}),a.on("blur",function(){y(this).data("timepicker-input").trigger("hideTimepicker")}),a.on("change",function(){D(t,y(this).val(),"select")}),D(t,a.val(),"initial"),t.hide().after(a)):("string"==typeof(r=e.appendTo)?r=y(r):"function"==typeof r&&(r=r(t)),r.append(i),E(t,a),a.on("mousedown click","li",function(e){t.off("focus.timepicker"),t.on("focus.timepicker-ie-hack",function(){t.off("focus.timepicker-ie-hack"),t.on("focus.timepicker",V.show)}),k(t)||t[0].focus(),a.find("li").removeClass("ui-timepicker-selected"),y(this).addClass("ui-timepicker-selected"),C(t)&&(t.trigger("hideTimepicker"),a.on("mouseup.timepicker click.timepicker","li",function(e){a.off("mouseup.timepicker click.timepicker"),i.hide()}))}))}function b(e,t){var i,a,n;return"object"==typeof e?(i=e.label,a=e.className,n=e.value):"string"==typeof e?i=e:y.error("Invalid noneOption value"),t?y("<option />",{value:n,class:a,text:i}):y("<li />",{class:a,text:i}).data("time",String(n))}function $(e,t){return null!==(e=t.roundingFunction(e,t))?x(e,t):void 0}function l(e){e.target==window||(e=y(e.target)).closest(".ui-timepicker-input").length||e.closest(".ui-timepicker-wrapper").length||(V.hide(),y(document).unbind(".ui-timepicker"),y(window).unbind(".ui-timepicker"))}function k(e){e=e.data("timepicker-settings");return(window.navigator.msMaxTouchPoints||"ontouchstart"in document)&&e.disableTouchKeyboard}function d(e,t,i){var a;return!(!i&&0!==i)&&(e=e.data("timepicker-settings"),a=!1,i=e.roundingFunction(i,e),t.find("li").each(function(e,t){t=y(t);return"number"==typeof t.data("time")&&t.data("time")==i?(a=t,!1):void 0}),a)}function E(e,t){t.find("li").removeClass("ui-timepicker-selected");var i=T(p(e),e.data("timepicker-settings"));null!==i&&(e=d(e,t,i))&&(((i=e.offset().top-t.offset().top)+e.outerHeight()>t.outerHeight()||i<0)&&t.scrollTop(t.scrollTop()+e.position().top-e.outerHeight()),e.addClass("ui-timepicker-selected"))}function c(e,t){var i,a,n,o;""!==this.value&&"timepicker"!=t&&(!(i=y(this)).is(":focus")||e&&"change"==e.type)&&(e=i.data("timepicker-settings"),null===(a=T(this.value,e))?i.trigger("timeFormatError"):(n=!1,null!==e.minTime&&null!==e.maxTime&&(a<e.minTime||a>e.maxTime)&&(n=!0),y.each(e.disableTimeRanges,function(){return a>=this[0]&&a<this[1]?!(n=!0):void 0}),e.forceRoundTime&&(o=e.roundingFunction(a,e))!=a&&(a=o,t=null),o=x(a,e),n?D(i,o,"error")&&i.trigger("timeRangeError"):D(i,o,t)))}function p(e){return e.is("input")?e.val():e.data("ui-timepicker-value")}function D(e,t,i){var a;return e.is("input")&&(e.val(t),(a=e.data("timepicker-settings")).useSelect)&&"select"!=i&&"initial"!=i&&e.data("timepicker-list").val($(T(t),a)),e.data("ui-timepicker-value")!=t?(e.data("ui-timepicker-value",t),"select"==i?e.trigger("selectTime").trigger("changeTime").trigger("change","timepicker"):-1==["error","initial"].indexOf(i)&&e.trigger("changeTime"),1):(e.trigger("selectTime"),0)}function u(e){switch(e.keyCode){case 13:case 9:return;default:e.preventDefault()}}function f(e){var t=y(this),i=t.data("timepicker-list");if(!i||!o(i)){if(40!=e.keyCode)return!0;V.show.call(t.get(0)),i=t.data("timepicker-list"),k(t)||t.focus()}switch(e.keyCode){case 13:return C(t)&&(c.call(t.get(0),{type:"change"}),V.hide.apply(this)),e.preventDefault(),!1;case 38:var a=i.find(".ui-timepicker-selected");return a.length?a.is(":first-child")||(a.removeClass("ui-timepicker-selected"),a.prev().addClass("ui-timepicker-selected"),a.prev().position().top<a.outerHeight()&&i.scrollTop(i.scrollTop()-a.outerHeight())):(i.find("li").each(function(e,t){return 0<y(t).position().top?(a=y(t),!1):void 0}),a.addClass("ui-timepicker-selected")),!1;case 40:return 0===(a=i.find(".ui-timepicker-selected")).length?(i.find("li").each(function(e,t){return 0<y(t).position().top?(a=y(t),!1):void 0}),a.addClass("ui-timepicker-selected")):a.is(":last-child")||(a.removeClass("ui-timepicker-selected"),a.next().addClass("ui-timepicker-selected"),a.next().position().top+2*a.outerHeight()>i.outerHeight()&&i.scrollTop(i.scrollTop()+a.outerHeight())),!1;case 27:i.find("li").removeClass("ui-timepicker-selected"),V.hide();break;case 9:V.hide();break;default:return!0}}function h(e){var t=y(this),i=t.data("timepicker-list"),a=t.data("timepicker-settings");if(!i||!o(i)||a.disableTextInput)return!0;switch(e.keyCode){case 96:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:case 65:case 77:case 80:case 186:case 8:case 46:a.typeaheadHighlight?E(t,i):i.hide()}}function C(e){var t=e.data("timepicker-settings"),i=null,a=e.data("timepicker-list").find(".ui-timepicker-selected");return!a.hasClass("ui-timepicker-disabled")&&(null!==(i=a.length?a.data("time"):i)&&D(e,i="string"!=typeof i?x(i,t):i,"select"),1)}function x(e,t){if("number"!=typeof e)return null;var i=parseInt(e%60),a=parseInt(e/60%60),n=parseInt(e/3600%24),o=new Date(1970,0,2,n,a,i,0);if(isNaN(o.getTime()))return null;if("function"===y.type(t.timeFormat))return t.timeFormat(o);for(var s,r,l="",d=0;d<t.timeFormat.length;d++)switch(r=t.timeFormat.charAt(d)){case"a":l+=11<o.getHours()?S.pm:S.am;break;case"A":l+=11<o.getHours()?S.PM:S.AM;break;case"g":l+=0===(s=o.getHours()%12)?"12":s;break;case"G":s=o.getHours(),l+=s=e===j?t.show2400?24:0:s;break;case"h":l+=0===(s=0!==(s=o.getHours()%12)&&s<10?"0"+s:s)?"12":s;break;case"H":s=o.getHours(),l+=9<(s=e===j?t.show2400?24:0:s)?s:"0"+s;break;case"i":l+=9<(a=o.getMinutes())?a:"0"+a;break;case"s":l+=9<(i=o.getSeconds())?i:"0"+i;break;case"\\":d++,l+=t.timeFormat.charAt(d);break;default:l+=r}return l}function T(e,t){if(""===e||null===e)return null;if("object"==typeof e)return 3600*e.getHours()+60*e.getMinutes()+e.getSeconds();if("string"!=typeof e)return e;"a"!=(e=e.toLowerCase().replace(/[\s\.]/g,"")).slice(-1)&&"p"!=e.slice(-1)||(e+="m");var i="("+S.am.replace(".","")+"|"+S.pm.replace(".","")+"|"+S.AM.replace(".","")+"|"+S.PM.replace(".","")+")?",i=new RegExp("^"+i+"([0-9]?[0-9])\\W?([0-5][0-9])?\\W?([0-5][0-9])?"+i+"$"),e=e.match(i);if(!e)return null;i=parseInt(+e[2],10);if(24<i){if(t&&!1===t.wrapHours)return null;i%=24}var a=e[1]||e[5],n=i,o=(i<=12&&a&&(o=a==S.pm||a==S.PM,n=12==i?o?12:0:i+(o?12:0)),+e[3]||0),n=3600*n+60*o+(+e[4]||0);return n=i<12&&!a&&t&&t._twelveHourTime&&t.scrollDefault&&(o=n-t.scrollDefault())<0&&j/-2<=o?(n+j/2)%j:n}var j=86400,S={am:"am",pm:"pm",AM:"AM",PM:"PM",decimal:".",mins:"mins",hr:"hr",hrs:"hrs"},V={init:function(o){return this.each(function(){var e,t=y(this),i=[];for(e in y.fn.timepicker.defaults)t.data(e)&&(i[e]=t.data(e));var a=y.extend({},y.fn.timepicker.defaults,i,o);if(a.lang&&(S=y.extend(S,a.lang)),a=s(a),t.data("timepicker-settings",a),t.addClass("ui-timepicker-input"),a.useSelect)r(t);else{if(t.prop("autocomplete","off"),a.showOn)for(var n in a.showOn)t.on(a.showOn[n]+".timepicker",V.show);t.on("change.timepicker",c),t.on("keydown.timepicker",f),t.on("keyup.timepicker",h),a.disableTextInput&&t.on("keydown.timepicker",u),c.call(t.get(0),null,"initial")}})},show:function(e){var t,i,a=y(this),n=a.data("timepicker-settings");if(e&&e.preventDefault(),!n.useSelect)return k(a)&&a.blur(),e=a.data("timepicker-list"),a.prop("readonly")||(e&&0!==e.length&&"function"!=typeof n.durationTime||(r(a),e=a.data("timepicker-list")),o(e))?void 0:(a.data("ui-timepicker-value",a.val()),E(a,e),V.hide(),e.show(),t={},n.orientation.match(/r/)?t.left=a.offset().left+a.outerWidth()-e.outerWidth()+parseInt(e.css("marginLeft").replace("px",""),10):t.left=a.offset().left+parseInt(e.css("marginLeft").replace("px",""),10),"t"==(n.orientation.match(/t/)||!n.orientation.match(/b/)&&a.offset().top+a.outerHeight(!0)+e.outerHeight()>y(window).height()+y(window).scrollTop()?"t":"b")?(e.addClass("ui-timepicker-positioned-top"),t.top=a.offset().top-e.outerHeight()+parseInt(e.css("marginTop").replace("px",""),10)):(e.removeClass("ui-timepicker-positioned-top"),t.top=a.offset().top+a.outerHeight()+parseInt(e.css("marginTop").replace("px",""),10)),e.offset(t),(t=e.find(".ui-timepicker-selected")).length||(null!==(i=T(p(a)))?t=d(a,e,i):n.scrollDefault&&(t=d(a,e,n.scrollDefault()))),t&&t.length?(i=e.scrollTop()+t.position().top-t.outerHeight(),e.scrollTop(i)):e.scrollTop(0),n.stopScrollPropagation&&y(document).on("wheel.ui-timepicker",".ui-timepicker-wrapper",function(e){e.preventDefault();var t=y(this).scrollTop();y(this).scrollTop(t+e.originalEvent.deltaY)}),y(document).on("touchstart.ui-timepicker mousedown.ui-timepicker",l),y(window).on("resize.ui-timepicker",l),n.closeOnWindowScroll&&y(document).on("scroll.ui-timepicker",l),a.trigger("showTimepicker"),this);a.data("timepicker-list").focus()},hide:function(e){var t=y(this),i=t.data("timepicker-settings");return i&&i.useSelect&&t.blur(),y(".ui-timepicker-wrapper").each(function(){var e,t,i=y(this);o(i)&&((t=(e=i.data("timepicker-input")).data("timepicker-settings"))&&t.selectOnBlur&&C(e),i.hide(),e.trigger("hideTimepicker"))}),this},option:function(a,n){return"string"==typeof a&&void 0===n?y(this).data("timepicker-settings")[a]:this.each(function(){var e=y(this),t=e.data("timepicker-settings"),i=e.data("timepicker-list");"object"==typeof a?t=y.extend(t,a):"string"==typeof a&&(t[a]=n),t=s(t),e.data("timepicker-settings",t),i&&(i.remove(),e.data("timepicker-list",!1)),t.useSelect&&r(e)})},getSecondsFromMidnight:function(){return T(p(this))},getTime:function(e){var t=p(this);if(!t)return null;t=T(t);if(null===t)return null;e=e||new Date;e=new Date(e);return e.setHours(t/3600),e.setMinutes(t%3600/60),e.setSeconds(t%60),e.setMilliseconds(0),e},isVisible:function(){var e=this.data("timepicker-list");return!(!e||!o(e))},setTime:function(e){var t,i=this,a=i.data("timepicker-settings");return t=(a.forceRoundTime?$:x)(T(e),a),D(i,t=e&&null===t&&a.noneOption?e:t),i.data("timepicker-list")&&E(i,i.data("timepicker-list")),this},remove:function(){var e,t=this;if(t.hasClass("ui-timepicker-input"))return e=t.data("timepicker-settings"),t.removeAttr("autocomplete","off"),t.removeClass("ui-timepicker-input"),t.removeData("timepicker-settings"),t.off(".timepicker"),t.data("timepicker-list")&&t.data("timepicker-list").remove(),e.useSelect&&t.show(),t.removeData("timepicker-list"),this}};y.fn.timepicker=function(e){return this.length?V[e]?this.hasClass("ui-timepicker-input")?V[e].apply(this,Array.prototype.slice.call(arguments,1)):this:"object"!=typeof e&&e?void y.error("Method "+e+" does not exist on jQuery.timepicker"):V.init.apply(this,arguments):this},y.fn.timepicker.defaults={appendTo:"body",className:null,closeOnWindowScroll:!1,disableTextInput:!1,disableTimeRanges:[],disableTouchKeyboard:!1,durationTime:null,forceRoundTime:!1,maxTime:null,minTime:null,noneOption:!1,orientation:"l",roundingFunction:function(e,t){var i;return null===e?null:"number"!=typeof t.step||((i=e%(60*t.step))>=30*t.step?e+=60*t.step-i:e-=i,e==j&&t.show2400)?e:e%j},scrollDefault:null,selectOnBlur:!1,show2400:!1,showDuration:!1,showOn:["click","focus"],showOnFocus:!0,step:30,stopScrollPropagation:!1,timeFormat:"g:ia",typeaheadHighlight:!0,useSelect:!1,wrapHours:!0}});var AccessPage=function(s){var e,a,t,n;a=s,(e=function(e){var t=this;t.$wrapper=e.$wrapper,t.$accessWrapper=t.$wrapper.find(".t-access-wrapper"),t.$accessSlider=t.$wrapper.find(".t-access-slider"),t.$headerApps=t.$wrapper.find(".t-header-apps"),t.$headerList=t.$headerApps.find(".t-apps-list"),t.$apps=t.$headerList.find(".t-app-item"),t.item_count=t.$apps.length,t.type_class=!1,t.left=0,t.items_left=0,t.access_wrapper_w=!1,t.access_slider_w=!1,t.item_w=!1,t.initClass()}).prototype.initClass=function(){var i=this;i.detectSliderWidth(),i.showArrows(),i.setWrapMaxWidth(),a(window).on("resize",a.proxy(i.setWrapMaxWidth,i)),a(window).on("resize",function e(){var t=a.contains(document,i.$wrapper[0]);t?i.reset():a(window).off("resize",e)}),i.$wrapper.on("click",".t-action",function(){var e=a(this);e.hasClass("left")&&i.moveSlider(!1),e.hasClass("right")&&i.moveSlider(!0)})},e.prototype.setWrapMaxWidth=function(){var e=window.innerWidth-document.documentElement.offsetWidth,t=document.body.scrollHeight>window.innerHeight;let i;i=t?window.innerWidth-e-this.$wrapper.offset().left:window.innerWidth-this.$wrapper.offset().left,this.$wrapper[0].style.setProperty("max-width",i+"px"),a("body")[0].style.setProperty("overflow-x","hidden")},e.prototype.detectSliderWidth=function(){var e=this;e.access_wrapper_w=e.$accessWrapper.outerWidth(),e.access_slider_w=e.$accessSlider.outerWidth(),e.item_w=e.$apps.first().outerWidth()},e.prototype.showArrows=function(){var t=this;function e(e){t.type_class&&(t.$accessWrapper.removeClass(t.type_class),t.$headerApps.removeClass(t.type_class)),e&&(t.$accessWrapper.addClass(e),t.$headerApps.addClass(e),t.type_class=e)}0<=t.left?t.access_wrapper_w<t.access_slider_w?e("type-1"):e():t.access_wrapper_w<t.access_slider_w-Math.abs(t.left)?e("type-2"):e("type-3")},e.prototype.setLeft=function(e){this.$headerList.css({left:e}),this.$accessSlider.css({left:e}),this.left=e},e.prototype.moveSlider=function(e){var t,i=this,a=i.items_left;e?t=a+1:(t=a-1)<0&&(t=0),(e=t*i.item_w)>-(i.access_wrapper_w-i.access_slider_w)&&(e=-(i.access_wrapper_w-i.access_slider_w)),i.items_left=t,i.setLeft(-e),i.showArrows()},e.prototype.reset=function(){this.items_left=0,this.setLeft(0),this.detectSliderWidth(),this.showArrows()},n=jQuery,(t=function(e){var t=this;t.$wrapper=e.$wrapper,t.$header=t.$wrapper.find(".t-elastic-header"),t.wrapper_offset=t.$wrapper.offset(),t.header_w=t.$header.outerWidth(),t.header_h=t.$header.outerHeight(),t.fixed_class="is-fixed",t.is_fixed=!1,t.initClass()}).prototype.initClass=function(){var i=this,a=n(window);a.on("scroll",function e(){var t=n.contains(document,i.$header[0]);t?i.onScroll(a.scrollTop()):a.off("scroll",e)}).on("resize",function e(){var t=n.contains(document,i.$header[0]);t?i.onResize():a.off("resize",e)})},t.prototype.onScroll=function(e){var t=this;e>t.wrapper_offset.top?(t.$header.addClass(t.fixed_class).css({left:t.wrapper_offset.left,width:t.header_w}),t.is_fixed=!0):(t.$header.removeClass(t.fixed_class).removeAttr("style"),t.is_fixed=!1)},t.prototype.onResize=function(){var e=this;e.header_w=e.$wrapper.outerWidth(),e.is_fixed&&e.$header.width(e.header_w)};return(AccessPage=function(e){this.$wrapper=e.$wrapper,this.slider=!1,this.dialogs=[],this.initClass()}).prototype.initClass=function(){this.initAccessSlider(),this.initElasticHeader(),this.initHover(),this.bindEvents()},AccessPage.prototype.bindEvents=function(){var i,a=this;a.$wrapper.on("click",".t-access-status",function(e){e.preventDefault();e=s(this);e.hasClass("is-admin")&&!a.dialogs.length?s.team.content.load(e.data("uri")):showAccessDialog(e,e.data("app-id"),e.data("user-id"))}),s(document).on("team_access_level_changed",i=function(e,t){s.contains(document.body,a.$wrapper[0])?a.$wrapper.find('table.t-access-table tr[data-user-id="'+t.contact_id+'"] .t-access-status[data-app-id="'+t.app_id+'"]').removeClass("type-no type-limited type-full type-"+t.prev_level).addClass("type-"+t.new_level):s(document).off("team_access_level_changed",i)})},AccessPage.prototype.initAccessSlider=function(){this.slider||(this.slider=new e({$wrapper:this.$wrapper}))},AccessPage.prototype.initElasticHeader=function(){new t({$wrapper:this.$wrapper})},AccessPage.prototype.closeDialogs=function(){var i=!1;return this.dialogs.length&&(s.each(this.dialogs,function(e,t){s.contains(document,t.$wrapper[0])&&(t.close(),i=!0)}),this.dialogs=[]),i},AccessPage.prototype.initHover=function(){var i=!1,a=!1,n="access-highlighted";function o(){i&&(i.removeClass(n),i=!1),a&&(a.removeClass(n),a=!1)}this.$wrapper.on("mouseenter",".t-access-status",function(){var e,t;e=s(this),t=e.data("user-id"),e=e.data("app-id"),o(),t&&e&&(t=s("#t-user-"+t),e=s("#t-app-"+e),t.length&&(t.addClass(n),i=t),e.length)&&(e.addClass(n),a=e)}),this.$wrapper.on("mouseleave",".t-access-status",o)},AccessPage}(jQuery),SiteApiTokenPage=(!function(D){function e(e){var t,i,a,n,o,s=this;s.$dialogWrapper=e.$wrapper,s.$wrapper=s.$dialogWrapper.find(".dialog-body"),s.$limitedContent=s.$wrapper.find(".t-limited-access-form"),s.$submit_btn=s.$wrapper.find('[type="submit"]'),s.active_class="selected",s.disabled_class="disabled",s.wa_app_url=e.wa_app_url,s.app_id=e.app_id,s.contact_id=e.contact_id,s.teamDialog=s.$dialogWrapper.data("dialog")||!1,s.noticeToggle=(e=s.$wrapper,a=e.find(".t-loading"),n=e.find(".t-success"),o="is-visible",t={loading:function(){n.removeClass(o),a.addClass(o)},success:function(){n.addClass(o),a.removeClass(o),i&&clearTimeout(i),i=setTimeout(function(){r.contains(document,n[0])&&t.hide()},2e3)},hide:function(){i&&clearTimeout(i),a.removeClass(o),n.removeClass(o)}}),s.$activeTab=s.$wrapper.find(".t-access-item."+s.active_class),s.active_access_id=s.$activeTab.data("access-id"),s.is_locked=!1,s.initClass()}var r;window.AccessDialog=(r=D,e.prototype.initClass=function(){this.bindEvents()},e.prototype.bindEvents=function(){var n=this;n.$wrapper.find(".t-access-list").waToggle({use_animation:!1,change:function(e,t,i){var t=r(t),a=t.hasClass(n.disabled_class);n.$submit_btn.toggleClass("yellow",i.$active.data("access-id")!=n.active_access_id),a?r.waDialog.alert({text:t.data("reason-disabled"),button_title:"Ok",onClose(e){i.$before.trigger("click"),e.$wrapper.remove()}}):(n.changeTab(t),n.teamDialog&&n.teamDialog.resize())}}),n.$wrapper.on("click",'input[type="submit"]',function(e){e.stopPropagation(),n.save()}),n.$wrapper.on("change",'input[type!="hidden"], select',function(){n.$submit_btn.toggleClass("yellow",!!n.$limitedContent.find("tr[data-state-changed]").length)})},e.prototype.changeTab=function(e){var t=e.data("access-id"),i=this.$limitedContent,a=this.$wrapper.find(".js-access");this.$activeTab=e,a.addClass("hidden").filter("."+t).removeClass("hidden"),this.$limitedContent.length&&i.toggleClass("hidden",!("limited"===t))},e.prototype.save=function(){var i=this,a=i.$activeTab.data("access-id"),e=function(e){var t=!1,i={no:0,limited:1,full:2};i.hasOwnProperty(e)&&(t=i[e]);return t}(a),t=(i.is_locked=!0,i.noticeToggle.loading(),t=i.wa_app_url+"?module=accessSave&action=rights&id="+i.contact_id,r.post(t,{app_id:i.app_id,name:"backend",value:e},"json"));(t="limited"===a?t.then(function(){var e=i.$limitedContent.find("form");return r.post(e.attr("action"),e.serialize(),"json")}):t).then(function(){var e,t;e=i.active_access_id,t=a,r(document).trigger("team_access_level_changed",{app_id:i.app_id,contact_id:i.contact_id,prev_level:e,new_level:t}),i.active_access_id=a,i.noticeToggle.success(),i.is_locked=!1,i.teamDialog.close()})},e),window.ProfileAccessTab=function(e){"use strict";var a,n,t,i,o,s,r,l,d=e.login,c=e.password,p=e.contact_id,u=e.wa_app_url,f=e.url_change_api_token,h=e.loc,m=((g=D("#form-customize-groups")).length&&(D("#open-customize-groups").on("click",function(e){e.preventDefault(),D(this).hide(),D("#form-customize-groups").toggle()}),D("#cancel-customize-groups").on("click",function(e){e.preventDefault();e=D("#form-customize-groups").hide();D("#open-customize-groups").show(),e.find(".loading").hide(),e.find(".state-error-hint").remove()}),g.submit(function(){var a=D(this);return a.find(".state-error-hint").remove(),a.find(".loading").show(),D.post(a.attr("action"),a.serialize(),function(e){if("ok"==e.status){try{D.team.sidebar.reload(),D.team.content.reload(),a.find(".loading").hide(),a.hide();const t=D.team.profile.$profile_header_links.find('[data-section-id="access"]:first').attr("data-url"),i=a.closest(".dialog").data("dialog");i.$content.css({position:"relative",overflow:"hidden"}).append('<div class="js-reload-spinner" style="position:absolute;top:0;bottom:0;left:0;right:0;display:grid;place-items:center;background:var(--background-color-blank);"><span class="spinner custom-p-16"></span></div>'),D.post(t,{userId:D.team.profile.user.id},function(e){i.$content.css("overflow","auto").empty().html(e)}).always(function(){i.$content.css("overflow","auto").find(".js-reload-spinner").remove()})}catch(e){}window.hasOwnProperty("profileTab")&&window.profileTab.reload()}else"fail"==e.status&&a.find(".c-checkbox-menu-container").after(D('<span class="state-error-hint">'+e.errors.join("<br />")+"</span>"))},"json"),!1})),D("#c-credentials-form").submit(function(){var e,t=D(this),i=(t.find("input.state-error").removeClass("error"),t.find(".state-error-hint").remove(),t.find(".c-login-input")),a=D.trim(i.val());return a?(e=t.serializeArray(),"1"===D("#c-access-rights-toggle").val()&&(e=e.concat([{name:"set_rights",value:"1"},{name:"app_id",value:"webasyst"},{name:"name",value:"backend"},{name:"value",value:1}])),D.post(t.attr("action"),e,function(e){if("ok"===e.status){t.hide(),d=a,D("#c-login-block").show().find(".c-login-input").val(d).end().find(".c-login").text(d);try{D.team.sidebar.reload()}catch(e){}try{window.profileTab.reload()}catch(e){}}else"fail"===e.status&&t.find('input[type="submit"]').parent().prepend(D('<p class="state-error-hint custom-mt-4 custom-mb-8">'+e.errors.join("<br>")+"</p>"))},"json")):i.addClass("error").after('<p class="state-error-hint custom-mt-4">'+h["Login is required"]+"</p>"),!1}).find(".cancel").click(function(e){return e.preventDefault(),D("#c-credentials-block").hide(),!1}),a=D("#c-login-form"),n=a.find(".c-login-input"),a.submit(function(){D(".dialog-footer .js-close-dialog").prop("disabled",!0),a.find("input.state-error").removeClass("error"),a.find(".state-error-hint").remove();var i=D.trim(n.val());return d!==i&&(i?(a.find(".loading").show(),D.post(a.attr("action"),a.serialize(),function(e){if(a.find(".loading").hide(),"ok"===e.status){if(D("#c-login-block").show(),n.val(i),a.find(".c-login").text(i),a.find(".c-one-tab").show(),a.find(".c-two-tab").hide(),!d)try{window.profileTab.reload()}catch(e){}var t=window.location.href.replace(d,i);d=i,window.location.assign(t)}else"fail"===e.status&&(D(".dialog-footer .js-close-dialog").prop("disabled",!1),a.find('input[type="submit"]').parent().prepend(D('<p class="state-error-hint custom-mt-4 custom-mb-8">'+e.errors.join("\n<br>\n")+"</p>")))},"json")):n.addClass("error").after('<p class="state-error-hint custom-mt-4">'+h["Login is required."]+"</p>")),!1}),a.find(".c-tab-toggle").click(function(e){return e.preventDefault(),a.find(".c-one-tab,.c-two-tab").toggle(),n.is(":visible")&&n.focus(),!1}),t=D("#c-password-form"),i=t.find(".c-password-input"),o=t.find(".c-confirm-password-input"),t.submit(function(){return t.find("input.state-error").removeClass("error"),t.find(".state-error-hint").remove(),i.val()!==o.val()?(i.addClass("error"),o.after().after('<p class="state-error-hint custom-mt-4">'+h["Passwords do not match."]+"</p>")):(t.find(".loading").show(),D.post(t.attr("action"),t.serialize(),function(e){t.find(".loading").hide(),"ok"===e.status?(c=!0,i.val(""),o.val(""),t.find(".c-one-tab").show(),t.find(".c-two-tab").hide(),D("#c-password-block").show()):"fail"===e.status&&o.after('<p class="state-error-hint custom-mt-4">'+e.errors.join("<br />")+"</p>")},"json")),!1}),t.find(".c-tab-toggle").click(function(e){e.preventDefault(),t.find(".c-one-tab,.c-two-tab").toggle();e=t.find(".c-password-input");return e.is(":visible")&&e.focus(),!1}),s=D("#tc-api-tokens-filed"),r=s.find(".js-api-tokens-list"),l=!1,s.on("click",".js-remove-api-token",function(e){e.preventDefault();var t=D(this).parents(".js-token-item"),i=t.find(".icon16"),e=t.data("token"),a={action:"remove",token_id:e};!l&&e&&confirm(h.remove_ask)&&(l=!0,i.removeClass("no").addClass("loading"),D.post(f,a,function(e){e.status&&"ok"===e.status?(t.remove(),0===r.find(".js-token-item").length&&s.remove()):(l=!1,i.removeClass("loading").addClass("no"))}).always(function(){l=!1,i.removeClass("loading").addClass("no")}))}),e.is_own_profile||!function e(t,i){if(!D.fn.iButton)return void D.ajax({cache:!0,dataType:"script",url:t+"wa-content/js/jquery-plugins/ibutton/jquery.ibutton.min.js?"+i,success:function(){e(t,i)}});var a=D(".basic-user-fields"),n=D(".js-block-user-reason-form");n.on("click",".js-block-user-cancel",function(){n.hide()});n.on("submit",function(e){e.preventDefault(),D.waDialog.confirm({title:'<i class="fas fa-exclamation-triangle smaller state-error"></i> '+o.data("alert"),success_button_title:h.blockUser||"Ok",success_button_class:"danger",cancel_button_title:h.cancel,cancel_button_class:"light-gray",onSuccess(){var e=n.find(".js-block-user-reason"),e=D.trim(e.val()),t=(D(".c-shown-on-enabled").hide(),s.parent().find(".loading").show());D.post(u+"?module=accessSave&action=ban&id="+p,{magic_word:"please",text:e},function(e){t.hide(),n.hide(),"ok"===e.status&&(a.addClass("gray"),D(".c-shown-on-disabled").show(),D("#tc-user-access-disabled").show().html(e.data.access_disable_msg),D.team.sidebar.reload())},"json")}})});var o=D("#c-access-link-block");o.on("click",function(e){e.preventDefault(),n.show()});var s=D("#c-access-link-unblock").on("click",function(e){e.preventDefault(),D.waDialog.confirm({title:'<i class="fas fa-exclamation-triangle smaller state-error"></i> '+s.data("alert"),success_button_title:h.unblockUser||"Ok",success_button_class:"danger",cancel_button_title:h.cancel,cancel_button_class:"light-gray",onOpen(e,t){console.log(e,t)},onSuccess(){D(".c-shown-on-disabled").hide();var t=s.parent().find(".loading").show();D.post(u+"?module=accessSave&action=unban&id="+p,{magic_word:"please"},function(){t.hide(),a.removeClass("gray"),D(".c-shown-on-enabled").show(),D("#tc-user-access-disabled").hide().html("");const e=D(".t-sidebar-profile-dialog").data("dialog");e.resize(),D.team.sidebar.reload()})}})})}(e.wa_url,e.wa_framework_version),e.is_own_profile&&D(".js-webasyst-id-auth").on("click",function(e){e.preventDefault(),D("body").trigger("wa_webasyst_id_auth")}),D(".js-webasyst-id-unbind-auth").on("click",function(e){e.preventDefault(),D(document).trigger("wa_waid_unbind_auth",{id:p})}),D(".js-webasyst-id-help-link").on("click",function(e){e.preventDefault(),D("body").trigger("wa_waid_help_link")}),e.is_own_profile),g=e.contact_no_access,v=e.contact_groups_no_access,w=D("#c-access-rights-toggle"),_=D("#access-rights-toggle-confirm"),y=w.val();function b(){var e;$(!0)&&(void 0===(e=w.val())&&(e="1"),function(){switch(e){case"0":return D.post(u+"?module=accessSave&action=makeuser",{id:p},"json").then(function(){return E("webasyst","backend",0)});case"1":return E("webasyst","backend",1);case"single_app_mode":return k("webasyst");case"remove":return D.post(u+"?module=accessSave&action=revoke",{id:p},"json")}}().then(function(){v&&"0"==e?D("#c-access-rights-hint-customize").show():D("#c-access-rights-hint-warning").hide()}))}function $(e){D("#c-access-rights-hint-warning").hide(),D("#c-access-rights-hint-customize").hide();var t=D("#c-access-single-app-by-app").hide(),i=w.val();switch(i=void 0===i?"1":i){case"remove":if(D("#c-credentials-block").hide(),D("#c-login-block").hide(),D("#c-password-block").hide(),v){D("#c-access-rights-by-app").hide(),D(".c-shown-on-access").hide();break}return w.val(y||"0"),void D("#c-access-rights-hint-warning").show();case"0":if(d||c){if(d){var a=D("#c-access-rights-by-app");a.show(),e&&a.find(".t-access-status").removeClass("type-no type-limited type-full").addClass("type-no"),D(".c-shown-on-access").show(),D("#c-login-block").show(),D("#c-password-block").show();break}return D("#c-login-block").show().find(".cancel").one("click.access",function(){w.val(y),b()}).end().find(".c-tab-toggle:first").click(),void D("#c-password-block").show()}return void D("#c-credentials-block").show().find(".c-login-input").focus().end().find(".cancel").one("click.access",function(){w.val(y),b()});case"1":if(d||c){if(d){D("#c-access-rights-by-app").hide(),D(".c-shown-on-access").show(),D("#c-login-block").show(),D("#c-password-block").show();break}return D("#c-login-block").show().find(".cancel").one("click.access",function(){w.val(y),b()}).end().find(".c-tab-toggle:first").click(),void D("#c-password-block").show()}return void D("#c-credentials-block").show().find(".c-login-input").focus().end().find(".cancel").one("click.access",function(){w.val(y),b()});case"single_app_mode":if(d||c){if(d){a=t.find(".c-access-single-app-checkbox");e&&(t.find(".t-access-status").removeClass("type-no type-limited type-full").addClass("type-no").closest("tr").addClass("t-single-app-selected").removeClass("t-single-app-selected"),a.prop("checked",!1)),t.show(),D("#c-access-rights-by-app").hide(),D(".c-shown-on-access").show(),D("#c-login-block").show(),D("#c-password-block").show(),a.off("change").on("change",function(){var e,t=D(this),i=t.closest("label"),a=t.val();a&&(e=D('<span><i class="spinner loading large custom-mr-4"></i></span>'),i.hide(),e.insertAfter(i),k(a).always(function(){e.remove(),i.show()}).done(function(){D("#c-access-single-app-by-app").find(".t-access-status").removeClass("type-no type-limited type-full").addClass("type-full"),t.closest("tr").addClass("t-single-app-selected").siblings().removeClass("t-single-app-selected")}).fail(function(){t.prop("checked",!1)}))});break}return D("#c-login-block").show().find(".cancel").one("click.access",function(){w.val(y),b()}).end().find(".c-tab-toggle:first").click(),void D("#c-password-block").show()}return void D("#c-credentials-block").show().find(".c-login-input").focus().end().find(".cancel").one("click.access",function(){w.val(y),b()});default:return}return m&&(D("#c-login-block").show(),D("#c-password-block").show()),y=i,1}function k(e){return D.post(u+"?module=accessSave&action=singleAppMode&id="+p,{app_id:e},"json")}function E(e,t,i){return D.post(u+"?module=accessSave&action=rights&id="+p,{app_id:e,name:t,value:i},"json")}g?D(".c-shown-on-access").hide():D(".c-shown-on-access").show(),$(),_.on("click",".cancel",function(){w.val(y),_.hide()}),_.on("click",".button",function(){_.hide(),b(),D(".t-sidebar-profile-dialog").data("dialog").resize()}),w.change(function(){var e;d?(D("#c-access-rights-hint-warning").hide(),D("#c-access-rights-hint-customize").hide(),(e=void 0===(e=w.val())?"1":e)===y?_.hide():_.show()):$(!0)}),new UserAccessTable({$wrapper:D(".c-access-rights-wrapper"),contact_id:p,is_frame:!0})},window.UserAccessTable=function(e){"use strict";var i,a=e.$wrapper,t=e.contact_id,n=e.is_frame||!1;a.on("click",".t-access-status",function(e){e.preventDefault();e=D(this);showAccessDialog(e,e.data("app-id"),t,!0,n)}),D(document).on("team_access_level_changed",i=function(e,t){D.contains(document.body,a[0])?a.find('.t-access-status[data-app-id="'+t.app_id+'"]').removeClass("type-no type-limited type-full type-"+t.prev_level).addClass("type-"+t.new_level):D(document).off("team_access_level_changed",i)})},window.showAccessDialog=function(i,e,t,a,n){i.trigger("close"),D.post(D.team.app_url+"?module=access&action=dialog",{user_id:t,app_id:e},function(e){e={html:e};n&&a&&(e.setPosition=function(e){var t=D(window).width();return{top:i.offset().top,left:parseInt((t-e.width)/2)}}),D.waDialog(e)})}}(jQuery),function(l){return(SiteApiTokenPage=function(e){this.$wrapper=e.$wrapper,this.locale=e.locale,this.initClass()}).prototype.initClass=function(){this.initRemoveApiToken()},SiteApiTokenPage.prototype.initRemoveApiToken=function(){var o,s=this,r=s.$wrapper.find(".js-api-tokens-list");s.$wrapper.on("click",".js-remove-api-token",function(e){e.preventDefault(),e.stopImmediatePropagation();var t=l(this).closest(".js-token-item"),i=t.find("svg"),a=t.data("token"),e=t.data("contact-id"),n={action:"remove",token_id:a,contact_id:e};l.waDialog.confirm({title:s.locale.remove_ask,success_button_title:s.locale.delete,success_button_class:"danger",cancel_button_title:s.locale.cancel,cancel_button_class:"light-gray",onSuccess(){o&&!a?console.warn(`System error. is_locked=${o}. token_id=`+a):(o=!0,i.removeClass("fa-times").addClass("fa-spin fa-spinner wa-animation-spin speed-1000"),l.post("?module=apiTokensRemove",n,function(e){e.status&&"ok"===e.status?(t.remove(),r.find(".js-token-item").length):(o=!1,i.removeClass("fa-spin fa-spinner wa-animation-spin speed-1000").addClass("fa-times"))}).always(function(){o=!1,i.removeClass("fa-spin fa-spinner wa-animation-spin speed-1000").addClass("fa-times")}))}})})},SiteApiTokenPage}(jQuery)),CalendarPage=function(n){var e,o;o=jQuery,(e=function(e){var t=this;t.$wrapper=e.$wrapper,t.$monthSelect=t.$wrapper.find(".month"),t.$yearSelect=t.$wrapper.find(".year"),t.filters_href=e.filters_href,t.month=parseInt(t.$monthSelect.val()),t.year=parseInt(t.$yearSelect.val()),t.initClass()}).prototype.initClass=function(){var t=this;t.$monthSelect.on("change",function(){var e=o(this).val();return e&&(t.month=parseInt(e)),t.useFilter(),!1}),t.$yearSelect.on("change",function(){var e=o(this).val();return e&&(t.year=parseInt(e)),t.useFilter(),!1}),t.$wrapper.on("click",".t-arrow",function(){var e=o(this);return e.hasClass("left")&&t.changeMonth(!1),e.hasClass("right")&&t.changeMonth(!0),t.useFilter(),!1})},e.prototype.changeMonth=function(e){var t=this;e?12<=t.month?(t.month=1,t.year++):t.month++:t.month<=1?(t.month=12,t.year--):t.month--},e.prototype.useFilter=function(){var e=this,t="start="+(e.year+"-"+(9<e.month?e.month:"0"+e.month)+"-01"),e=e.filters_href.split("?"),i=e[0],e=e[1]||"",e=0<=e.indexOf("&")?e.split("&"):[e],a=!1;e.length&&o.each(e,function(e,t){"start"==t.split("=")[0]&&(a=e)}),a||0===a?e[a]=t:e.push(t),t=i+"?"+e.join("&"),o.team.content.load(t)};return(CalendarPage=function(e){var t=this;t.$wrapper=e.$wrapper,t.$dateFilter=e.$dateFilter,t.filters_href=e.filters_href,t.user_id=e.user_id,t.local_storage=new n.store,t.initClass()}).prototype.initClass=function(){new e({$wrapper:this.$dateFilter,filters_href:this.filters_href}),this.initInfoBlock()},CalendarPage.prototype.initInfoBlock=function(){const t=this.$wrapper.find(".t-info-notice-wrapper");var e=t.find(".t-info-notice-toggle");const i=new n.store,a="team/calendar_info_warn_block_hide";i.get(a)?t.hide():t.show(),e.on("click",function(e){e.preventDefault(),i.set(a,1),t.remove()})},CalendarPage}(jQuery),TeamCalendar=function(d){return(TeamCalendar=function(e){var i,t=this;t.$wrapper=e.$wrapper,t.$rows=t.$wrapper.find(".t-week-row"),t.days_count=7,t.weeks_count=t.$rows.length,t.selected_class="is-selected",t.active_class="is-active",t.locales=e.locales,t.is_profile=e.is_profile,t.event_view_uri="?module=schedule&action=eventView",t.event_edit_uri="?module=schedule&action=eventEdit",t.day_uri="?module=schedule&action=day",t.user_id=e.user_id,t.has_right_to_change=e.has_right_to_change,t.selected_user_id=e.selected_user_id,t.selected_calendar_id=e.selected_calendar_id,t.period_start=e.period_start,t.period_end=e.period_end,t.daysArray=(e=t.$rows,i=[],e.each(function(){var e=d(this),t=[];e.find(".t-day-ornament").each(function(){t.push(d(this))}),i.push(t)}),i),t.wrapper_o=t.$wrapper.offset(),t.wrapper_w=t.$wrapper.width(),t.wrapper_h=t.$wrapper.height(),t.day_w=0,t.day_h=0,t.dialogs=[],t.xhr=!1,t.start=!1,t.end=!1,t.$selectedDays=[],t.is_locked=!1,t.bindEvents(),t.initHoverOnDay(),t.initMove()}).prototype.bindEvents=function(){var a=this,t=d(document);function i(e){return a.is_locked||(a.is_locked=!0,a.onMouseMove(e),setTimeout(function(){a.is_locked=!1},10)),!1}function n(){return a.onMouseUp(),a.$wrapper.off("mousemove",i),t.off("mouseup",n),!1}a.has_right_to_change&&(a.$wrapper.find(".show-full-days-events, .t-event-wrapper").on("mousedown",function(e){e.stopPropagation(),a.clearSelection()}),t.on("mousedown",function(){a.clearSelection()}),a.$wrapper.on("mousedown",function(e){return e.stopPropagation(),a.closeDialogs()||(a.onMouseDown(e),a.$wrapper.on("mousemove",i),t.on("mouseup",n)),!1})),a.$wrapper.on("click",".show-full-days-events",function(e){e.preventDefault(),a.closeDialogs()||a.showFullDayEvents(d(this))}),a.$wrapper.on("click",".t-event-block.js-view-event",function(e){e.preventDefault(),a.closeDialogs()||a.showEventDetails(d(this).closest(".t-event-wrapper"))}),d(document).on("keydown",function e(t){var i=d.contains(document,a.$wrapper[0]);i?27===t.keyCode&&a.deselectDays():d(document).off("keydown",e)})},TeamCalendar.prototype.showFullDayEvents=function(e){const t=this,i=e.data("events-id").toString().split(","),a=e.data("date"),n={date:a,id:i};t.is_profile&&(n.selected_user_id=t.selected_user_id),t.xhr&&(t.xhr.abort(),t.xhr=!1),t.xhr=d.post(t.day_uri,n,function(e){e=d.waDialog({html:e,animate:!1,onBgClick(e,t,i){i.close()}});t.addDialog(e)})},TeamCalendar.prototype.showEventDetails=function(e){var t=this,e={"data[id]":e.data("id")};t.xhr&&(t.xhr.abort(),t.xhr=!1),t.xhr=d.post(t.event_view_uri,e,function(e){e=d.waDialog({html:e});t.addDialog(e)})},TeamCalendar.prototype.createEvent=function(){var t=this,e=t.daysArray[t.start.week-1][t.start.day-1],i=t.daysArray[t.end.week-1][t.end.day-1],e=e.data("date"),i=i.data("date"),a={"data[start]":!1,"data[end]":!1,"data[contact_id]":t.selected_user_id||t.user_id},n=(new Date).getHours();a["data[start]"]=e.replace("00:00:00",23<=n?"23:59:59":n+1+":00:00"),a["data[end]"]=i.replace("00:00:00",22<=n?"23:59:59":n+2+":00:00"),t.selected_calendar_id&&(a["data[calendar_id]"]=t.selected_calendar_id),t.xhr&&(t.xhr.abort(),t.xhr=!1),t.xhr=d.post(t.event_edit_uri,a,function(e){e=d.waDialog({html:e});t.addDialog(e)})},TeamCalendar.prototype.onMouseDown=function(e){var t=this;t.start=t.getDayPosition(e),t.end=t.start,t.markDays()},TeamCalendar.prototype.onMouseMove=function(e){var t=this,e=t.getDayPosition(e);t.end&&t.end.week==e.week&&t.end.day==e.day||(t.end=e,t.markDays())},TeamCalendar.prototype.initHoverOnDay=function(e){var i=this,t=i.$wrapper,a=!1,n="is-highlighted";function o(){a&&a.removeClass(n),a=!1}t.on("mousemove",function(e){var t=function(e,t){var i=!1;t[e.week-1]&&t[e.week-1][e.day-1]&&(i=t[e.week-1][e.day-1]);return i}(i.getDayPosition(e),i.daysArray),e=d(e.target);if(e.hasClass("t-event-block")||e.closest(".t-event-block").length)return o(),!1;if(i.start)return o(),!1;{if(!t)return o(),!1;if(t.hasClass(n))return!1}a&&o();!function(e){e.addClass(n),a=e}(t)}).on("mouseleave",function(){o()})},TeamCalendar.prototype.onMouseUp=function(){var e,t=this;(t.start.week>t.end.week||t.start.week==t.end.week&&t.start.day>t.end.day)&&(e={week:t.start.week,day:t.start.day},t.start={week:t.end.week,day:t.end.day},t.end=e),t.createEvent(),t.start=!1,t.end=!1},TeamCalendar.prototype.initMove=function(){var i,n=this,o=n.$wrapper,e=o.find(".js-move-event"),s=!1,r=!1;e.draggable({helper:"clone",appendTo:"body",cursor:"move",zIndex:1100,cursorAt:{top:11,left:16},start:function(e,t){var e=d(e.target),t=t.helper,i=(s=e,parseInt(s.closest(".t-column").attr("colspan"))),a=e.data("move-hint")||!1;a&&t.find(".t-event-block").append("<span class='t-day-count'>("+a+")</span>"),t.addClass("is-clone").css({minWidth:parseInt(e.width()/i)+"px",height:e.height()+"px"})},drag:function(e,t){var i,a;r||(r=!0,setTimeout(function(){r=!1},100),e=e,i=[(a=o.offset()).left,a.left+o.outerWidth()],a=[a.top,a.top+o.outerHeight()],n.clearSelection(),e.pageX<=i[0])||e.pageX>=i[1]||e.pageY<=a[0]||e.pageY>=a[1]||(i=parseInt(s.data("day-count")||s.closest(".t-column").attr("colspan")),n.start=n.getDayPosition(e),n.end=function(e,t,i){var a={week:t.week,day:t.day},t=7-t.day;return(i-=1)<=t?a.day=a.day+i:(a.week=a.week+1,a.day=i-t,a.week>e.length&&(a={week:e.length,day:7})),a}(n.daysArray,n.start,i),n.markDays())},stop:function(e,t){n.clearSelection(),s=!1}}),o.droppable({drop:function(e){var t;e=n.getDayPosition(e),(e=n.daysArray[e.week-1][e.day-1])?(t=d.team.app_url+"?module=schedule&action=eventMove",e={id:parseInt(s.data("id")),start:e.data("date").replace(" 00:00:00","")},i&&i.abort(),i=d.post(t,e,function(e){"ok"==e.status&&n.reload()},"json")):console&&console.log&&console.log("error: date is not exist")}})},TeamCalendar.prototype.markDays=function(){for(var e,t,i=this,a=(i.deselectDays(),d.extend({},i.start)),n=d.extend({},i.end),o=(a.week>n.week&&(a=d.extend({},i.end),n=d.extend({},i.start)),a.week),s=n.week,r=o;r<=s;r++){o==s?(e=a.day,(t=n.day)<e&&(e=n.day,t=a.day)):t=r==o?(e=a.day,i.days_count):r==s?(e=1,n.day):(e=1,i.days_count);for(var l=e;l<=t;l++)!function(e,t){if(!(0<e&&0<t))return;e=i.daysArray[e-1][t-1];{if(!e.length)return console.log("Error: Day isn't exist");e.addClass(i.selected_class),i.$selectedDays.push(e)}}(r,l)}},TeamCalendar.prototype.getDayPosition=function(e){var t=this;t.wrapper_o=t.$wrapper.offset(),t.wrapper_w=t.$wrapper.width(),t.wrapper_h=t.$wrapper.height(),t.day_w=t.wrapper_w/t.days_count,t.day_h=t.wrapper_h/t.weeks_count;var i=e.pageY-t.wrapper_o.top,e=e.pageX-t.wrapper_o.left;return{week:parseInt(i/t.day_h)+(0<i%t.day_h?1:0),day:parseInt(e/t.day_w)+(0<e%t.day_w?1:0)}},TeamCalendar.prototype.deselectDays=function(){var e=this;e.$selectedDays.length&&(d.each(e.$selectedDays,function(){d(this).removeClass(e.selected_class)}),e.$selectedDays=[])},TeamCalendar.prototype.clearSelection=function(){this.deselectDays(),this.start=!1,this.end=!1},TeamCalendar.prototype.reload=function(){var t=this,e={};t.closeDialogs(),t.selected_user_id&&(e.user=t.selected_user_id),t.selected_calendar_id&&(e.calendar=t.selected_calendar_id),t.period_start&&(e.start=t.period_start),t.period_end&&(e.end=t.period_end),t.is_profile&&(e.period=1),d.get("?module=schedule&action=inc",e,function(e){d.team.calendar=!1,t.$wrapper.closest(".t-calendar-wrapper").replaceWith(e),d.team.profile.$calendar_wrapper=d(e)})},TeamCalendar.prototype.addDialog=function(e){this.dialogs.push(e)},TeamCalendar.prototype.closeDialogs=function(){var i=!1;return this.dialogs.length&&(d.each(this.dialogs,function(e,t){d.contains(document,t.$wrapper[0])&&(t.close(),i=!0)}),this.dialogs=[]),d("#ui-datepicker-div").length&&d(document).trigger("mousedown"),i},TeamCalendar}(jQuery),DayEventsDialog=function(i){return(DayEventsDialog=function(e){var t=this;t.$wrapper=e.$wrapper,t.event_view_uri="?module=schedule&action=eventView",t.dialog=!1,t.xhr=!1,t.initClass()}).prototype.initClass=function(){var t=this;t.$wrapper.on("click",".t-event-block.js-view-event",function(e){e.preventDefault(),t.showEventDetails(i(this).closest(".t-event-wrapper"))})},DayEventsDialog.prototype.showEventDetails=function(e){var t=this,e={"data[id]":e.data("id")};t.xhr&&(t.xhr.abort(),t.xhr=!1),t.xhr=i.post(t.event_view_uri,e,function(e){t.dialog=i.waDialog({html:e})})},DayEventsDialog}(jQuery),EventEditDialog=function(r){return(EventEditDialog=function(e){var t=this;t.$wrapper=e.$wrapper,t.$form=t.$wrapper.find("form"),t.$statusToggle=t.$wrapper.find(".t-status-toggle"),t.$calendarToggle=t.$wrapper.find(".js-calendar-dropdown"),t.$typeToggle=t.$wrapper.find(".t-type-toggle"),t.$userToggle=t.$wrapper.find(".js-user-dropdown"),t.$startAltField=t.$wrapper.find("input[name='data[start_alt]']"),t.$endAltField=t.$wrapper.find("input[name='data[end_alt]']"),t.$summaryField=t.$form.find("input[name='data[summary]']"),t.teamDialog=t.$wrapper.data("dialog"),t.active_class="is-active",t.extended_class="is-extended",t.selected_class="selected",t.has_error_class="state-error",t.locales=e.locales,t.event_id=e.event_id,t.calendars=e.calendars,t.users=e.users,t.$activeStatusToggle=t.$statusToggle.find("."+t.active_class)||!1,t.is_status=e.is_status,t.is_locked=!1,t.is_changed=!1,t.user_id=e.user_id,t.calendar_id=e.calendar_id,t.summary=e.summary,t.summary_type=e.summary_type,t.start_date_locale=!1,t.end_date_locale=!1,t.initClass()}).prototype.initClass=function(){var e=this;e.initDatePicker(),e.initTimePicker(),e.bindEvents(),e.setStatusLocale(),e.is_status&&e.generateStatusTypes()},EventEditDialog.prototype.bindEvents=function(){var t=this;t.$form.on("submit",function(e){return e.preventDefault(),t.is_locked||t.save(t.$form),!1}),t.$form.on("click",".js-delete-event",function(e){e.preventDefault(),t.is_locked||t.showDeleteConfirm()}),t.$statusToggle.on("click",".t-toggle-button",function(){return t.changeStatus(r(this)),t.changeColors(),!1}),t.$calendarToggle.on("click",".menu a",function(e){e.preventDefault(),t.changeCalendar(r(this))}),t.$startAltField.on("change",function(){t.setStatusLocale(),t.generateStatusTypes()}),t.$endAltField.on("change",function(){t.setStatusLocale(),t.generateStatusTypes()}),t.$summaryField.on("change",function(){t.summary=r(this).val(),t.summary_type="custom"}),t.$form.on("change","input[name='data[status_summary]']",function(){t.summary=r(this).val(),t.$summaryField.val(t.summary)}),t.$form.on("change",'textarea[name="data[description]"]',function(){var e=r(this).val();t.$form.find('textarea[name="data[status_description]"]').val(e)}),t.$form.on("change",'textarea[name="data[status_description]"]',function(){var e=r(this).val();t.$form.find('textarea[name="data[description]"]').val(e)}),t.$form.on("summaryChange",function(){t.$summaryField.val(t.summary)}),t.$userToggle.length&&t.$userToggle.on("click",".menu a",function(e){e.preventDefault(),t.changeUser(r(this))}),t.$form.on("change",".js-extended-date",function(){return t.dateToggle(r(this)),!1}),t.$form.find("input").on("mousedown",function(){var e=r(this);e.hasClass(t.has_error_class)&&e.removeClass(t.has_error_class).closest(".value").find(".state-error-hint").remove()}),t.$form.on("click",".js-datepicker-trigger, .js-timepicker-trigger",function(){r(this).parent().find("input").trigger("focus")})},EventEditDialog.prototype.initDatePicker=function(){this.$wrapper.find(".js-datepicker").each(function(){var e=r(this),t=e.closest(".t-date-wrapper").find("input[type='hidden']");e.datepicker({altField:t,altFormat:"yy-mm-dd",changeMonth:!0,changeYear:!0,shortYearCutoff:2,showOtherMonths:!0,selectOtherMonths:!0,stepMonths:2,numberOfMonths:2,beforeShow:function(e,t){t.dpDiv.on("click",function(e){e.stopPropagation()}),setTimeout(()=>t.dpDiv.css({"z-index":"1051"})),r(e).on("click",function(e){!function(){var e=!1,t=r("#ui-datepicker-div");t.length&&"none"!=t.css("display")&&(e=t);return e}()||(e.stopPropagation(),r(document).trigger("mousedown"))})}})})},EventEditDialog.prototype.initTimePicker=function(){this.$wrapper.find(".js-timepicker").each(function(){var i=r(this),a=!1;i.timepicker(),i.on("showTimepicker",function(){var e=i.data("timepicker-list"),t=(a||(e.on("click",function(e){e.stopPropagation()}),a=!0),parseInt(i.offset().top)+parseInt(i.outerHeight())-parseInt(r(window).scrollTop()));e.css({position:"fixed",top:t})})})},EventEditDialog.prototype.showDeleteConfirm=function(){var t=this,e={id:t.event_id};t.is_locked=!0,t.xhr&&(t.xhr.abort(),t.xhr=!1),t.xhr=r.get("?module=schedule&action=eventDeleteConfirm",e,function(e){r.waDialog({html:e}),t.is_locked=!1,t.close()})},EventEditDialog.prototype.changeColors=function(){var e={bg_color,font_color,status_bg_color,status_font_color}=this.calendars[this.calendar_id];this.setCalendarSelectColors(e)},EventEditDialog.prototype.changeStatus=function(e){var t,i,a=this;e.hasClass(a.active_class)||(i=e.data("status-id"),a.$activeStatusToggle&&a.$activeStatusToggle.removeClass(a.active_class+" "+a.selected_class),e.addClass(a.active_class+" "+a.selected_class),a.$activeStatusToggle=e,a.$form.find('input[name="data[is_status]"]').val(i).trigger("change"),e="is-event",t="is-status",(a.is_status=1==i)?(a.$wrapper.removeClass(e).addClass(t),(i=a.$form.find(".js-extended-date")).prop("checked")||i.click()):a.$wrapper.removeClass(t).addClass(e),a.generateStatusTypes(),a.teamDialog.resize())},EventEditDialog.prototype.changeCalendar=function(e){var t,i,a=this,n=e.closest("li"),o=n.data("calendar-id");n.hasClass(a.selected_class)||a.is_locked||(a.is_locked=!0,n={bg_color,font_color,status_bg_color,status_font_color}=a.calendars[o],t=r.wa.encodeHTML(e.text()),{prefix:e,icon:i}=e.find("svg").data(),a.calendar_id=o,a.$calendarToggle.find("."+a.selected_class).removeClass(a.selected_class),a.setCalendarSelectColors(n),a.$calendarToggle.find(".t-selected-item").html(`<i class="${e} fa-${i}"></i><span class="custom-ml-8">${t}</span>`),a.$form.find('input[name="data[calendar_id]"]').val(o).trigger("change"),a.$calendarToggle.find(".menu"),setTimeout(function(){a.is_locked=!1},500),a.generateStatusTypes())},EventEditDialog.prototype.setCalendarSelectColors=function(e){const t=this;t.$calendarToggle.find(".t-selected-item").css({color:()=>t.is_status?e.status_font_color||e.font_color:e.status_font_color?e.font_color:e.bg_color,"background-color":()=>t.is_status?e.status_bg_color||e.bg_color:e.status_bg_color?e.bg_color:"transparent","box-shadow":()=>t.is_status||e.status_bg_color?"none":"inset 0 0 0 1px currentColor"})},EventEditDialog.prototype.changeUser=function(e){var t,i=this,a=e.closest("li"),n=a.data("user-id");a.hasClass(i.selected_class)||i.is_locked||(i.is_locked=!0,a=e.data("user-photo-url"),e=r.wa.encodeHTML(e.text()),i.user_id=n,i.$userToggle.find("."+i.selected_class).removeClass(i.selected_class),i.$userToggle.find(".t-selected-item").html(`
                <img src="${a}" class="userpic userpic20">
                <span class="custom-ml-8">${e}</span>`),i.$form.find('input[name="data[contact_id]"]').val(n).trigger("change"),(t=i.$userToggle.find(".menu")).hide(),setTimeout(function(){t.removeAttr("style"),i.is_locked=!1},200))},EventEditDialog.prototype.save=function(e){var o=this,e=function(e){var i={},t=[];r.each(e,function(e,t){i[t.name]=t.value}),i["data[summary_type]"]||(i["data[summary_type]"]="custom");e=o.is_status;e&&(i["data[description]"]=i["data[status_description]"]||"",delete i["data[status_description]"],i["data[summary]"]=o.summary,delete i["data[status_summary]"]);r.trim(i["data[summary]"]).length||t.push(e?{field:"data[status_summary]",locale:"empty"}:{field:"data[summary]",locale:"empty"});i["data[start]"].match(/^(\d){4}-(\d){2}-(\d){2}$/)||t.push({field:"data[end]",locale:"date"});i["data[end]"].match(/^(\d){4}-(\d){2}-(\d){2}$/)||t.push({field:"data[end]",locale:"date"});var e=n(i["data[start]"]),a=n(i["data[end]"]);a<e&&(t.push({field:"data[start_alt]",locale:"period"}),t.push({field:"data[end_alt]",locale:"period"}));i["data[end_time]"]<i["data[start_time]"]&&(t.push({field:"data[start_time]",locale:"period"}),t.push({field:"data[end_time]",locale:"period"}));if(t.length)return function(e){o.$form.find(".state-error-hint").remove(),r.each(e,function(e,t){var i=o.$form.find("[name='"+t.field+"']");i.length&&(i.parent(".value").length?i.addClass(o.has_error_class).after('<span class="state-error-hint custom-mt-4">'+o.locales[t.locale]+"</span>"):i.addClass(o.has_error_class).closest(".t-date-wrapper").append('<div class="state-error-hint custom-mt-4">'+o.locales[t.locale]+"</div>"))})}(t),!1;i["data[start_time]"].length||(i["data[start_time]"]="00:00");i["data[end_time]"].length||(i["data[end_time]"]="00:00");return i["data[start]"]=i["data[start]"]+" "+i["data[start_time]"],i["data[end]"]=i["data[end]"]+" "+i["data[end_time]"],i["data[is_allday]"]=i["data[is_allday]"]?1:0,delete i["data[start_time]"],delete i["data[end_time]"],delete i["data[start_alt]"],delete i["data[end_alt]"],i;function n(e){var e=e.split("-"),t=parseInt(e[0]),i=parseInt(e[1]),e=parseInt(e[2]);return 0<t&&0<i&&0<e&&new Date(t,i-1,e)}}(e.serializeArray());o.is_locked=!0,e?r.post("?module=schedule&action=eventSave",e,function(e){var i;"ok"==e.status?(e.data&&e.data.message&&alert(e.data.message),o.reloadCalendar()):e.errors&&(i=null,r.each(e.errors,function(e,t){"redirect"===t[0]&&(i=t[1])}),i)&&(location.href=i),o.close(),o.is_locked=!1},"json"):o.is_locked=!1},EventEditDialog.prototype.reloadCalendar=function(){r.team.calendar.reload()},EventEditDialog.prototype.dateToggle=function(e){this.$form.find(".t-date-wrapper").toggleClass(this.extended_class,!e.prop("checked"))},EventEditDialog.prototype.generateStatusTypes=function(){var o=this,s=o.$typeToggle,e=function(){var e=s.find(".is-template li"),t=e.eq(0),e=e.eq(1),i=r("<ul></ul>"),a=o.calendars[o.calendar_id];a.default_status&&((n=t.clone()).find(".t-type").text(a.default_status),n.find("input:radio").val("default"),i.append(n));var n=t.clone(),n=(n.find(".t-type").text(a.name),n.find("input:radio").val("calendar"),i.append(n),t.clone()),n=(n.find(".t-type").text((a.default_status||a.name)+" "+o.locales.till+" "+o.end_date_locale),n.find("input:radio").val("till"),i.append(n),t.clone()),t=(n.find(".t-type").text((a.default_status||a.name)+" "+o.locales.from+" "+o.start_date_locale+" "+o.locales.till+" "+o.end_date_locale),n.find("input:radio").val("interval"),i.append(n),e.clone());t.find("input:radio").val("custom"),o.summary&&t.find("input:text").val(o.summary);return i.append(t),s.find(".value").html("").append(i),i}(),t=((t=e).on("change","input:radio",function(){var e=r(this),t=e.is(":checked"),i=e.closest("li").find(".t-type"),a=e.closest("li").find("input:text");if(t){if(i.length)o.summary=i.text();else{if(!a.length)return!1;o.summary=a.val()}o.summary_type=e.val(),o.$form.trigger("summaryChange")}}),t.on("focus set","input:text",function(){var e=r(this),t=e.closest("li").find("input:radio");t.is(":checked")||t.prop("checked",!0).trigger("change"),e.hasClass(o.has_error_class)&&e.removeClass(o.has_error_class).closest(".value").find(".state-error-hint").parent().remove()}),t.on("focus change keyup","input:text",function(){var e=r(this),t=e.val();o.summary=r("<div />").text(e.val()),t.length&&(o.summary_type="custom",o.summary=t)}),e);!o.summary_type&&o.summary&&(o.summary_type="custom"),o.summary_type?(e=t.find("input:radio[value='"+o.summary_type+"']")).length?(e.click(),"custom"!==o.summary_type&&t.find("input:text").val("")):"default"==o.summary_type?t.find("input[value='calendar']").click():t.find("input:text").val(o.summary||"").trigger("change"):t.find("input:radio:first").click()},EventEditDialog.prototype.setStatusLocale=function(){var s=this,e=s.$wrapper.find("input[name='data[start]']"),t=s.$wrapper.find("input[name='data[end]']");function i(e){var e=e.val().split(" ")[0].split("-"),t=parseInt(e[2]),i=parseInt(e[1]),e=parseInt(e[0]),a=(new Date).getFullYear(),n=s.locales.status_type.format,o=s.locales.status_type.months[i],n=(n=r.datepicker.formatDate(n,new Date(e,i-1,t))).replace("f",o);return n=a==e?n.replace(", "+e,"").replace(" "+e,"").replace(e+" ",""):n}s.start_date_locale=i(e),s.end_date_locale=i(t)},EventEditDialog.prototype.close=function(){this.teamDialog.close()},EventEditDialog}(jQuery),EventViewDialog=function(a){return(EventViewDialog=function(e){var t=this;t.$dialogWrapper=e.$wrapper,t.$wrapper=t.$dialogWrapper.find(".dialog-body"),t.event_id=e.event_id,t.event_edit_uri="?module=schedule&action=eventEdit",t.xhr=!1,t.initClass()}).prototype.initClass=function(){var t=this;t.$wrapper.on("click",".js-edit-event",function(e){e.preventDefault(),t.showEditForm()})},EventViewDialog.prototype.showEditForm=function(){var i=this,e={"data[id]":i.event_id};i.xhr&&(i.xhr.abort(),i.xhr=!1),i.xhr=a.post(i.event_edit_uri,e,function(e){i.$wrapper.offset();var t=a.team.calendar,e=(i.close(),a.waDialog({html:e}));t.addDialog(e)})},EventViewDialog.prototype.close=function(){this.$dialogWrapper.data("dialog").close()},EventViewDialog}(jQuery),EventDeleteDialog=function(i){return(EventDeleteDialog=function(e){var t=this;t.$wrapper=e.$wrapper,t.$block=t.$wrapper.find(".dialog-body"),t.event_id=e.event_id,t.is_locked=!1,t.initClass()}).prototype.initClass=function(){var t=this;t.$block.on("click",".js-delete-event",function(e){e.preventDefault(),t.is_locked||t.delete()})},EventDeleteDialog.prototype.delete=function(){var t=this,e={id:t.event_id};t.is_locked=!0,i.post("?module=schedule&action=eventDelete",e,function(e){"ok"==e.status&&(e.data&&e.data.message&&alert(e.data.message),t.$wrapper.data("dialog").close(),i.team.calendar.reload())})},EventDeleteDialog}(jQuery),GroupPage=function(n){return(GroupPage=function(e){var t=this;t.$wrapper=e.$wrapper,t.group_id=e.group_id,t.map_adapter=e.map_adapter,t.latitude=e.latitude,t.longitude=e.longitude,t.address=e.address,t.can_manage=e.can_manage,t.initClass()}).prototype.initClass=function(){var e=this;e.bindEvents(),e.can_manage&&(e.initEditableName(),e.initEditableDescription()),e.initInfoBlock(),e.initMap()},GroupPage.prototype.bindEvents=function(){var t=this;t.$wrapper.on("click",".js-open-map-link",function(){t.toggleMap()}),t.$wrapper.on("click",".js-edit-group",function(e){e.preventDefault(),t.group_id&&!GroupManage.is_locked&&GroupManage.prototype.showEditGroupDialog(t.group_id)}),t.$wrapper.on("click",".js-delete-group",function(e){e.preventDefault(),t.group_id&&!GroupManage.is_locked&&GroupManage.prototype.showDeleteDialog(t.group_id)})},GroupPage.prototype.toggleMap=function(){this.$wrapper.find(".t-map-wrapper").slideToggle(200)},GroupPage.prototype.initMap=function(){const t=this;function e(){var e=t.$wrapper.find("#t-location-map");const i=new TeamMap(e,t.map_adapter);""!==t.latitude&&""!==t.longitude?i.render(t.latitude,t.longitude):i.geocode(t.address,function(e,t){i.render(e,t)})}"yandex"===t.map_adapter?ymaps.ready(e):e()},GroupPage.prototype.initEditableName=function(){var e=this.$wrapper.find(".js-name-editable").first();e&&new TeamEditable(e,{groupId:this.group_id,reloadSidebar:!0,api:{save:n.team.app_url+"?module=group&action=save"},target:"data[name]"})},GroupPage.prototype.initEditableDescription=function(){var e=this.$wrapper.find(".js-desc-editable").first();e&&new TeamEditable(e,{groupId:this.group_id,api:{save:n.team.app_url+"?module=group&action=save"},target:"data[description]"})},GroupPage.prototype.initInfoBlock=function(){const t=this.$wrapper.find(".t-info-notice-wrapper");var e=t.find(".t-info-notice-toggle");const i=new n.store,a="team/empty_group_notice_hide";i.get(a)?t.hide():t.show(),e.on("click",function(e){e.preventDefault(),i.set(a,1),t.remove()})},GroupPage}(jQuery),GroupManage=function(r){return(GroupManage=function(e){var t=this;t.$wrapper=e.$wrapper,t.$groupUsersW=t.$wrapper.find(".t-users-list.is-used-list"),t.$groupUsersHint=t.$wrapper.find(".t-empty-users-in-group"),t.$otherUsersW=t.$wrapper.find(".t-users-list.is-unused-list"),t.$otherUsersHint=t.$wrapper.find(".t-empty-users-outside-group"),t.group_id=e.group_id,t.hidden_class="is-hidden",t.locales=e.locales,t.$sidebarLink=!1,t.is_locked=!1,t.xhr=!1,t.group_count=t.$groupUsersW.find(".t-user-wrapper").length,t.other_count=t.$otherUsersW.find(".t-user-wrapper").length,t.initClass()}).prototype.initClass=function(){this.bindEvents(),this.initAutoComplete(),this.initEditableName()},GroupManage.prototype.bindEvents=function(){var t=this;t.$wrapper.on("click",".js-edit-group",function(e){e.preventDefault(),t.group_id&&!t.is_locked&&t.showEditGroupDialog()}),t.$wrapper.on("click",".js-delete-group",function(e){e.preventDefault(),t.group_id&&!t.is_locked&&t.showDeleteDialog()}),t.$groupUsersW.on("click",".js-move-user",function(e){e.preventDefault(),t.is_locked||t.moveUser(r(this).closest(".t-user-wrapper"),!1)}),t.$otherUsersW.on("click",".js-move-user",function(e){e.preventDefault(),t.is_locked||t.moveUser(r(this).closest(".t-user-wrapper"),!0)})},GroupManage.prototype.showEditGroupDialog=function(e){var t=this,e={id:t.group_id||e};t.is_locked||(t.is_locked=!0,t.xhr&&(t.xhr.abort(),t.xhr=!1),t.xhr=r.get("?module=group&action=edit",e,function(e){r.waDialog({html:e}),t.is_locked=!1}))},GroupManage.prototype.showDeleteDialog=function(e){var t=this,i=r.team.app_url+"?module=group&action=deleteConfirm",e={id:t.group_id||e};t.is_locked||(t.is_locked=!0,t.xhr&&(t.xhr.abort(),t.xhr=!1),t.xhr=r.get(i,e,function(e){r.waDialog({html:e}),t.is_locked=!1}))},GroupManage.prototype.moveUser=function(e,t){var i,a=this,n={user_id:e.data("user-id"),group_id:a.group_id};a.is_locked||(a.xhr&&(a.xhr.abort(),a.xhr=!1),i=t?r.team.app_url+"?module=group&action=userAdd":r.team.app_url+"?module=group&action=userRemove",t?(a.$groupUsersW.append(e),a.group_count++,a.other_count--):(a.$otherUsersW.prepend(e),a.group_count--,a.other_count++),a.group_count<=0?(a.$groupUsersW.addClass(a.hidden_class),a.$groupUsersHint.removeClass(a.hidden_class)):(a.$groupUsersW.removeClass(a.hidden_class),a.$groupUsersHint.addClass(a.hidden_class)),a.other_count<=0?(a.$otherUsersW.addClass(a.hidden_class),a.$otherUsersHint.removeClass(a.hidden_class)):(a.$otherUsersW.removeClass(a.hidden_class),a.$otherUsersHint.addClass(a.hidden_class)),a.setCount(a.group_count),a.xhr=r.post(i,n,function(e){"ok"!==e.status&&console.error("Error while sending data on "+i,e),a.is_locked=!1}))},GroupManage.prototype.setCount=function(e){var t=this,i=r.team.app_url+"group/"+t.group_id+"/";t.$sidebarLink||(t.$sidebarLink=r.team.sidebar.$wrapper.find('a[href="'+i+'"] ')),t.$sidebarLink.length&&((t=t.$sidebarLink.closest("li")).find(".indicator").remove(),t.find(".count").text(e),r.team.sidebar.saveCount(i,e))},GroupManage.prototype.initAutoComplete=function(){var a=this,i=a.$wrapper.find(".t-autocomplete-wrapper .t-input"),t=!1,n=0;function o(){clearTimeout(n),t.length&&(t.remove(),t=!1)}function s(e){t=r('<span class="t-hint"><i class="fas fa-check text-green custom-mr-4"></i>'+e+"</span>"),i.after(t),n=setTimeout(o,1e3)}i.autocomplete({source:function(e,t){var i=r.team.app_url+"?module=autocomplete&type=user",e={term:e.term};a.group_id&&(e.group_id=a.group_id);r.post(i,e,function(e){t(e)},"json")},minLength:2,open:function(){o()},focus:function(){return!1},select:function(e,t){return t.item.id&&(t=t.item.id,(t=a.$otherUsersW.find(`.t-user-wrapper[data-user-id="${t}"]`)).length?(a.moveUser(t,!0),s(a.locales.added)):s(a.locales.in_group)),i.val(""),!1}})},GroupManage.prototype.initEditableName=function(){var e=this.$wrapper.find(".js-name-editable").first();e&&new TeamEditable(e,{groupId:this.group_id,reloadSidebar:!0,api:{save:r.team.app_url+"?module=group&action=save"},target:"data[name]"})},GroupManage}(jQuery),GroupEditDialog=function(p){return(GroupEditDialog=function(e){var t=this;t.$wrapper=e.$wrapper,t.$block=t.$wrapper.find(".dialog-body"),t.$form=t.$block,t.$iconToggle=t.$block.find(".t-icon-toggle"),t.$addressToggle=t.$block.find(".t-address-toggle"),t.$mapToggle=t.$block.find(".t-map-toggle"),t.$submitButton=t.$form.find('input[type="submit"]'),t.$groupType=t.$form.find('[name="data[type]"]'),t.selected_class="selected",t.hidden_class="hidden",t.has_error_class="state-error",t.locales=e.locales,t.dialog=t.$wrapper.data("dialog"),t.$activeIcon=t.$iconToggle.find("."+t.selected_class),t.is_locked=!1,t.save_timeout=0,t.is_map_loading=!1,t.map_type=e.map_type||"google",t.map_key=e.map_key||null,t.teamMap=null,t.bindEvents()}).prototype.bindEvents=function(){var i=this;i.$block.find(".js-type-toggle").waToggle({ready(e){"location"===e.$active.data("type")&&!i.teamMap&&i.map_key&&setTimeout(()=>i.teamMap=i.initMap(i.map_type,i.map_key))},change(e,t){i.setType(p(t)),"location"===t.dataset.type&&!i.teamMap&&i.map_key&&(i.teamMap=i.initMap(i.map_type,i.map_key))}}),i.$iconToggle.on("click",".t-icon-item",function(e){e.preventDefault(),i.setIcon(p(this))}),i.$form.on("submit",function(e){e.preventDefault(),i.is_locked||i.save()});i.$form.find("input, textarea").on("mousedown",function(){var e=p(this),t=e.hasClass(i.has_error_class);i.$form.find(".js-submit-loading").remove(),t&&e.removeClass(i.has_error_class).closest(".value").find(".state-error-hint").remove()});var e=i.$form.find(".t-icon-list");e.find(".t-icon-item.selected").length||i.setIcon(e.find(".t-icon-item:eq(0)"))},GroupEditDialog.prototype.setType=function(e){var t=this,i="group"===e.data("type");t.$groupType.val(e.data("type")),t.$iconToggle.toggleClass(t.hidden_class,!i),t.$addressToggle.toggleClass(t.hidden_class,i),t.$mapToggle.toggleClass(t.hidden_class,i),t.dialog.resize()},GroupEditDialog.prototype.setIcon=function(e){var t=this,i=e.data("icon-class");if(e.hasClass(t.selected_class))return!1;t.$activeIcon.length&&t.$activeIcon.removeClass(t.selected_class),t.$form.find('input[name="data[icon]"]').val(i).trigger("change"),e.addClass(t.selected_class),t.$activeIcon=e},GroupEditDialog.prototype.save=function(e){var i,a=this,t="?module=group&action=save";if(e=e||0,!a.is_locked)if(a.is_locked=!0,i=function(e){var i={},t=[];p.each(e,function(e,t){i[t.name]=t.value}),p.trim(i["data[name]"]).length||t.push({field:"data[name]",locale:"empty"});if(t.length)return function(e){a.$form.find(".state-error-hint").remove(),p.each(e,function(e,t){var i=a.$form.find("[name='"+t.field+"']");i.length&&i.addClass(a.has_error_class).after('<p class="state-error-hint custom-my-0">'+a.locales[t.locale]+"</p>")})}(t),!1;return i}(a.$form.serializeArray())){if(a.is_map_loading&&e<5)return a.is_locked=!1,a.save_timeout=setTimeout(function(){p.contains(document,a.$wrapper[0])&&a.save(e+1)},1e3),!1;a.$form.find(".js-submit-loading").remove(),a.$submitButton.parent().append("<i class='fas fa-spin fa-spinner js-submit-loading wa-animation-spin speed-1000'></i>");function n(){p.post(t,i,function(e){var t;"ok"==e.status&&(t=p.team.app_url+"group/"+e.data.id+"/manage/",p.team.content.load(t),p.team.sidebar.reload(),t=p.team.sidebar.$body.find(`[data-group-id="${e.data.id}"]`),p.team.sidebar.setItem(t),a.is_locked=!1,a.dialog.close())}).always(function(){a.$form.find(".js-submit-loading").remove()})}var o=i["data[location][address]"],s=i["data[location][latitude]"],r=i["data[location][longitude]"];!o||s&&r||!a.teamMap?n():a.teamMap.geocode(o,function(e,t){i["data[location][latitude]"]=e,i["data[location][longitude]"]=t,n()},function(){n()})}else a.is_locked=!1},GroupEditDialog.prototype.initMap=function(e){var a,n=this,t=(n.$block,n.$addressToggle.find(".f-location-edit-address-input")),o=n.$addressToggle.find(".t-location-longitude-input"),s=n.$addressToggle.find(".t-location-latitude-input"),r=n.$mapToggle.find(".t-location-edit-map"),l=n.$addressToggle.find(".t-map-hint"),d=0,i=(0<t.length&&(i=n.$form.find(".value").first().width(),r.width(i),r.height(i/1.618)),a=new TeamMap(r,e),o.val()),e=s.val();function c(e){function i(e,t){r.is(":hidden")&&r.show(),a.render(e,t),s.val(e),o.val(t),n.dialog.resize()}clearTimeout(d),"string"===p.type(e)?(n.is_map_loading=!0,a.geocode(e,function(e,t){s.val(e),o.val(t),l.hide(),i(e,t),n.is_map_loading=!1},function(){r.hide(),o.val(""),s.val(""),l.show(),n.is_map_loading=!1})):i(e.lat,e.lng)}return i&&e&&c({lat:e,lng:i}),t.on("change",function(){var e=p(this).val();e.length?c(e):(o.val(""),s.val(""),r.hide(400,()=>n.dialog.resize()))}),t.on("keyup",function(){clearTimeout(d);var e=p(this).val();e.length?(n.is_map_loading=!0,d=setTimeout(function(){c(e)},1e3)):(o.val(""),s.val(""),r.hide(400,()=>n.dialog.resize()))}),a},GroupEditDialog}(jQuery),GroupDeleteDialog=function(i){return(GroupDeleteDialog=function(e){var t=this;t.$wrapper=e.$wrapper,t.$block=t.$wrapper.find(".t-dialog-block"),t.$deleteButton=t.$wrapper.find(".js-delete-event"),t.api_enabled=window.history&&window.history.replaceState,t.group_id=e.group_id,t.is_locked=!1,t.dialog={},t.initClass()}).prototype.initClass=function(){var e=this;setTimeout(()=>{e.dialog=e.$wrapper.data("dialog")}),e.is_locked||e.$deleteButton.on("click",i.proxy(e.deleteFunction,e))},GroupDeleteDialog.prototype.deleteFunction=function(e){e.preventDefault();var t=this,e={id:t.group_id};t.is_locked=!0,i.post("?module=group&action=delete",e,function(e){"ok"==e.status&&(t.dialog.close(),t.api_enabled?(history.state.content_uri=i.team.app_url,history.replaceState({reload:!0,content_uri:i.team.app_url},"",i.team.app_url),i.team.sidebar.reload(),i.team.content.reload()):location.href=i.team.app_url)},"json")},GroupDeleteDialog}(jQuery),InvitePage=function(o){return(InvitePage=function(e){var t=this;t.$wrapper=e.$wrapper,t.$block=t.$wrapper.find(".t-invite-block"),t.$form=t.$wrapper.find("form"),t.errors=e.errors,t.error_class="error",t.backend_url=e.backend_url||"",t.is_locked=!1,t.initClass()}).prototype.initClass=function(){this.showErrors(),this.bindEvents(),this.initSubmit()},InvitePage.prototype.bindEvents=function(){var e=this;e.$form.on("keydown change","."+e.error_class,function(){o(this).removeClass(e.error_class).parent().find(".state-error-hint").remove()})},InvitePage.prototype.showErrors=function(){var i=this,a=i.$form,e=i.errors,n=a.find(":submit:first");o.each(e,function(e,t){e=a.find('[name="data['+e+']"]');e.length?e.addClass(i.error_class):e=n,e.parent().append(o('<div class="state-error-hint custom-mt-4 custom-ml-2"></div>').text(t))})},InvitePage.prototype.initSubmit=function(){this.$form.find('[type="submit"]').on("click",function(){setTimeout(()=>o(this).attr("disabled",!0))})},InvitePage}(jQuery),LongActionProcess=function(t){function i(){for(;0<m.length;){var e=m.shift();e&&clearTimeout(e)}}function e(e){if(!e.url)throw new Error("Url is required");p=e.url,f=e.step_delay||f,h=e.rest_delay||h,g=e.post_data||g,a=e.onCleanup,n=e.onReady,o=e.onProgress,s=e.onError,r=e.onWarning,l=e.onStart,d=e.onStop,c=e.onAlways,v=this}var a,n,o,s,r,l,d,c,p="",u="",f=500,h=750,m=[],g={},v=null,w=!1,_=function(){var e=t.extend(!0,{},g);e.processId=u,e.cleanup=1,t.post(p,e,function(e){a&&a(e)}).always(function(){i()})},y=function(e){w||(e=e||f,e=setTimeout(function(){var e=t.extend(!0,{},g);e.processId=u,t.post(p,e,function(e){e?e.ready?(n&&n.call(v,e),_()):e.error?s&&s.call(v,e):e.progress?(o&&o.call(v,e),y()):e.warning?(r&&r.call(v,e),y()):y(h):y(h),c&&c.call(v,e)},"json").error(function(){y(h)})},e),m.push(e))};return t.extend(e.prototype,{start:function(){l&&l();var e=t.extend(!0,{},g);t.post(p,e,function(e){e&&e.processId?(u=e.processId,y(100),y(200)):e&&e.error?s&&s.call(v,e):s&&s.call(v,"Server error")},"json").error(function(){s&&s.call(v,"Server error")})},stop:function(){w=!0,d&&d.call(v),i()}}),e}(jQuery),TeamMap=function(n){function a(e,t,i){var a=this;if(!e)throw Error("DOM element is required");a.$map=n(e),a.provider=t,a.provider&&["google","yandex","disabled"].indexOf(a.provider)<0&&console.error("Not supported map provider: %s".replace("%s",a.provider)),a.map_info=null,a.initClass()}return a.prototype.initClass=function(){},a.prototype.render=function(e,t){switch(this.provider){case"google":return this.googleRender(e,t);case"yandex":return this.yandexRender(e,t);default:return}},a.prototype.googleRender=function(e,t){const i=this;i.map_info=i.map_info||{};e=new google.maps.LatLng(e,t);i.map_info.map||(t={zoom:12,center:e,mapTypeId:google.maps.MapTypeId.ROADMAP},i.map_info.map=new google.maps.Map(i.$map.get(0),t)),i.map_info.marker&&i.map_info.marker.setMap(null),i.map_info.marker=new google.maps.Marker({position:e,map:i.map_info.map}),i.map_info.map.setCenter(e),a.google_error_html=a.google_error_html||"",setTimeout(function(){var e;i.$map.find(".gm-err-container").length?(i.$map.find(".gm-err-container").find(".gm-err-message").last().after('<div class="gm-err-message">'+n.team.locales.map_check_your_key+"</div>"),a.google_error_html=i.$map.find(".gm-err-container").parent().html()):i.$map.find(".gm-style").length||(a.google_error_html?i.$map.children().html(a.google_error_html):(e=(e=(e=(e='<div class="gm-err-container"><div class="gm-err-content"><div class="gm-err-icon"><img src="https://maps.gstatic.com/mapfiles/api-3/images/icon_error.png" draggable="false" style="user-select: none;"></div><div class="gm-err-title">:title:</div><div class="gm-err-message">:message1:</div><div class="gm-err-message">:message2:</div></div></div>').replace(":title:",n.team.locales.map_error_title)).replace(":message1:",n.team.locales.map_error_message)).replace(":message2:",n.team.locales.map_check_your_key),i.$map.children().html(e)))},5e3)},a.prototype.yandexRender=function(e,t){var i=this,e=(i.map_info=i.map_info||{},[e,t]);i.map_info.map||(t={zoom:12,center:e,controls:["zoomControl","fullscreenControl"]},i.map_info.map=new ymaps.Map(i.$map.get(0),t)),i.map_info.marker&&i.map_info.map.geoObjects.remove(i.map_info.marker),i.map_info.marker=new ymaps.Placemark(e,null,{preset:"islands#redDotIcon"}),i.map_info.map.geoObjects.add(i.map_info.marker),i.map_info.map.setCenter(e)},a.prototype.geocode=function(e,t,i){switch(this.provider){case"google":return this.googleGeocode(e,t,i);case"yandex":return this.yandexGeocode(e,t,i);default:i?i():t&&t()}},a.prototype.googleGeocode=function(e,i,a){var t=new google.maps.Geocoder;let n=!1,o=!1;t.geocode({address:e},function(e,t){n=!0,o||(t==google.maps.GeocoderStatus.OK?(t=e[0].geometry.location,i(t.lat(),t.lng())):a&&a())}),setTimeout(function(){n||(o=!0,a&&a(!0))},5e3)},a.prototype.yandexGeocode=function(e,i,a){ymaps.geocode(e,{results:1}).then(function(e){let t=1;(t=e.metaData&&e.metaData.geocoder&&"found"in e.metaData.geocoder?e.metaData.geocoder.found:t)<=0?a():(e=e.geoObjects.get(0).geometry.getCoordinates(),i(e[0],e[1]))},function(e){a(e)})},a}(jQuery),Profile=(!function(y){y.wa.fieldTypesFactory=function(p,e){"use strict";return(p=p||y.wa.contactEditorFactory()).baseFieldType||(p.baseFieldType={contactType:"person",options:{},createEditor:function(e){this.contactType=e||"person";e=y.extend({},this);return delete e.createEditor,delete e.initializeFactory,e.parentEditorData={},e.initialize(),e},fieldValue:"",initializeFactory:function(e,t){this.fieldData=e,this.options=t||{}},initialize:function(){this.setValue("")},reinit:function(){this.currentMode="null",this.initialize()},setValue:function(e){this.fieldValue=e,"null"!=this.currentMode&&null!==this.domElement&&("edit"==this.currentMode?this.domElement.find(".val").val(this.fieldValue):this.domElement.find(".val").html(y.wa.encodeHTML(this.fieldValue)))},getValue:function(){var e,t=this.fieldValue;return"edit"==this.currentMode&&null!==this.domElement&&0<(e=this.domElement.find(".val")).length&&(t="",e.hasClass("empty")||"checkbox"==e.attr("type")&&!e.prop("checked")||(t=e.val())),t},isModified:function(){return this.fieldValue!=this.getValue()},validate:function(e){var t=this.getValue();return e||!this.fieldData.required||t?null:$_("This field is required.")},newFieldElement:function(e){this.fieldData.read_only&&(e="view");var t,i=this.newInlineFieldElement(e);return null!==i||this.fieldData.show_empty&&"edit"!=e?("person"===this.contactType?0<=["firstname","middlename","lastname"].indexOf(this.fieldData.id)?(t="subname",i.find(".val").attr("placeholder",this.fieldData.name).attr("title",this.fieldData.name).addClass("small width-100-mobile")):"title"===this.fieldData.id?(t="subname title",i.find(".val").attr("placeholder",this.fieldData.name).attr("title",this.fieldData.name).addClass("small width-100-mobile")):"jobtitle"===this.fieldData.id?(t="jobtitle-company jobtitle",i.find(".val").addClass("small width-100-mobile")):"company"===this.fieldData.id&&(t="jobtitle-company company",i.find(".val").addClass("small width-100-mobile")):"company"===this.fieldData.id&&(t="company"),p.wrapper(i,this.fieldData.name+"",t).attr("data-field-id",this.fieldData.id)):y('<div style="display: none" class="field" data-field-id="'+this.fieldData.id+'"></div>')},newInlineFieldElement:function(e){var t,i;return"view"!=e||this.fieldValue?(t=y.isPlainObject(this.fieldValue)?this.fieldValue.value:this.fieldValue,i=null,"edit"==e?(i=y('<span class="width-100-mobile custom-mr-0-mobile"><input class="val small width-100-mobile" type="text"></span>')).find(".val").val(t):(i=y('<span class="val small"></span>')).text(t),i):null},showValidationErrors:function(e){var t;null!==this.domElement&&((t=this.domElement.find(".val")).nextAll(".state-error-hint").remove(),null!==e?(t.after(y('<p class="state-error-hint custom-mt-8">'+e+"</p>")),t.addClass("state-error")):t.removeClass("state-error"),p.dialog.resize())},fieldData:null,domElement:null,currentMode:"null",parentEditor:null,parentEditorData:null,setMode:function(e,t){if(void 0===t&&(t=!0),"view"!=e&&"edit"!=e)throw new Error("Unknown mode: "+e);return this.currentMode!=e&&(this.currentMode=e,t)&&(t=this.domElement,this.domElement=this.newFieldElement(e),null!==t)&&t.replaceWith(this.domElement),this.domElement}}),p.factoryTypes.Hidden=y.extend({},p.baseFieldType,{newFieldElement:function(e){e=this.newInlineFieldElement(e);return p.wrapper(e,this.fieldData.name).attr("data-field-id",this.fieldData.id).hide()},newInlineFieldElement:function(e){var t;return"view"!=e||this.fieldValue?(t=null,"edit"==e&&(t=y('<span><input type="hidden" class="val" type="text"></span>')).find(".val").val(this.fieldValue),t):null}}),p.factoryTypes.String=y.extend({},p.baseFieldType,{setValue:function(e){this.fieldValue=e,"null"!=this.currentMode&&null!==this.domElement&&("edit"==this.currentMode?this.domElement.find(".val").val(this.fieldValue):this.domElement.find(".val").html(y.wa.encodeHTML(this.fieldValue)))},getValue:function(){var e,t=this.fieldValue;return"edit"==this.currentMode&&null!==this.domElement&&(t="",(e=this.domElement.find(".val")).hasClass("empty")||(t=e.val())),t},newInlineFieldElement:function(e){var t,i;return"view"!=e||this.fieldValue?(i=null,t=this.fieldValue,"edit"==e?(i=this.fieldData.input_height<=1?y('<span><input class="val small" type="text"><i class="fas fa-spinner fa-spin loading wa-animation-spin speed-1000" style="display:none;"></i></span>'):y('<span><textarea class="val small width-100" rows="'+this.fieldData.input_height+'"></textarea></span>')).find(".val").val(t):i=this.fieldData.input_height<=1?y('<span class="val small"></span><i class="fas fa-spinner fa-spin loading wa-animation-spin speed-1000" style="display:none;">').text(t):(e=y.wa.encodeHTML(t||"").replace(/\n/g,"<br>"),y('<span class="val small"></span><i class="fas fa-spinner fa-spin loading wa-animation-spin speed-1000" style="display:none;">').html(e)),i):null},setMode:function(e,t){if(void 0===t&&(t=!0),"view"!=e&&"edit"!=e)throw new Error("Unknown mode: "+e);return this.currentMode!=e&&(this.currentMode=e,t)&&(t=this.domElement,this.domElement=this.newFieldElement(e),null!==t)&&t.replaceWith(this.domElement),this.domElement}}),p.factoryTypes.Text=y.extend({},p.factoryTypes.String),p.factoryTypes.Phone=y.extend({},p.baseFieldType),p.factoryTypes.Select=y.extend({},p.baseFieldType,{notSet:function(){return""},newInlineFieldElement:function(e){if("view"==e&&!this.fieldValue)return null;if("view"==e)return y('<span class="val small"></span>').text(this.fieldData.options[this.fieldValue]||this.fieldValue);for(var t="",i=!1,a=0;a<this.fieldData.oOrder.length;a++){var n=this.fieldData.oOrder[a],o=!i&&n==this.fieldValue&&this.fieldValue?(i=!0," selected"):"";""===n&&(o+=" disabled");var s=y.wa.encodeHTML(n="string"==typeof(n=n||"")?n:""+n).replace('"',"&quot;");t+='<option value="{$id}" {$attrs}>{$text}</option>'.replace("{$id}",s).replace("{$attrs}",o).replace("{$text}",y.wa.encodeHTML(this.fieldData.options[n]))}return y('<div class="wa-select small width-100-mobile"><select class="val '+(this.fieldData.type+"").toLowerCase()+'"><option value=""'+(i?"":" selected")+">"+this.notSet()+"</option>"+t+"</select></div>")}}),p.factoryTypes.Conditional=y.extend({},p.factoryTypes.Select,{unbindEventHandlers:function(){},getValue:function(){var e,t=this.fieldValue;return t="edit"==this.currentMode&&null!==this.domElement&&0<(e=this.domElement.find(".val:visible")).length?e.hasClass("empty")?"":e.val():t},newInlineFieldElement:function(e){if("view"==e&&!this.fieldValue)return null;if(this.unbindEventHandlers(),"view"==e)return y("<div></div>").append(y('<span class="val"></span>').text(this.fieldData.options&&this.fieldData.options[this.fieldValue]||this.fieldValue));for(var t,a,n,o,i,s=this,r=(s.fieldData.parent_field||"").split(":"),l=p.fieldEditors[r.shift()];l&&r.length;){var d=l.subfieldEditors;if(d instanceof Array){for(var l=null,c=0;c<d.length;c++)if(d[c]===s.parentEditor){l=d[c];break}}else l=d[r.shift()]}return l?(t=this.fieldData.options&&this.fieldData.options[this.fieldValue]||this.fieldValue,a=y('<input type="text" class="hidden val">').val(t),n=y('<select class="hidden val"></select>').hide(),o=function(){return a.is(":visible")?a.val():n.is(":visible")?n.val():t},i=function(){var e=y(this),t=o(),e=(e.val()||"").toLowerCase(),i=s.fieldData.parent_options[e];if(i){for(a.hide(),n.show().children().remove(),c=0;c<i.length;c++)n.append(y("<option></option>").attr("value",i[c]).text(i[c]).attr("selected",s.fieldValue==i[c]));n.val(t)}else a.val(t||"").show().blur(),n.hide()},setTimeout(function(){var e;l.domElement?(l.domElement.on("change",".val",i),(e=l.domElement.find(".val:visible")).length&&i.call(e.get(0))):a.show()},0),s.unbindEventHandlers=function(){l.domElement&&l.domElement.find(".val").unbind("change",i),s.unbindEventHandlers=function(){}},y("<div></div>").append(a).append(n)):y("<div></div>").append(y('<input type="text" class="val small width-100-mobile">').val(s.fieldValue))}}),p.factoryTypes.Timezone=y.extend({},p.factoryTypes.Select,{notSet:function(){return $_("Auto")}}),p.factoryTypes.Region=y.extend({},p.factoryTypes.Select,{notSet:function(){return""},unbindEventHandlers:function(){},setCurrentCountry:function(){var e=this.current_country;return this.current_country=this.parentEditorData.parent.subfieldEditors.country.getValue(),e!==this.current_country&&(delete this.fieldData.options,!0)},getRegionsControllerUrl:function(e){return p.getRegionsUrl()+e},newInlineFieldElement:function(a){if("view"==a&&!this.fieldValue)return null;this.unbindEventHandlers();var n,e,t,i=this.options||{};return void 0!==i.country&&(this.current_country=i.country),"view"==a?y("<div></div>").append(y('<span class="val"></span>').text(this.fieldData.options&&this.fieldData.options[this.fieldValue]||this.fieldValue)):((n=this).parentEditorData.parent&&this.parentEditorData.parent.subfieldEditors.country&&(this.setCurrentCountry(),y(document).on("change","select.country",e=function(){var t,i,e;n.setCurrentCountry()&&(t="",e=n.domElement.find(".val"),t=(e.is("input")?e.val():e.find(":selected").text()).trim(),i=function(e,t){var i=t.toLocaleLowerCase();e.find("option").each(function(){if(y(this).text().trim().toLocaleLowerCase()===i)return y(this).attr("selected",!0),!1})},n.domElement.empty().append(n.newInlineFieldElement(a).children()),(e=n.domElement.find(".val")).is("input")&&!e.val()?e.val(t):e.is("select")&&t?i(e,t):n.domElement.unbind("load.fieldTypes").bind("load.fieldTypes",function(){var e=n.domElement.find(".val");e.is("select")&&t&&i(e,t)}))}),n.unbindEventHandlers=function(){y(document).off("change","select.country",e),n.unbindEventHandlers=function(){}}),!i.no_ajax_select&&void 0===this.fieldData.options&&this.current_country&&this.fieldData.region_countries[this.current_country]?(t=this.current_country,y.get(this.getRegionsControllerUrl(t),function(e){a===n.currentMode&&t===n.current_country&&(n.fieldData.options=e.data.options||!1,n.fieldData.oOrder=e.data.oOrder||[],y.isPlainObject(n.options)&&void 0!==n.options.country&&delete n.options.country,y("<div></div>").append(n.newInlineFieldElement(a).children()),n.domElement.empty().append(n.newInlineFieldElement(a).children()),n.domElement.trigger("load"))},"json"),y("<div></div>").append(y('<i class="icon16 loading"></i>'))):this.fieldData.options?y("<div></div>").append(p.factoryTypes.Select.newInlineFieldElement.call(this,a)):((i=y("<div></div>").append(p.baseFieldType.newInlineFieldElement.call(this,a))).find(".val").attr("placeholder",this.fieldData.name+(this.fieldData.required?" ("+$_("required")+")":"")).addClass("small width-100-mobile"),i))}}),p.factoryTypes.Country=y.extend({},p.factoryTypes.Select),p.factoryTypes.Checklist=y.extend({},p.baseFieldType,{validate:function(e){return null},setValue:function(e){if(this.fieldValue=e,"edit"==this.currentMode&&this.domElement)for(var t in this.domElement.find('input[type="checkbox"]').attr("checked",!1),this.fieldValue)this.domElement.find('input[type="checkbox"][value="'+t+'"]').attr("checked",!0);else"view"==this.currentMode&&this.domElement&&this.domElement.find(".val").html(this.getValueView())},getValue:function(){var i;return"edit"==this.currentMode&&this.domElement?(i=[],this.domElement.find('input[type="checkbox"]:checked').each(function(e,t){i.push(y(t).val())}),i):this.fieldValue},getValueView:function(){for(var e="",t=0;t<this.fieldData.oOrder.length;t++){var i=this.fieldData.oOrder[t];this.fieldValue.indexOf(i)<0||(e+=(e?", ":"")+'<a href="'+(this.fieldData.hrefPrefix||"#")+i+'">'+(this.fieldData.options[i]&&p.htmlentities(this.fieldData.options[i])||$_("&lt;no name&gt;"))+"</a>")}return e||$_("&lt;none&gt;")},newInlineFieldElement:function(e){if(!("view"!=e||this.fieldValue&&this.fieldValue.length))return null;if("view"==e)return y('<span class="val"></span>').html(this.getValueView());var t,i=0;for(t in this.fieldData.options)if(1<++i)break;if(!i)return null;for(var a="",n=0;n<this.fieldData.oOrder.length;n++)a+='<li><label><span class="wa-checkbox"><input type="checkbox" value="'+(t=this.fieldData.oOrder[n])+'"',this.fieldData.disabled&&this.fieldData.disabled[t]&&(a+=' disabled="disabled"'),-1!==(this.fieldValue||[]).indexOf(t)&&(a+=' checked="checked"'),a+=' /><span><span class="icon"><i class="fas fa-check"></i></span></span></span>'+(this.fieldData.options[t]&&p.htmlentities(this.fieldData.options[t])||$_("&lt;no name&gt;"))+"</label></li>";return p.initCheckboxList('<div class="c-checkbox-menu-container val"><div><ul class="menu c-checkbox-menu">'+a+"</ul></div></div>")}}),p.factoryTypes.Name=y.extend({},p.baseFieldType,{newInlineFieldElement:null,newFieldElement:function(e){return y('<div style="display: none;" class="field" data-field-id="'+this.fieldData.id+'"></div>')},setValue:function(e){this.fieldValue=e},getValue:function(e){return this.fieldValue&&!e?this.fieldValue:(e=[],"person"==this.contactType?(p.fieldEditors.firstname&&e.push(p.fieldEditors.firstname.getValue()),p.fieldEditors.middlename&&e.push(p.fieldEditors.middlename.getValue()),p.fieldEditors.lastname&&e.push(p.fieldEditors.lastname.getValue())):p.fieldEditors.company&&e.push(p.fieldEditors.company.getValue()),e.join(" ").trim())},validate:function(e){var t=this.getValue(!0);if(!e&&this.fieldData.required&&!t){e=y("#"+this.options.el+" input:visible:text[value]:not(.empty)").val();if(!e)return $_("At least one of these fields must be filled");p.fieldEditors.firstname.setValue(e)}return null},showValidationErrors:function(e){for(var t,i=y("#"+this.options.el),a=(i.find("div.wa-errors-block").remove(),null!==e&&(t=y('<div class="field wa-errors-block"><div class="value"><p class="state-error-hint custom-mt-8">'+e+"</p></div></div>"),p.fieldEditors.lastname?p.fieldEditors.lastname.domElement.after(t):i.prepend(t)),["firstname","middlename","lastname"]),n=0;n<a.length;n++){var o=a[n];p.fieldEditors[o]&&(null!==e?p.fieldEditors[o].domElement.find(".val").addClass("state-error"):p.fieldEditors[o].domElement.find(".val").removeClass("state-error"))}},setMode:function(e,t){if(void 0===t&&(t=!0),"view"!=e&&"edit"!=e)throw new Error("Unknown mode: "+e);this.currentMode!=e&&(this.currentMode=e,t)&&(t=this.domElement,this.domElement=this.newFieldElement(e),null!==t)&&t.replaceWith(this.domElement);return p.fieldEditors.title&&p.fieldEditors.title.getValue(),this.domElement}}),p.factoryTypes.NameSubfield=y.extend({},p.baseFieldType,{}),p.factoryTypes.Multifield=y.extend({},p.baseFieldType,{subfieldEditors:null,subfieldFactory:null,emptySubValue:null,initializeFactory:function(e){if(this.fieldData=e,void 0!==this.fieldData.ext)for(var t in this.fieldData.extKeys=[],this.fieldData.extValues=[],this.fieldData.ext)this.fieldData.extKeys[this.fieldData.extKeys.length]=t,this.fieldData.extValues[this.fieldData.extValues.length]=this.fieldData.ext[t]},initialize:function(){this.subfieldFactory=y.extend({},p.factoryTypes[this.fieldData.type]),(this.subfieldFactory.parentEditor=this).subfieldFactory.initializeFactory(y.extend({},this.fieldData)),this.fieldData=y.extend({},this.fieldData,{required:this.subfieldFactory.fieldData.required}),this.subfieldEditors=[this.subfieldFactory.createEditor(this.contactType)],y.isPlainObject(this.subfieldEditors[0].fieldValue)?this.emptySubValue=y.extend({},this.subfieldEditors[0].fieldValue):this.emptySubValue={value:this.subfieldEditors[0].fieldValue},this.fieldData.ext&&(this.emptySubValue.ext=this.fieldData.extKeys[0]),this.fieldValue=[this.emptySubValue]},setValue:function(e){e&&void 0!==e[0]||(e=[this.emptySubValue]),this.fieldValue=e;var t=0;do{if(this.subfieldEditors.length<=t&&(this.subfieldEditors[t]=this.subfieldFactory.createEditor(this.contactType),"null"!=this.currentMode)&&this.subfieldEditors[t].setMode(this.currentMode).insertAfter(this.subfieldEditors[t-1].parentEditorData.domElement),void 0===e[t])throw new Error("At least one record must exist in data at this time.");var i,a,n,o=!1;for(i in e[t])if("value"!=i&&"ext"!=i&&"status"!=i){o=!0;break}}while(this.subfieldEditors[t].setValue(o?e[t]:e[t].value||""),void 0!==this.fieldData.ext&&(a=e[t].ext,"null"!=this.currentMode)&&this.subfieldEditors[t].parentEditorData.domElement&&0<(n=this.subfieldEditors[t].parentEditorData.domElement.find("input.ext")).size()&&n[0].setExtValue(a),++t<e.length);if(e.length<this.subfieldEditors.length){for(t=e.length;t<this.subfieldEditors.length;t++)0!==t&&"null"!=this.currentMode&&this.subfieldEditors[t].parentEditorData.domElement.remove();var s=0<e.length?e.length:1;this.subfieldEditors.splice(s,this.subfieldEditors.length-s)}this.origFieldValue=null},getValue:function(){if("null"==this.currentMode)return y.extend({},this.fieldValue);for(var e=[],t=0;t<this.subfieldEditors.length;t++){var i,a,n=this.subfieldEditors[t];e[t]={value:n.getValue()},void 0!==this.fieldData.ext&&(i=this.fieldValue[t].ext,a=n.parentEditorData.domElement.find("input.ext")[0],"edit"==n.currentMode&&a&&(i=a.getExtValue()),e[t].ext=i)}return e},isModified:function(){for(var e=0;e<this.subfieldEditors.length;e++)if(this.subfieldEditors[e].isModified())return!0;return!1},validate:function(e){for(var t=[],i=!0,a=0;a<this.subfieldEditors.length;a++){var n=this.subfieldEditors[a],o=n.validate(!0),o=(o&&(t[a]=o),n.getValue());!o&&"string"==typeof o||(i=!1)}return!e&&this.fieldData.required&&i&&(t[0]="This field is required."),t.length<=0?null:t},showValidationErrors:function(e){for(var t=0;t<this.subfieldEditors.length;t++){var i=this.subfieldEditors[t];null!==e&&void 0!==e[t]?i.showValidationErrors(e[t]):i.showValidationErrors(null)}},deleteSubfieldButton:function(t){var i=this,e=y('<a class="delete-subfield text-red custom-mt-8 custom-mt-0-mobile" title="'+$_("delete")+'" href="javascript:void(0)"><i class="fas fa-trash-alt icon size-14"></i></a>').click(function(){var e;return i.subfieldEditors.length<=1||(e=i.subfieldEditors.indexOf(t),"null"!=i.currentMode&&i.subfieldEditors[e].parentEditorData.domElement.remove(),i.subfieldEditors.splice(e,1),i.subfieldEditors.length<=1&&i.domElement.find(".delete-subfield").hide()),!1});return this.subfieldEditors.length<=1&&e.hide(),e},newSubFieldElement:function(e,t){var i,a,n=this.subfieldEditors[t=+t];if(n.parentEditorData||(n.parentEditorData={}),n.parentEditorData.parent=this,n.parentEditorData.empty=!1,"function"!=typeof n.newInlineFieldElement)return s="",0!=t&&"Composite"!==this.fieldData.type||(s=this.fieldData.name+""),o=(s=p.wrapper('<span class="replace-me-with-value"></span>',s,"no-bot-margins")).find("span.replace-me-with-value"),i=this.fieldValue[t].ext,i="edit"==e?p.createExtSelect(this.fieldData.ext,i):(i=this.fieldData.ext[this.fieldValue[t].ext]||i,y("<strong>"+p.htmlentities(i)+"</strong>")),o.before(i),"edit"==e&&o.before(this.deleteSubfieldButton(n)),o.remove(),n.domElement=this.subfieldEditors[t].newFieldElement(e),a=this,n.domElement.find("div.name").each(function(e,t){t.innerHTML.substr(0,a.fieldData.name.length)===a.fieldData.name&&(t.innerHTML="")}),o="","Composite"===this.fieldData.type&&(o="field-composite-subfields-block"),n.domElement.data("multifield-index",t).attr("data-multifield-index",t),n.parentEditorData.domElement=y('<div class="'+o+'"></div>').append(s).append(n.domElement),n.parentEditorData.empty="edit"!=e&&!n.fieldValue.value&&!n.fieldData.show_empty,n.parentEditorData.domElement;var o=n.newInlineFieldElement(e);if(null===o)return n.parentEditorData.domElement=n.domElement=y("<div></div>"),n.parentEditorData.empty=!0,n.parentEditorData.domElement;n.domElement=o,n.domElement.data("multifield-index",t).attr("data-multifield-index",t);var s=y('<div class="value flexbox space-12 wrap-mobile"></div>').append(o),o=s.find(".replace-with-ext");return o.size()<=0&&(s.append('<span class="flexbox wide space-12"><span class="replace-with-ext"></span></span>'),o=s.find(".replace-with-ext")),void 0!==this.fieldData.ext&&(i=this.fieldValue[t].ext,"edit"==e?o.before(p.createExtSelect(this.fieldData.ext,i)):(i=this.fieldData.ext[this.fieldValue[t].ext]||i,0<o.parents(".ext").size()?o.before(p.htmlentities(i)):o.before(y('<span class="hint" style="align-self: flex-end;"></span>').text(" "+i)))),"edit"==e&&o.before(this.deleteSubfieldButton(n)),o.remove(),n.parentEditorData.domElement=s},newInlineFieldElement:null,newFieldElement:function(n){for(var e,t,o=this,s=(this.fieldData.read_only&&(n="view"),y('<div class="multifield-subfields"></div>')),i="function"==typeof this.subfieldFactory.newInlineFieldElement,a=!0,r=0;r<this.subfieldEditors.length;r++){var l=this.newSubFieldElement(n,r);l.data("subfieldEditor",this.subfieldEditors[r]),"edit"===n&&l.prepend('<span class="sort sort-handler custom-mr-16 custom-mt-8 custom-mt-0-mobile"><i class="fas fa-grip-vertical text-light-gray"></i></span>'),s.append(l),a=a&&this.subfieldEditors[r].parentEditorData.empty}return a&&!this.fieldData.show_empty?y('<div style="display: none;" class="field" data-field-id="'+this.fieldData.id+'"></div>'):(t=y(i?'<div class="value"></div>':'<div class="field" data-field-id="'+this.fieldData.id+'"></div>').append(s),"edit"==n&&(e=i?y('<div class="value multifield-subfields-add-another"><span class="replace-me-with-value"></span></div>'):p.wrapper('<span class="replace-me-with-value"></span>'),o=this,e.find(".replace-me-with-value").replaceWith(y('<a href="javascript:void(0)" class="button rounded outlined small light-gray custom-mb-16"><i class="fas fa-plus"></i> '+$_("Add another")+"</a>").click(function(e){var t=o.subfieldFactory.createEditor(this.contactType),i=o.subfieldEditors.length,a={value:t.getValue(),temp:!0},a=(void 0!==o.fieldData.ext&&(a.ext=""),o.fieldValue[i]=a,o.subfieldEditors[i]=t,"null"!=o.currentMode&&t.setMode(o.currentMode),o.newSubFieldElement(n,i));a.data("subfieldEditor",o.subfieldEditors[i]),a.prepend('<span class="sort sort-handler custom-mr-16 custom-mt-8 custom-mt-0-mobile"><i class="fas fa-grip-vertical text-light-gray"></i></span>'),s.append(a),p.dialog.resize()})),t.append(e),this.fieldData.multi&&y.fn.sortable?t.find(".multifield-subfields").sortable({direction:"vertical",handle:".sort-handler",animation:150,onEnd(e){let t=y(e.item),i=t.closest(".multifield-subfields"),a=0;i.find("[data-multifield-index]").each(function(){var e=y(this);o.subfieldEditors[a]=e.parent().data("subfieldEditor"),e.data("subfieldIndex",a).attr("data-multifield-index",a),a++})}}):console.log(["$.fn.sortable available?",!!y.fn.sortable])),i&&(t=p.wrapper(t,this.fieldData.name+"").attr("data-field-id",this.fieldData.id)),t)},setMode:function(e,t){if(void 0===t&&(t=!0),"view"!=e&&"edit"!=e)throw new Error("Unknown mode: "+e);if(this.currentMode!=e){if("view"==e&&"edit"==this.currentMode&&this.origFieldValue)this.setValue(this.origFieldValue);else if("view"==this.currentMode&&!this.origFieldValue){this.origFieldValue=[];for(var i=0;i<this.fieldValue.length;i++)this.origFieldValue.push(y.extend({},this.fieldValue[i]))}this.currentMode=e,t&&(t=this.domElement,this.domElement=this.newFieldElement(e),null!==t)&&t.replaceWith(this.domElement)}for(i=0;i<this.subfieldEditors.length;i++)this.subfieldEditors[i].setMode(e,!1);return this.domElement}}),p.factoryTypes.Composite=y.extend({},p.baseFieldType,{subfieldEditors:null,initializeFactory:function(e,t){if(this.fieldData=e,this.fieldData.required){for(var i in this.fieldData.required)if(this.fieldData.required[i]){this.fieldData.required=!0;break}!0!==this.fieldData.required&&(this.fieldData.required=!1)}this.options=t||{}},initialize:function(){var e,t={data:{},value:""};for(e in this.subfieldEditors={},this.fieldData.subfields=this.fieldData.fields,this.fieldData.subfields){var i=this.fieldData.subfields[e],i=y.extend({},p.factoryTypes[i.type]),a=this.fieldData.fields[e],a=(this.fieldData.required&&this.fieldData.required[e]&&(a.required=!0),y.extend({},a,{id:null,multi:!1}));i.initializeFactory(a,this.options),i.parentEditor=this,i.parentEditorData={},i.initialize(),i.parentEditorData.sfid=e,(i.parentEditorData.parent=this).subfieldEditors[e]=i,t.data[e]=i.getValue()}this.fieldValue=t},setValue:function(e){if(e)for(var t in this.fieldValue=e,this.subfieldEditors){var i=this.subfieldEditors[t];void 0===e.data?(i.initialize(),i.setValue(i.getValue())):void 0!==e.data[t]?i.setValue(e.data[t]):i.setValue(i.getValue())}},getValue:function(){if("null"==this.currentMode)return y.extend({},this.fieldValue.data);var e,t={};for(e in this.subfieldEditors){var i=this.subfieldEditors[e];t[e]=i.getValue()}return t},isModified:function(){for(var e in this.subfieldEditors)if(this.subfieldEditors[e].isModified())return!0;return!1},validate:function(e){var t,i={},a=!1;for(t in this.subfieldEditors){var n=this.subfieldEditors[t].validate(e);n&&(i[t]=n,a=!0)}return a?i:null},showValidationErrors:function(e){if(null!==this.domElement)for(var t in this.subfieldEditors){var i=this.subfieldEditors[t];null!==e&&void 0!==e[t]?i.showValidationErrors(e[t]):i.showValidationErrors(null)}},newInlineFieldElement:null,newFieldElement:function(e){if("view"==(e=this.fieldData.read_only?"view":e)&&!this.fieldValue.value&&!this.fieldData.show_empty)return y('<div style="display: none;" class="field" data-field-id="'+this.fieldData.id+'"></div>');var t,i=y('<div class="composite '+e+'" data-field-id="'+this.fieldData.id+'"></div>').append(p.wrapper('<span style="display:none" class="replace-with-ext"></span>',this.fieldData.name,"hdr"));for(t in this.subfieldEditors){var a=this.subfieldEditors[t],n=a.newFieldElement(e);n.attr("data-field-id",t),n.data("fieldId",t),a.domElement=n,i.append(n)}return i},setMode:function(e,t){if(void 0===t&&(t=!0),"view"!=e&&"edit"!=e)throw new Error("Unknown mode: "+e);for(var i in this.currentMode!=e&&(this.currentMode=e,t)&&(t=this.domElement,this.domElement=this.newFieldElement(e),null!==t)&&t.replaceWith(this.domElement),this.subfieldEditors)this.subfieldEditors[i].setMode(e,!1);return this.domElement}}),p.factoryTypes.Address=y.extend({},p.factoryTypes.Composite,{showValidationErrors:function(e){if(null!==this.domElement&&(this.domElement.find(".state-error-hint").remove(),this.domElement.find(".val").removeClass("state-error"),e))for(var t in this.subfieldEditors){var i=this.subfieldEditors[t];void 0!==e[t]&&i.domElement.find(".val").addClass("state-error").parents(".address-subfield").append(y('<p class="state-error-hint custom-mt-8">'+e[t]+"</p>"))}},newInlineFieldElement:function(e){if("view"==e)return this.fieldValue.value?(e=this.fieldValue.for_map.map_url||"",y('<div class="address-field width-100-mobile"></div>').append('<span class="small">'+this.fieldValue.value+"</span>").append('<span style="display:none" class="replace-with-ext"></span> ').append('<a target="_blank" href="'+e+'" class="map-link small">'+$_("map")+'<i class="fas fa-external-link-alt small custom-ml-4"></i></a>')):null;var t,i=y('<div class="address-field width-100-mobile"></div>');for(t in i.append('<span style="display:none" class="replace-with-ext"></span>'),this.subfieldEditors){var a=this.subfieldEditors[t],n=a.newInlineFieldElement("edit");a.domElement=n,"Hidden"!==a.fieldData.type?i.append(y('<div class="address-subfield custom-mt-12"></div>').append(n)):i.append(y('<div class="address-subfield"></div>').append(n)),"Hidden"!==a.fieldData.type&&(a=a.fieldData.name+(a.fieldData.required?" ("+$_("required")+")":""),n.find("input.val,textarea.val").attr("placeholder",a).attr("title",a).addClass("small width-100-mobile"))}return i}}),p.factoryTypes.Birthday=y.extend({},p.baseFieldType,{newInlineFieldElement:function(e){if(this.fieldValue=this.fieldValue||{},"view"==e&&!this.fieldValue.value)return null;var t=null,i=this.fieldValue.data||{};if("edit"==e){var a,e=y('<div class="wa-select small"></div>'),n=y('<select class="val" data-part="day"><option data=""></option></select>');for(a of[...Array(32).keys()].slice(1)){var o=y('<option data="'+a+'" value="'+a+'">'+a+"</option>");a===+i.day&&o.attr("selected",!0),n.append(o)}e.append(n);var s,r,l=y('<div class="wa-select small"></div>'),d=y('<select class="val" data-part="month"><option data=""></option></select>'),c=["January","February","March","April","May","June","July","August","September","October","November","December"];for([s,r]of c.entries()){var p=s+1,u=$_(c[s]),u=y('<option data="'+p+'" value="'+p+'">'+u+"</option>");p===+i.month&&u.attr("selected",!0),d.append(u)}l.append(d);var f=y('<input type="text" data-part="year" class="val small" style="min-width: 54px; width: 54px;" placeholder="'+$_("year")+'">');i.year&&f.val(i.year),t=y("<span></span>").append(e).append(" ").append(l).append(" ").append(f)}else t=y('<span class="val small"></span>').text(this.fieldValue.value);return t},getValue:function(){var e,i=this.fieldValue;return"edit"==this.currentMode&&null!==this.domElement&&0<(e=this.domElement.find(".val")).length&&(i={value:{day:null,month:null,year:null}},e.each(function(){var e=y(this),t=e.data("part");i.value[t]=parseInt(e.val(),10)||null})),i},setValue:function(i){var e;this.fieldValue=i,"null"!=this.currentMode&&null!==this.domElement&&("edit"==this.currentMode?i&&i.data&&this.domElement.find(".val").each(function(){var e=y(this),t=e.data("part");e.val(i.data[t]||"")}):(e=this.fieldValue,"object"==typeof this.fieldValue&&this.fieldValue.value&&(e=this.fieldValue.value),this.domElement.find(".val").html(y.wa.encodeHTML(e))))}}),p.factoryTypes.Date=y.extend({},p.factoryTypes.String,{initializeFactory:function(e,t){this.fieldData=e||{},this.options=t||{},this.fieldData.input_height=1},setValue:function(e){this.fieldValue=e,"null"!=this.currentMode&&null!==this.domElement&&("edit"==this.currentMode?this.domElement.find("input:text").datepicker("setDate",this.fieldValue):this.domElement.find(".val").html(y.wa.encodeHTML(this.fieldValue)))},newInlineFieldElement:function(e){var i,a,n,t=p.factoryTypes.String.newInlineFieldElement.call(this,e);return"edit"==e&&(i=this,a=t.addClass("state-with-inner-icon right").find("input:text").addClass("js-datepicker").removeClass("val"),n=y('<input type="hidden" class="val">').insertAfter(a),y('<span class="icon cursor-pointer js-datepicker-trigger"><i class="fas fa-calendar-alt"></i></span>').insertAfter(a),e=function(){var e,t;a.datepicker({altField:n,altFormat:"yy-mm-dd",dateFormat:i.fieldData.format,changeMonth:!0,changeYear:!0,shortYearCutoff:2,showOtherMonths:!0,selectOtherMonths:!0,stepMonths:2,numberOfMonths:2,beforeShow:function(e,t){setTimeout(()=>t.dpDiv.css({"z-index":"1051"}))}}),i.fieldValue&&a.datepicker("setDate",i.fieldValue),e=function(){y.trim(a.val()).length<=0&&(a.datepicker("setDate",null),i.fieldValue=null)},t=null,a.keydown(function(){t&&clearTimeout(t),t=setTimeout(function(){e()},250)}),a.change(e)},a.datepicker?e():y.wa.loadFiles([y.wa.contactEditor.wa_backend_url+"wa-content/js/jquery-ui/jquery.ui.core.min.js",y.wa.contactEditor.wa_backend_url+"wa-content/js/jquery-ui/jquery.ui.datepicker.min.js"]).then(e),t.on("click",".js-datepicker-trigger",function(){a.trigger("focus")})),t}}),p.factoryTypes.IM=y.extend({},p.baseFieldType,{setValue:function(e){y.isPlainObject(e=void 0===e?"":e)?(this.fieldValue=e.data,this.viewValue=e.value):this.fieldValue=this.viewValue=e,"null"!=this.currentMode&&this.domElement&&("edit"==this.currentMode?this.domElement.find("input.val").val(this.fieldValue):this.domElement.find(".val").html(this.viewValue))},newInlineFieldElement:function(e){var t;return"view"!=e||this.fieldValue?(t=null,"edit"==e?(t=y('<span class="width-100-mobile custom-mr-0-mobile"><input class="val small width-100-mobile" type="text"></span>')).find(".val").val(this.fieldValue):t=y('<span class="val small custom-mt-12-mobile"></span>').html(this.viewValue),t):null}}),p.factoryTypes.SocialNetwork=y.extend({},p.baseFieldType,{setValue:function(e){y.isPlainObject(e=void 0===e?"":e)?(this.fieldValue=e.data,this.viewValue=e.value):this.fieldValue=this.viewValue=e,"null"!=this.currentMode&&this.domElement&&("edit"==this.currentMode?this.domElement.find("input.val").val(this.fieldValue):this.domElement.find(".val").html(this.viewValue))},newInlineFieldElement:function(e){var t;return"view"!=e||this.fieldValue?(t=null,"edit"==e?(t=y('<span class="width-100-mobile custom-mr-0-mobile"><input class="val small width-100-mobile" type="text"></span>')).find(".val").val(this.fieldValue):t=y('<span class="val small nowrap custom-mt-12-mobile"></span>').html(this.viewValue),t):null}}),p.factoryTypes.Url=y.extend({},p.factoryTypes.IM,{validate:function(e){var t=y.trim(this.getValue());if(!e&&this.fieldData.required&&!t)return $_("This field is required.");if(!t)return null;/^(https?|ftp|gopher|telnet|file|notes|ms-help)/.test(t)||this.setValue(t="http://"+t);var e="[^`!()\\[\\]{};:'\".,<>?«»“”‘’\\s+]",i="[^`!\\[\\]{}'\"<>«»“”‘’\\s]",a=new RegExp("^(https?|ftp|gopher|telnet|file|notes|ms-help):((//)|(\\\\\\\\))+"+i+"*$","i");return!a.test(t)||/^(http|ftp)/.test(t.toLowerCase())&&!(a=new RegExp("^(https?|ftp):((//)|(\\\\\\\\))+((?:"+e+"+\\.)+"+e+"{2,6})((/|\\\\|#)"+i+"*)?$","i")).test(t)?$_("Incorrect URL format."):null}}),p.factoryTypes.Email=y.extend({},p.factoryTypes.Url,{validate:function(e){var t=y.trim(this.getValue());return e||!this.fieldData.required||t?!t||new RegExp("^([^@\\s]+)@[^\\s@]+\\.[^\\s@\\.]{2,}$","i").test(t)?null:$_("Incorrect email address format."):$_("This field is required.")}}),p.factoryTypes.Checkbox=y.extend({},p.baseFieldType,{setValue:function(e){this.fieldValue=parseInt(e),"null"!=this.currentMode&&this.domElement&&("edit"==this.currentMode?this.domElement.find("input.val").attr("checked",!!this.fieldValue):this.domElement.find(".val").text(this.fieldValue?$_("Yes"):$_("No")))},newInlineFieldElement:function(e){var t=null;return"edit"==e?(t=y(`<label>
                    <span class="wa-checkbox">
                        <input class="val" type="checkbox" value="1" checked="checked">
                        <span>
                            <span class="icon">
                                <i class="fas fa-check"></i>
                            </span>
                        </span>
                    </span>
                </label>`),this.fieldValue||t.find(".val").removeAttr("checked")):t=y('<span class="val small"></span>').text(this.fieldValue?$_("Yes"):$_("No")),t}}),p.factoryTypes.Number=y.extend({},p.baseFieldType,{validate:function(e){var t=y.trim(this.getValue());return e||!this.fieldData.required||t||0===t?t&&!/^-?[0-9]+([\.,][0-9]+$)?/.test(t)?$_("Must be a number."):null:$_("This field is required.")}}),p.factoryTypes},y.wa.contactEditorFactory=function(e){"use strict";e=y.extend({contact_id:null,current_user_id:null,contactType:"person",baseFieldType:null,saveUrl:"?module=profile&action=save",saveGeocoordsUrl:"?module=contacts&action=saveGeocoords",regionsUrl:"?module=backend&action=regions&country=",el:"#contact-info-block",update_title:!0,dialog:{}},e);var _=y.extend({wa_app_url:"",fields:{},fieldsOrder:[],fieldsValues:{},factoryTypes:{},editorFactories:{},fieldEditors:{},initFactories:function(i,e){var a=this;this.fields=i,this.fieldsOrder=e,this.editorFactories={},this.fieldEditors={},this.fieldsOrder=y.each(e,function(e,t){try{if("object"!=typeof i[t]||!i[t].type)throw new Error("Field data error for "+t);if(void 0===a.factoryTypes[i[t].type])throw new Error("Unknown factory type: "+i[t].type);return i[t].multi?a.editorFactories[t]=y.extend({},a.factoryTypes.Multifield):a.editorFactories[t]=y.extend({},a.factoryTypes[i[t].type]),a.editorFactories[t].initializeFactory(i[t]),t}catch(e){console.log("Unable to init field "+t),console.log(e),i[t]=void 0,delete i[t]}}).filter(function(e){return!!e})},resetFieldEditors:function(){for(var e=0;e<this.fieldsOrder.length;e+=1){var t=this.fieldsOrder[e];void 0===this.fieldEditors[t]?this.fieldEditors[t]=this.editorFactories[t].createEditor(this.contactType,t):this.fieldEditors[t].reinit()}},initFieldEditors:function(e){if(!(e instanceof Array)){this.fieldsValues=e;for(var t=0;t<this.fieldsOrder.length;t+=1){var i=this.fieldsOrder[t];if(void 0===this.editorFactories[i])return void y.wa.controller.contactAction([this.contact_id]);try{void 0===this.fieldEditors[i]&&(this.fieldEditors[i]=this.editorFactories[i].createEditor(this.contactType)),this.fieldEditors[i].setValue(e[i])}catch(e){console.log("Unable to initialize editor "+i),console.log(e)}}}},initContactInfoBlock:function(e){this.switchMode(e,!0)},getSaveUrl:function(){return this.saveUrl},getSaveGeocoordsUrl:function(){return y.wa.contactEditor.wa_backend_url+"?module=profile&action=saveGeocoords"},getRegionsUrl:function(){return y.wa.contactEditor.wa_backend_url+"?module=profile&action=regions&country="},switchMode:function(e,t){var i=y(this.el),a=this;if(t&&(i.html(""),i.removeClass("edit-mode view-mode"),i.off("click.map",".map-link").on("click.map",".map-link",function(){var e,t=y(this).parent().data("multifield-index");void 0!==t&&(e=a.fieldEditors.address.fieldValue,a.geocodeAddress(e,t))})),!("edit"==e&&i.hasClass("edit-mode")||"view"==e&&i.hasClass("view-mode"))){y(this).trigger("before_switch_mode",[e,this]),i.find(".buttons").remove();for(var n,o=[],s=0;s<this.fieldsOrder.length;s+=1){var r=this.fieldsOrder[s];o.push(r);try{var l=this.fieldEditors[r].setMode(e);y(this).trigger("set_mode",[{mode:e,el:i,field_id:r,field:this.fieldEditors[r]}]),t&&i.append(l)}catch(e){console.log("Error initializing field",r,e)}}"edit"==e?(i.addClass("edit-mode"),i.removeClass("view-mode"),i.find(".subname").wrapAll('<div class="subname-wrapper custom-mt-0"></div>'),i.find(".jobtitle-company").wrapAll('<div class="jobtitle-company-wrapper custom-mt-16"></div>'),n=this.inplaceEditorButtons(o,function(e){if(void 0!==e&&!e)return!1;if(void 0!==a.justCreated&&a.justCreated)throw(e=y("#all-users-sidebar-link .count")).text(1+parseInt(e.text())),new Error("!!! Not implemented because never used. Redirect to contact_id="+a.contact_id);a.dialog.hide()}),null===a.contact_id&&n.find(".cancel").remove(),a.dialog.$body.find(".dialog-footer").append(n)):(i.addClass("view-mode"),i.removeClass("edit-mode"),i.find(".subname-wrapper").length&&i.find(".subname").unwrap(),i.find(".jobtitle-company-wrapper").length&&i.find(".jobtitle-company").unwrap()),y(this).trigger("after_switch_mode",[e,this])}},saveFields:function(e,m){if(!e)for(var t in e=[],this.fields)this.fields.hasOwnProperty(t)&&e.push(t);for(var g={},v=this,i=!1,a=0;a<e.length;a++){var n=e[a],o=this.fieldEditors[n].validate();if(o){if(!i)for(i=this.fieldEditors[n].domElement;!i.is(":visible");)i=i.parent();this.fieldEditors[n].showValidationErrors(o)}else this.fieldEditors[n].showValidationErrors(null);g[n]=this.fieldEditors[n].getValue()}function w(h){h=void 0===h||h,y.post(v.getSaveUrl(),{data:JSON.stringify(g),type:v.contactType,id:null!=v.contact_id?v.contact_id:0},function(e){if("ok"!==e.status){if(e.errors.length)return i=e.errors[0],y(".buttons .loading").hide(),void y("#validation-notice").text(i.text);throw new Exception("AJAX error:",e)}y("#validation-notice").text("");var t,i=v.fieldsValues||{},a=null,n=((e=e.data).data&&e.data.top&&(a=e.data.top),e.data.top=void 0,delete e.data.top,null!=v.contact_id&&v.initFieldEditors(e.data),!1);for(t in v.fieldEditors)if(void 0!==e.errors[t]){if(v.fieldEditors[t].showValidationErrors(e.errors[t]),!n)for(n=v.fieldEditors[t].domElement;!n.is(":visible");)n=n.parent()}else"edit"==v.fieldEditors[t].currentMode&&v.fieldEditors[t].showValidationErrors(null);if(!n)if(v.contact_id&&e.data.reload)(window.profileTab?window.profileTab.rootWindow:window).location.reload();else{if(null===v.contact_id&&(v.justCreated=!0),v.contact_id=e.data.id,!n&&h){var o=i,s=e,r=y.storage.get("contacts/last_geocoding")||0;if(3600<(new Date).getTime()-r){y.storage.del("contacts/last_geocoding");var l=s.data.address;if(!y.isEmptyObject(l)){for(var d,c=[],p=[],u=0;u<l.length;u+=1){var f=!0;(f=g.address[u]?!function(e,t,i){if(i){for(var a=0;a<i.length;a+=1)if(e[i[a]]&&t[i[a]]&&e[i[a]]!=t[i[a]])return}else{for(var n in e)if(e.hasOwnProperty(n)&&e[n]&&t[n]&&e[n]!=t[n])return;for(var n in t)if(t.hasOwnProperty(n)&&e[n]&&t[n]&&e[n]!=t[n])return}return 1}(l[u].data,(o.address[u]||{}).data||{},["city","country","region","street","zip"]):f)&&(c.push(v.sendGeocodeRequest(l[u].for_map)),p.push(u))}c.length&&(d=function(e,t){var i,a;"OK"===e.status?(i=e.lat||"",a=e.lng||"",g.address[t].value.lat=i,g.address[t].value.lng=a):"OVER_QUERY_LIMIT"===e.status&&y.storage.set("contacts/last_geocoding",(new Date).getTime()/1e3)},y.when.apply(y,c).then(function(){if(c.length<=1&&"success"===arguments[1])d(arguments[0],p[0]);else for(var e=0;e<arguments.length;e+=1)"success"===arguments[e][1]&&d(arguments[e][0],p[e]);w(!1)}))}}}m(!n),n||(y(_).trigger("contact_saved",e.data),a&&y(_).trigger("top_fields_updated",{data:a}),y.team.content.reload(!0))}},"json")}i?m(!1):w(!0)},createExtSelect:function(t,i){var e,a="",n=!0;for(e in t){var o="",s=(t[e]!==i&&e!==i||(n=!(o=' selected="selected"')),this.htmlentities(t[e]));a+='<option value="'+(void 0===t.length?e:s)+'"'+o+">"+s+"</option>"}function r(){l.val()||l.hasClass("empty")||(l.val(i),l.addClass("empty"))}var l=n?(a+='<option value="%custom" selected="selected">'+$_("other")+"...</option>",'<input type="text" class="shorter small ext width-100-mobile custom-mt-12-mobile">'):(a+='<option value="%custom">'+$_("other")+"...</option>",'<input type="text" class="shorter small empty ext width-100-mobile custom-mt-12-mobile">'),d=y('<div class="wa-select small width-100-mobile custom-mr-12 custom-mt-12-mobile"><select class="ext">'+a+'</select></div><span class="width-100-mobile custom-mr-12 custom-mr-0-mobile">'+l+"</span>"),c=d.children("select");(l=d.find("input")).val(i),"%custom"!==c.val()&&l.hide(),i=$_("which?");return l.blur(r),l.focus(function(){l.hasClass("empty")&&(l.val(""),l.removeClass("empty"))}),c.change(function(){var e=c.val();"%custom"===e?(l.hasClass("empty")&&l.val(i),l.show()):(l.hide(),l.addClass("empty"),l.val(e||"")),r()}),l[0].getExtValue=function(){return"%custom"===c.val()&&l.hasClass("empty")?"":l.val()},l[0].setExtValue=function(e){t[e]?c.val(e):c.val("%custom"),l.val(e)},d},inplaceEditorButtons:function(e,t){function i(){return y(".buttons .loading").show(),n.saveFields(e,function(e){y(".buttons .loading").hide(),t(e)}),!1}var a=y('<div class="field buttons"><div class="value"><p class="state-error-hint custom-mt-8" id="validation-notice"></p></div></div>'),n=this,o=(y("#tc-contact").off("keyup.contact_save").on("keyup.contact_save",'#contact-info-block.edit-mode input[type="text"]',function(e){13!=e.keyCode||y(e.currentTarget).data("autocomplete")&&y(e.currentTarget).data("contact_id")||i()}),y('<input type="submit" class="button" value="'+$_("Save")+'" />').click(i)),n=this,s=y('<a href="javascript:void(0)" class="cancel button light-gray js-close-dialog">'+$_("Cancel")+"</a>");return s.on("click",function(e){e.preventDefault(),y("#validation-notice").text(""),y(".buttons .loading").hide(),n.fieldEditors.name.showValidationErrors(null)}),a.children(".value").append(o).append(s).append(y('<i class="fas fa-spinner fa-spin loading custom-ml-16 wa-animation-spin speed-1000" style="display: none;"></i>')),a},destroy:function(){y(this.el).html("")},dialogInstance:function(e){this.dialog=e},wrapper:function(e,t,i){i=y('<div class="field'+(i=void 0!==i&&i?" "+i:"")+'"></div>');return void 0!==t&&t&&(y(this).on("set_mode",function(e,t){"Checkbox"===t.field.fieldData.type?t.field.domElement.find(".name").toggleClass("for-checkbox","edit"==t.mode):t.field.domElement.find(".name").toggleClass("for-input","edit"==t.mode)}),i.append(`<div class="name${y(this.el).closest(".dialog-content").length?" for-input":""}">${y.wa.encodeHTML(t)}</div>`)),"object"==typeof e&&e instanceof jQuery&&!(e.find("div.value").size()<=0)||(e=y('<div class="value custom-mb-12"></div>').append(e)),i.append(e),i},htmlentities:function(e){var t=document.createElement("div"),e=document.createTextNode(e);return t.appendChild(e),t.innerHTML},geocodeAddress:function(t,i){var a=this;t[i].data.lat&&t[i].data.lng||this.sendGeocodeRequest(t[i].for_map||t[i].value,function(e){t[i].data.lat=e.lat,t[i].data.lng=e.lng,y.post(a.getSaveGeocoordsUrl(),{id:a.contact_id,lat:e.lat,lng:e.lng,sort:i})})},sendGeocodeRequest:function(e,s){var t,i=[],r=("string"==typeof e?i.push(e):e.with_street&&e.without_street&&e.with_street===e.without_street?i.push(e.with_street):(e.with_street&&i.push(e.with_street),e.without_street&&i.push(e.without_street)),y.Deferred()),e=this.geocoding||{};return"google"===e.type&&e.key?(t=e.key,y.ajax({url:"https://maps.googleapis.com/maps/api/geocode/json",data:{sensor:!1,key:t,address:i[0]},dataType:"json",success:function(e){var t,i;if(e)if("OK"===e.status){for(var a=e.results.length,n=!1,o=0;o<a;o+=1)if(!e.results[o].partial_match){t=e.results[o].geometry.location.lat||"",i=e.results[o].geometry.location.lng||"",s instanceof Function&&s({lat:t,lng:i}),n=!0;break}n||(t=e.results[0].geometry.location.lat||"",i=e.results[0].geometry.location.lng||"",s instanceof Function&&s({lat:t,lng:i})),r.resolve([{lat:t,lng:i,status:e.status},"success"])}else r.resolve([{status:e.status},"success"]);else r.resolve([{status:"FAIL"},"error"])},error:function(e){r.resolve([{status:e.status},"error"])}})):"yandex"===e.type&&e.key?(t=e.key,y.ajax({url:"https://geocode-maps.yandex.ru/1.x/?format=json",data:{apikey:t,geocode:i[0]},dataType:"json",success:function(e){var i,a;e.response&&e.response.GeoObjectCollection&&e.response.GeoObjectCollection.featureMember&&(y.each(e.response.GeoObjectCollection.featureMember,function(e,t){if(t.GeoObject&&t.GeoObject.Point&&t.GeoObject.Point.pos&&"string"==typeof t.GeoObject.Point.pos){t=t.GeoObject.Point.pos.split(" ");if(2===t.length)return a=t[0],i=t[1],s instanceof Function&&s({lat:i,lng:a}),r.resolve([{lat:i,lng:a,status:"OK"},"success"]),!1}}),i)&&a||r.resolve([{status:"FAIL"},"error"])},error:function(e){r.resolve([{status:"FAIL"},"error"])}})):r.resolve([{geocoding:e},"error"]),r},initCheckboxList:function(e){function t(e,t){(t=y(t||this)).is(":checked")?t.parent().addClass("access-highlighted"):t.parent().removeClass("access-highlighted")}return(e=y(e)).find('input[type="checkbox"]').click(t).each(t),e}},e);return y.wa.fieldTypesFactory(_),_},y.wa.contactEditor=y.wa.contactEditorFactory()}(jQuery),function(c){return(Profile=function(e){var t=this;t.$wrapper=e.$wrapper,t.$tabs=t.$wrapper.find(".t-profile-tabs"),t.$tabContentPlace=t.$wrapper.find(".t-dynamic-content"),t.$calendarPlace=t.$wrapper.find(".t-calendar-place"),t.$profile_header_links=t.$wrapper.find(".t-profile-actions-btn"),t.$profile_sidebar=t.$wrapper.find(".t-profile-sidebar"),t.api_enabled=window.history&&window.history.pushState,t.user=e.user||{id:0},t.photo_dialog_url=e.photo_dialog_url,t.is_own_profile=e.is_own_profile||!1,t.wa_app_url=e.wa_app_url||"",t.wa_backend_url=e.wa_backend_url||"",t.wa_url=e.wa_url||"",t.wa_version=e.wa_version||"",t.webasyst_id_auth_url=e.webasyst_id_auth_url||"",t.is_system_profile=e.is_system_profile||!1,t.is_locked=!1,t.xhr=!1,t.dialogs=[],t.$calendar_wrapper=null,t.$calendar_date_filter=null,t.sidebar_drawer=null,t.sidebarDialog={},t.initClass(),t.initEditor(e.editor||{})}).prototype.initEditor=function(e){if(!(c.isEmptyObject(e)||c.isEmptyObject(e.options)||c.isEmptyObject(e.data))){const t=this,a=(c.storage=new c.store,c.each(e.options||{},function(e,t){c.wa.contactEditor[e]=t}),t.is_own_profile?c.wa.contactEditor.wa_app_url=t.wa_backend_url:c.wa.contactEditor.wa_app_url=t.wa_app_url,c.wa.contactEditor.wa_backend_url=t.wa_backend_url,c.wa.contactEditor.initFactories(e.data.contactFields,e.data.contactFieldsOrder),c.wa.contactEditor.resetFieldEditors(),c.wa.contactEditor.initFieldEditors(e.data.fieldValues),c.wa.contactEditor.initContactInfoBlock("view"),!t.is_own_profile&&e.data.fieldValues.timezone||c.wa.determineTimezone(t.wa_url),`<div class="dialog t-edit-profile">
            <div class="dialog-background"></div>
            <div class="dialog-body" style="width: 800px;">
            <h3 class="dialog-header">${$_("Contact info")}</h3>
                <div class="dialog-content fields"></div>
                <div class="dialog-footer"></div>
            </div>
        </div>`);t.$profile_header_links.on("click",".edit-link",function(){c(".js-user-info");let i;t.contactsDialog?t.contactsDialog.show():t.contactsDialog=c.waDialog({html:a,onOpen(e,t){c.wa.contactEditor.dialogInstance(t),c.wa.contactEditor.switchMode("edit"),i=c("#contact-info-block"),t.$content.append(i),t.resize(),c(c.wa.contactEditor).on("contact_saved",function(){t.hide()})},onClose(e){return e.hide(),!1}})})}},Profile.prototype.initClass=function(){var e=this;e.bindEvents(),c.team&&c.team.sidebar&&c.team.sidebar.selectLink(!1),new ProfileWebasystID({is_own_profile:e.is_own_profile,user:e.user,backend_url:e.wa_backend_url,wa_url:e.wa_url,wa_version:e.wa_version,webasyst_id_auth_url:e.webasyst_id_auth_url,ui:"2.0"}),e.is_system_profile||(c(document).on("wa_before_load",()=>{e.sidebar_drawer=null,e.showSidebarDrawer(!0)}),e.showSidebarDrawer(!0))},Profile.prototype.bindEvents=function(){var a=this;a.$tabs.on("click",".t-tab a",function(){return a.changeTab(c(this)),!1}),a.$calendarPlace.on("click",".js-calendar-toggle",function(e){e.preventDefault(),a.calendarToggle(c(this))}),a.$wrapper.find(".js-sidebar-calendar").on("click",".js-show-outer-calendar-manager",function(e){e.stopPropagation(),a.showOuterDialogDialog()}),c(document).on("click",".t-profile-drawer .js-show-outer-calendar-manager",function(e){e.stopPropagation(),a.showOuterDialogDialog()}),a.$wrapper.on("photo_updated photo_deleted",function(e,t){a.$wrapper.find(".t-userpic").attr("src",t.url)}),a.$wrapper.find(".js-change-photo").on("click",function(){let e=c("#contact-photo-crop-dialog");e.length||(e=c('<div class="dialog" id="contact-photo-crop-dialog"/>'),c("body").append(e)),e.load(a.photo_dialog_url,function(){c.waDialog({$wrapper:e})})}),a.$profile_header_links.on("click",".access-link",function(){var e;const i=c(this)[0].dataset;i.userId=a.user.id,a.accessDialog?a.accessDialog.show():(e=`
                <div class="dialog t-sidebar-profile-dialog">
                    <div class="dialog-background"></div>
                    <div class="dialog-body flexbox vertical" ${i.dialogWidth?' style="width:'+i.dialogWidth?.replace(/(<([^>]+)>)/gi,"")+'"':""}>
                        <h3 class="dialog-header">${i.dialogHeader?.replace(/(<([^>]+)>)/gi,"")||""}</h3>
                        <div class="dialog-content wide"></div>
                        <div class="dialog-footer custom-mt-auto">
                            <button type="button" class="button light-gray js-close-dialog">${$_("Close")}</button>
                        </div>
                    </div>
                </div>
            `,a.accessDialog=c.waDialog({html:e,onOpen(e,t){a.is_system_profile?(t.$content.append(c("#profile-access-wrapper")),t.resize(),a.$wrapper.trigger("dialog_opened",t)):(t.$content.empty().append('<div class="align-center"><span class="spinner custom-p-16"></span></div>'),c.post("?module=profile&action=sidebarDialog",i,function(e){t.$content.empty().html(e),a.$wrapper.trigger("dialog_opened",t)}))},onClose(e){return e.hide(),(a.is_system_profile?location:c.team.content).reload(),!1}}))}),a.$profile_header_links.on("click",".delete-link",function(){const e=c(this);c(document).on("wa_confirm_contact_delete_dialog",function(){e.find('[data-icon="trash-alt"]').removeClass("hidden"),e.find('[data-icon="spinner"]').addClass("hidden")}),e.find("svg").toggleClass("hidden"),c.team.confirmContactDelete([a.user.id])}),c(".js-edit-groups").on("click",function(){a.showSidebarDialog(c(".access-link").data())}),a.$wrapper.find(".js-profile-user-slider").one("click touchstart",function(){c(this).animate({height:"375px"},function(){c(this).removeClass("cursor-pointer")})}),a.$wrapper.find(".js-toggle-user-info").on("click",function(e){e.preventDefault(),c(this).find("svg").toggleClass("fa-caret-down fa-caret-up"),a.$wrapper.find(".js-user-info").toggleClass("hidden")}),a.$profile_sidebar.on("click",".js-sidebar-profile-dialog",function(e){e.preventDefault();let t=this.dataset;void 0===t.sectionId&&(t=this.closest("[data-section]").querySelector(".js-sidebar-profile-dialog").dataset),a.showSidebarDialog(t)}),c(document).one("click",".t-profile-drawer .js-sidebar-profile-dialog",function(e){e.preventDefault();let t=this.dataset;void 0===t.sectionId&&(t=this.closest("[data-section]").querySelector(".js-sidebar-profile-dialog").dataset),a.showSidebarDialog(t)}),a.$wrapper.find(".js-show-drawer").on("click",function(e){e.preventDefault(),a.showSidebarDrawer()})},Profile.prototype.switchToTab=function(t,i){var a=this.$wrapper.find(".t-profile-tabs-iframes"),n=this.$wrapper.find('.t-tab a[data-tab-id="'+t+'"]'),o=c.Deferred(),s=(n.on("tab_content_updated",r),setInterval(r,100));return n.closest(".t-tab").hasClass("is-selected")?r():n.click(),n.length&&c("html, body").animate({scrollTop:n.offset().top},500),o.promise();function r(){var e=a.children().filter(function(){return t==c(this).data("tab-id")}).first();try{e[0].contentWindow&&i(e)&&(setTimeout(function(){o.resolve(e)},0),n.off("tab_content_updated",r),s&&clearInterval(s),s=null)}catch(e){}}},Profile.prototype.changeTab=function(e){var t;this.api_enabled&&(e=e.data("tab-id"),t=window.location.href.match(/^.*\/(id|u)\/[^\/]+/))&&e&&(t=t[0]+"/"+e+"/",history.replaceState({reload:!0,content_uri:t},"",t))},Profile.prototype.calendarToggle=function(e){var t="is-short",i=e.find(".t-calendar-toggle .text");this.$calendarPlace.hasClass(t)?(i.text(e.data("hide-text")),this.$calendarPlace.removeClass(t)):(i.text(e.data("show-text")),this.$calendarPlace.addClass(t))},Profile.prototype.showOuterDialogDialog=function(){var e=this,t="?module=schedule&action=settings",i={};0<e.user.id&&(t+="&id="+e.user.id),e.is_locked||(e.is_locked=!0,c.post(t,i,function(e){c.waDialog({html:e})}).always(function(){e.is_locked=!1}))},Profile.prototype.showSidebarDialog=function(a){const n=this,o=c(".js-profile-sidebar-body");let t=!1;if(a.userId=n.user.id,n.sidebarDialog[a.sectionId])n.sidebarDialog[a.sectionId].show();else{a.sectionId&&a.userId||(t=!0);let e="";"calendar"===a.sectionId&&(e=`<a href="${n.wa_app_url}calendar/">
                                    <span>${a.dialogTeamCalendar}</span> 
                                    <i class="fas fa-external-link-alt fa-xs"></i>
                                </a>`);var i=`
            <div class="dialog t-sidebar-profile-dialog">
                <div class="dialog-background"></div>
                <div class="dialog-body flexbox vertical" ${a.dialogWidth?' style="width:'+a.dialogWidth?.replace(/(<([^>]+)>)/gi,"")+'"':""}>
                    <div class="dialog-header flexbox"><h3>${a.dialogHeader?.replace(/(<([^>]+)>)/gi,"")||""}</h3></div>
                    <div class="dialog-content wide"></div>
                    <div class="dialog-footer custom-mt-auto">
                        <button type="button" class="button light-gray js-close-dialog">${t?"Ok":$_("Close")}</button>
                        ${e}
                    </div>
                </div>
            </div>
        `;n.sidebarDialog[a.sectionId]=c.waDialog({html:i,onOpen(t,i){var e;i.$content.empty().append('<div class="align-center"><span class="spinner custom-p-16"></span></div>'),"calendar"===a.sectionId?(n.$calendar_wrapper||(n.$calendar_wrapper=o.find(".js-calendar-html > .t-calendar-wrapper").detach()),i.$content.empty().append(n.$calendar_wrapper),i.resize()):""===a.url?(e=c(".js-tab-content-"+a.sectionId).html(),i.$content.empty().html(e),i.resize(),n.$wrapper.trigger("dialog_opened",i)):c.post("?module=profile&action=sidebarDialog",a,function(e){i.$content.empty().html(e),n.$wrapper.trigger("dialog_opened",i);e=t.find(".t-profile-section-iframe");e.length&&e.data("dialog",i)})},onClose(e){return e.hide(),"calendar"===a.sectionId&&c.team.content.reload(),!1}})}},Profile.prototype.showSidebarDrawer=function(e=!1){const t=this;var i;t.sidebar_drawer?((i=t.sidebar_drawer.$wrapper[0].style).removeProperty("z-index"),i.removeProperty("opacity"),t.sidebar_drawer.show()):(t.sidebar_drawer=c.waDrawer({$wrapper:c(".js-profile-sidebar-drawer"),lock_body_scroll:!e,onClose(){return this.hide(),!1}}),e&&setTimeout(()=>{t.sidebar_drawer.close()},100))},Profile.initSidebarWidgetAccess=function(o){const e=o.$wrapper,s=o.wa_backend_url,r=o.user_id,l=o.loc,a=e.find(".js-waid"),n=a.find(".js-sent-email-ok");var d=!1;a.on("click",".js-send-email-invitation",function(e){e.preventDefault();const i=c(this),t=a.find(".js-loading");d||(t.show(),d=!0,c.post(s+"?module=settings&action=waIDInviteUser",{id:r}).done(function({errors:e,data:t}){e?c.waDialog.alert({title:l.error,text:e,button_title:l.ok}):t&&(i.addClass("hidden").find(".js-text").text(l.email_again).end().find(".js-last-send-datetime").text(t.sent),n.removeClass("hidden"),setTimeout(()=>{i.removeClass("hidden"),n.addClass("hidden")},1500))}).always(function(){d=!1,t.hide()}))}),e.on("click",".js-connect-by-numeric-code",function(e){const t=c(this),i=t.find(".js-loading");var a;d||(i.show(),d=!0,(a=[]).push(c.post(s+"?module=settings&action=waIDInviteUserByCode",{id:r}).then(function({errors:e,data:t}){return e?(new c.Deferred).reject(e).promise():t},function(e,t,i){return t+" "+i})),a.push(c.post("?module=profile&action=waidConnectCodeDialog",{id:r}).then(function(e){return e},function(e,t,i){return(new c.Deferred).reject(t+": "+i).promise()})),c.when.apply(c,a).then(function(i,e){c.waDialog({html:e,onOpen:function(e,t){e.trigger("dialog_opened",[i,t])}})},function(e){c.waDialog.alert({title:l.error,text:e,button_title:l.ok})}).always(function(){d=!1,i.hide()}))}),e.on("click",".js-connect-by-qr-code",function(e){const t=c(this),i=t.find(".js-loading"),a=t.find(".js-code-icon");var n;d||(i.show(),a.hide(),d=!0,(n=[]).push(c.post(s+"?module=settings&action=waIDInviteUserByCode",{id:r,qrcode:1}).then(function({errors:e,data:t}){return e?(new c.Deferred).reject(e).promise():t},function(e,t,i){return t+" "+i})),n.push(c.post("?module=profile&action=waidConnectQrcodeDialog",{id:r}).then(function(e){return e},function(e,t,i){return(new c.Deferred).reject(t+": "+i).promise()})),n.push(c.getScript(o.wa_url+"wa-content/js/qrcode/qrcode.min.js")),c.when.apply(c,n).then(function(i,e){c.waDialog({html:e,onOpen:function(e,t){e.trigger("dialog_opened",[i,t])}})},function(e){c.waDialog.alert({title:l.error,text:e,button_title:l.ok})}).always(function(){d=!1,i.hide(),a.show()}))})},Profile}(jQuery)),ActivityLazyLoading=function(o){return(ActivityLazyLoading=function(e){var t=this;t.list_name=e.names.list,t.items_name=e.names.items,t.pagind_name=e.names.paging,t.user_id=e.user_id,t.$wrapper=e.$wrapper||!1,t.$list=t.$wrapper.find(t.list_name),t.$window=o(window),t.onLoad=e.onLoad||function(){},t.$paging=t.$wrapper.find(t.pagind_name),t.xhr=!1,t.is_locked=!1,t.addWatcher()}).prototype.addWatcher=function(){var e=this,i=window.parent;function a(){var t=window&&o.contains(document,e.$paging[0]);if(t=t&&i&&window.frameElement?o.contains(i.document,window.frameElement):t)try{e.onScroll()}catch(e){t=!1}t||(e.$window.off("scroll",a),o(i).off("scroll",a))}e.$window.on("scroll",a),i&&window.frameElement&&o(i).on("scroll",a)},ActivityLazyLoading.prototype.onScroll=function(){var e,t=this,i=t.$window,a=i.scrollTop(),i=i.height(),n=t.$paging.offset().top;window.parent&&window.frameElement&&(i=(e=o(window.parent)).height(),a+=e.scrollTop(),n+=o(window.frameElement).offset().top),n<=a+i&&(t.is_locked||(t.is_locked=!0,t.loadNextPage()))},ActivityLazyLoading.prototype.loadNextPage=function(){var i=this,e=o.team.app_url+"?module=profile&action=activity",t={max_id:i.$paging.data("max-id"),id:i.user_id,timestamp:i.$list.find(i.items_name).last().data("timestamp")};i.xhr&&(i.xhr.abort(),i.xhr=!1),i.xhr=o.get(e,t,function(e){var e=o(e),t=e.find(i.list_name+" "+i.items_name),e=e.find(i.pagind_name);i.$list.append(t),i.$paging.after(e),i.$paging.remove(),i.$paging=e,i.is_locked=!1,i.onLoad()})},ActivityLazyLoading}(jQuery),OutsideCalendarsDialog=function(a){return(OutsideCalendarsDialog=function(e){var t=this;t.$dialogWrapper=e.$wrapper,t.$wrapper=t.$dialogWrapper.find(".dialog-body"),t.$form=t.$wrapper,t.dialog=t.$dialogWrapper.data("dialog"),t.is_locked=!1,t.xhr=!1,t.initClass()}).prototype.initClass=function(){this.bindEvents()},OutsideCalendarsDialog.prototype.bindEvents=function(){var t=this;t.$wrapper.on("click",".t-external-calendar-unmount",function(){t.deleteExternalCalendar(a(this).data("id"))}),t.$wrapper.find(".js-add-external-calendar").on("click",function(e){e.preventDefault(),t.dialog.close();e=a(this).attr("href");e&&a.team.content.load(e)})},OutsideCalendarsDialog.prototype.deleteExternalCalendar=function(e){var i=this;a.get("?module=calendarExternal&action=DeleteConfirm",{id:e},function(e){a.waDialog({html:e,onOpen(e,t){e.on("afterDelete",()=>{a.team.content.reload(),i.dialog.close(),t.close()})}})})},OutsideCalendarsDialog}(jQuery),ProfileStatistic=function(d){var t,c;c=jQuery,(t=function(e){var t,i,a=this;a.app_id=e.app_id,a.$wrapper=e.$wrapper,a.$hint=a.$wrapper.find(".t-hint-wrapper"),a.node=a.$wrapper.find(".t-graph")[0],a.d3node=d3.select(a.node),a.show_class="is-shown",a.charts=e.data,a.data=n(a.charts,a.app_id),a.group_by=e.group_by,a.locales=e.locales,a.is_widget=a.$wrapper.hasClass("js-is-stats-widget"),a.margin={top:a.is_widget?0:14,right:a.is_widget?0:10,bottom:a.is_widget?0:28,left:a.is_widget?0:34},a.area=(e=a.node,t=a.margin,i=e.offsetWidth,e=e.offsetHeight,{outer_width:i,outer_height:e,inner_width:i-t.left-t.right,inner_height:e-t.top-t.bottom}),a.column_indent=4,a.column_width=function(e,t,i){var a=null;i+=1,e&&i&&(a=(e-t*(i-1))/i)<0&&(a=0);return a}(a.area.inner_width,a.column_indent,a.data[0].length),a.svg=!1,a.defs=!1,a.x=!1,a.y=!1,a.xDomain=!1,a.yDomain=!1,a.initGraph()}).prototype.initGraph=function(){var e=this,t=e.area;e.initGraphCore(),e.$wrapper.find(".t-graph").empty(),e.svg=e.d3node.append("svg").attr("width",t.outer_width).attr("height",t.outer_height),e.is_widget||e.renderBackground(),e.renderCharts(),e.is_widget||e.renderAxis()},t.prototype.initGraphCore=function(){var e,t,i,a=this,n=a.data,o=a.area,s=a.x=d3.time.scale().range([0,o.inner_width]),o=a.y=d3.scale.linear().range([o.inner_height,0]);a.yDomain=(0<(e=d3.min(n,function(e){return d3.min(e,function(e){return e.value})}))&&(e=0),t=d3.max(n,function(e){return d3.max(e,function(e){return e.value+e.y0})}),[e,t]),a.xDomain=(e=n[0].length,t=n[0][0].date,i=n[0][1].date,e=n[0][e-1].date,i=parseInt((i.getTime()-t.getTime())/2),t=new Date(t.getTime()-i),e=new Date(e.getTime()+i),[t,e]),s.domain(a.xDomain),o.domain(a.yDomain)},t.prototype.renderAxis=function(){var e=this,t=e.x,i=e.y,a=e.svg,n=600<e.area.outer_width?10:5,t=d3.svg.axis().scale(t).orient("bottom").ticks(n),n=d3.svg.axis().scale(i).innerTickSize(2).orient("right").tickValues(o(6,e.yDomain)).tickFormat(function(e){return e+""}),i=a.append("g").attr("class","axis");i.append("g").attr("transform","translate(10,"+e.margin.top+")").attr("class","y").call(n),i.append("g").attr("class","x").attr("transform","translate("+e.margin.left+","+(e.area.outer_height-e.margin.bottom)+")").call(t)},t.prototype.renderBackground=function(){var e,t=this,i=t.area.inner_width,a=t.area.inner_height,n=t.svg.append("g").attr("class","background").attr("transform","translate("+t.margin.left+","+t.margin.top+")");for(n.append("rect").attr("width",i).attr("height",a),e=0;e<=5;e++){var o=1+(a-2)/5*e;n.append("line").attr("x1",1).attr("x2",i).attr("y1",o).attr("y2",o)}},t.prototype.renderCharts=function(){var a=this,e=a.svg,t=a.data,e=e.selectAll(".t-graph-wrapper").data(t),t=(e.enter().append("g").attr("class","t-graph-wrapper").attr("transform","translate("+a.margin.left+","+a.margin.top+")"),e.selectAll(".rect").data(function(e){return e}));t.enter().append("rect").attr("class","rect").style("fill",function(e,t,i){i=a.charts[i].color;return i||!1}).on("mouseover",function(e,t,i){a.showHint(d3.event,this,e,a.charts[i])}).on("mousemove",function(){a.moveHint(this)}).on("mouseout",function(){a.hideHint()}),t.transition().duration(1e3).attr("x",function(e,t){return a.x(e.date)-a.column_width/2}).attr("y",function(e){return a.y(e.y0)+a.y(e.value)-a.area.inner_height}).attr("height",function(e){return a.area.inner_height-a.y(e.value)}).attr("width",a.column_width),t.exit().remove(),e.exit().remove()},t.prototype.update=function(e){var t=this,e=(t.data=n(t.charts,e),t.initGraphCore(),d3.svg.axis().scale(t.y).innerTickSize(2).orient("right").tickValues(o(6,t.yDomain)).tickFormat(function(e){return e+""}));t.svg.selectAll(".axis .y").call(e),t.renderCharts()},t.prototype.showHint=function(e,t,i,a){var s=this,t=c(t);if(!(0<Math.ceil(t.attr("height"))))return!1;var n=i.date,o=s.$hint.find(".t-date"),r=s.$hint.find(".t-app"),l=s.$hint.find(".t-value"),n=function(t,i){var a,n=parseInt(t.getMonth());if("months"==i){i=s.locales.months;a=i[n]||(i=["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"])[n]}else{i=t.getDate();a=(i=i<10?"0"+i:i)+"."+(n=(n+=1)<10?"0"+n:n)+"."+t.getFullYear();try{a=c.datepicker.formatDate(s.locales.dateFormat,t)}catch(e){a=i+"."+n+"."+t.getFullYear()}}return a}(n,s.group_by),o=(o.text(n),r.text(a.name),l.text(i.value),function(e){var t=s.$hint.outerWidth(),i=s.$hint.outerHeight(),a=Math.ceil(e.attr("width")),n=Math.ceil(e.attr("height")),o=s.$wrapper.offset(),e=e.offset(),e={left:e.left-o.left+a+6,top:e.top-o.top+(n<i?n-i-2:2)};s.$wrapper.width()<e.left+t&&(e.left=e.left-(t+6+a));return e}(t));s.$hint.css(o).addClass(s.show_class)},t.prototype.moveHint=function(){},t.prototype.hideHint=function(){this.$hint.removeAttr("style").removeClass(this.show_class)};function n(e,t){for(var i,a,n=[],o=0;o<e.length;o++){for(var s=e[o].data,r=[],l=0;l<s.length;l++){var d=s[l],c=t&&e[o].id!==t?0:parseInt(d.value);r.push({date:(d=d.date,a=i=void 0,d=d.split("-"),i=parseInt(d[0]),a=parseInt(d[1])-1,d=parseInt(d[2]),new Date(i,a,d)),value:c})}n.push(r)}return d3.layout.stack().offset("zero").values(function(e){return e}).x(function(e){return e.date}).y(function(e){return e.value})(n)}function o(e,t){for(var i=t[0],a=(t[1]||1)-i+1,n=a/(e-1),o=[],s=0;s<e;s++){var r=10<a?Math.round(s*n):parseInt(s*n*10)/10;o.push(r)}return o}return(ProfileStatistic=function(e){var t=this;t.$wrapper=e.$wrapper,t.$graphWrapper=t.$wrapper.find("#t-graph-wrapper"),t.$header=t.$wrapper.find(".t-header-wrapper"),t.$filters=t.$header.find(".t-filters"),t.graphData=e.graphData,t.app_url=e.app_url,t.app_id=e.app_id,t.group_by=e.group_by,t.timeframe=e.timeframe,t.start_date=e.start_date,t.end_date=e.end_date,t.loading_class="is-loading",t.contact_id=e.contact_id,t.locales=e.locales,t.graph=!1,t.xhr=!1,t.initClass()}).prototype.initClass=function(){this.bindEvents(),this.initGraph(),this.initDatePicker()},ProfileStatistic.prototype.bindEvents=function(){var t=this;t.$filters.on("click",".t-period-filter .menu a",function(e){e.preventDefault(),t.changePeriod(d(this))}),t.$filters.on("click",".t-app-filter .menu a",function(e){e.preventDefault();e=d(this).data("app-id");t.changeApp(e||!1)}),t.$filters.on("click",".js-set-custom-period",function(e){e.preventDefault(),t.changeCustomPeriod(d(this).closest("form"))}),t.$filters.on("click",".js-datepicker-trigger",function(){d(this).parent().find("input").trigger("focus")})},ProfileStatistic.prototype.initGraph=function(){var e=this;e.$graphWrapper.length&&e.graphData&&e.graphData.length&&(e.graph=new t({$wrapper:e.$graphWrapper,data:function(n){1===n[0].data.length&&d.each(n,function(e){var t=n[e].data[0],i={value:0,date:o(t.date,!1)},a={value:0,date:o(t.date,!0)};n[e].data=[i,t,a]});return n;function o(e,t){var e=e.split("-"),i=parseInt(e[0]),a=parseInt(e[1])-1,e=parseInt(e[2]),i=new Date(new Date(i,a,e).getTime()+(t?864e5:-864e5)),a=parseInt(i.getFullYear()),e=parseInt(i.getMonth())+1,t=parseInt(i.getDate());return[a,e=e<10?"0"+e:e,t=t<10?"0"+t:t].join("-")}}(e.graphData),group_by:e.group_by,locales:e.locales,app_id:e.app_id}))},ProfileStatistic.prototype.initDatePicker=function(){this.$wrapper.find(".js-datepicker").each(function(){var e=d(this),t=e.parent().find("input[type='hidden']");e.datepicker({altField:t,altFormat:"yy-mm-dd",beforeShow:function(e,t){t.dpDiv.on("click",function(e){e.stopPropagation()}),setTimeout(()=>t.dpDiv.css({"z-index":"1051"}))}})})},ProfileStatistic.prototype.changeApp=function(e){this.app_id=e||!1,this.graph.update(this.app_id)},ProfileStatistic.prototype.changePeriod=function(e){var t,i=this,a=i.$wrapper.find(".js-hidden-part"),n=!e.hasClass("js-show-period-form"),o=i.loading_class;n?(a.addClass("hidden"),n=i.app_url+"?module=profile&action=stats",t={is_update:!0,id:i.contact_id},e.data("timeframe")&&e.data("groupby")&&(t.timeframe=i.timeframe=e.data("timeframe"),t.groupby=i.group_by=e.data("groupby")),i.app_id&&(t.app_id=i.app_id),i.xhr&&(i.xhr.abort(),i.xhr=!1),i.$wrapper.addClass(o),i.xhr=d.post(n,t,function(e){i.$wrapper.replaceWith(e)})):a.removeClass("hidden")},ProfileStatistic.prototype.changeCustomPeriod=function(e){var t,a,n,o,s,i=this,r=i.app_url+"?module=profile&action=stats",e=e.serializeArray();function l(e){var e=e.split("-"),t=parseInt(e[0]),i=parseInt(e[1])-1,e=parseInt(e[2]);return new Date(t,i,e)}e.push({name:"is_update",value:!0}),e.push({name:"id",value:i.contact_id}),e.push({name:"timeframe",value:"custom"}),i.app_id&&e.push({name:"app_id",value:i.app_id}),t=e,d.each(t,function(e,t){var i=t.name;"from"==i&&(a=t.value),"to"==i&&(n=t.value),"groupby"==i&&(s=e,o=t.value)}),"days"==o&&0<=s&&function(e,t){e=l(e),t=l(t);return 79488e5<Math.abs(t.getTime()-e.getTime())}(a,n)&&(t[s].value="months"),i.xhr&&(i.xhr.abort(),i.xhr=!1),i.$wrapper.addClass(i.loading_class),i.xhr=d.post(r,e,function(e){i.$wrapper.replaceWith(e)})},ProfileStatistic.prototype.update=function(){},ProfileStatistic}(jQuery),SettingsPage=function(s){return(SettingsPage=function(e,t){var i=this;i.$wrapper=e,i.$calendarToggle=i.$wrapper.find("#t-calendar-settings"),i.$form=i.$wrapper.find("#calendar_settings"),i.$submitButton=i.$wrapper.siblings(".bottombar").find('[type="submit"]'),i.options=t,i.$notice=!1,i.is_locked=!1,i.is_form_changed=!1,i.xhr=!1,i.initClass()}).prototype.initClass=function(){this.bindEvents(),this.initSortable()},SettingsPage.prototype.bindEvents=function(){var e=this;e.$calendarToggle.on("click",".js-edit-calendar, .js-add-calendar",s.proxy(e.showEditDialog,e)),e.$form.on("change","input, select, textarea",s.proxy(e.checkFormChanges,e)),e.$form.on("submit",s.proxy(e.save,e))},SettingsPage.prototype.initSortable=function(){const t=this;t.$calendarToggle.sortable({animation:150,handle:".t-toggle",direction:"vertical",filter:".t-actions",onMove(e){if(e.related.classList.contains("t-actions"))return-1},onStart(){t.$notice&&(t.$notice.remove(),t.$notice=!1)},onEnd(e){e.oldIndex!==e.newIndex&&t.saveCalendarsSort(e.item)}})},SettingsPage.prototype.checkFormChanges=function(){this.is_form_changed||(this.is_form_changed=!0,this.$submitButton.addClass("yellow"))},SettingsPage.prototype.showEditDialog=function(e){e.preventDefault();const t=this;var i={},e=parseInt(s(e.target).closest(".t-calendar-item").data("id"));e&&(i.id=e),t.xhr&&(t.xhr.abort(),t.xhr=!1),t.xhr=s.post(t.options.api.editDialog,i,function(e){t.dialog=s.waDialog({html:e})})},SettingsPage.prototype.saveCalendarsSort=function(e){const i=this,a=s(e);var t,n,e=s.team.app_url+"?module=settings&action=calendarsSortSave",o={calendars:function(){const t=[],e=i.$calendarToggle.find(".t-calendar-item");return e.each(function(){var e=s(this).data("id");e&&0<e&&t.push(e)}),t}()};i.xhr&&(i.xhr.abort(),i.xhr=!1),i.$notice=(t=a,(n=s('<span class="t-notice"><i class="fas fa-spin fa-spinner wa-animation-spin speed-1000"></i></span>')).appendTo(t),n),i.xhr=s.post(e,o,function(){var e,t;i.$notice.remove(),i.$notice=(e=a,(t=s('<span class="t-notice state-success"><i class="fas fa-check-circle"></i></span>')).appendTo(e),t),setTimeout(function(){i.$notice&&s.contains(document,i.$notice[0])&&i.$notice.remove()},1e3),i.xhr=!1})},SettingsPage.prototype.save=function(e){e.preventDefault();const t=this;t.is_form_changed&&!t.is_locked&&(e=t.$form.serializeArray(),t.$submitButton.append('<i class="fas fa-spinner wa-animation-spin speed-1000 custom-ml-4 js-profile-settings-spinner"></i>'),t.is_locked=!0,s.post(t.options.api.save,e,function(e){"ok"===e.status&&(t.is_form_changed=!1,t.is_locked=!1,t.$submitButton.removeClass("yellow"),t.$submitButton.find(".js-profile-settings-spinner").remove())}))},SettingsPage}(jQuery),CalendarEditDialog=function(s){return(CalendarEditDialog=function(e,t){var i=this;i.$wrapper=e,i.$block=i.$wrapper.find(".dialog-body"),i.$form=i.$block,i.$styleWrapper=i.$block.find(".t-style-wrapper"),i.$iconsWrapper=i.$block.find(".t-calendar-icons"),i.$limitedToggle=i.$block.find(".t-limited-toggle"),i.$limitedGroups=i.$block.find(".t-hidden-content"),i.$colorToggle=i.$block.find(".t-color-toggle"),i.$nameField=i.$block.find('input[name="data[name]"]'),i.$iconField=i.$block.find('input[name="data[icon]"]'),i.$inputStatusBg=i.$block.find('input[name="data[status_bg_color]"]'),i.$inputStatusFont=i.$block.find('input[name="data[status_font_color]"]'),i.$inputEventBg=i.$block.find('input[name="data[bg_color]"]'),i.$inputEventFont=i.$block.find('input[name="data[font_color]"]'),i.$pickerBgColor=i.$block.find(".js-bg-color"),i.$badge_status=i.$block.find(".js-badge-preview.is-status"),i.$badge_event=i.$block.find(".js-badge-preview.is-event"),i.$badgeIcon=i.$block.find(".js-badge-icon"),i.$badgeName=i.$block.find(".js-badge-name"),i.$fields=i.$form.find("input, textarea"),i.calendar_id=t.calendar_id,i.teamDialog=i.$wrapper.data("dialog"),i.options=t,i.classes={selected_class:"is-selected",hidden_class:"is-hidden",has_error_class:"state-error"},i.$selectedStyleButton=i.$styleWrapper.find("."+i.classes.selected_class),i.is_locked=!1,i.xhr=!1,i.initClass()}).prototype.initClass=function(){this.bindEvents(),this.initColorPicker(),this.checkCustomColor()},CalendarEditDialog.prototype.bindEvents=function(){var e=this;e.$block.on("click",".js-delete-calendar",s.proxy(e.showDeleteConfirm,e)),e.$styleWrapper.on("click",".t-style-item",s.proxy(e.setStyleToggle,e)),e.$styleWrapper.on("click",".js-custom-color",s.proxy(e.toggleCustomColor,e)),e.$iconsWrapper.on("click",".t-calendar-icons--item",s.proxy(e.setBadgeIcon,e)),e.$form.on("submit",s.proxy(e.save,e)),e.$fields.on("mousedown",s.proxy(e.removeErrors,e)),e.$nameField.on("change keyup",s.proxy(e.setPreviewName,e)),e.$limitedToggle.on("change","input:radio",s.proxy(e.toggleLimitSection,e))},CalendarEditDialog.prototype.checkCustomColor=function(){this.$selectedStyleButton.length||(this.$styleWrapper.find(".js-custom-color-check").removeClass("hidden"),this.$colorToggle.removeClass("hidden"))},CalendarEditDialog.prototype.setBadgeIcon=function(e){e.preventDefault();var e=s(e.target),t=e.find("svg"),t=t.attr("data-prefix")+" fa-"+t.attr("data-icon");e.addClass(this.classes.selected_class).siblings().removeClass(this.classes.selected_class),this.$badgeIcon.html(`<i class="${t}"></i>`),this.$iconField.val(t)},CalendarEditDialog.prototype.toggleCustomColor=function(e){e.preventDefault();s(e.target).find(".js-custom-color-caret").toggleClass("fa-caret-down fa-caret-up"),this.$colorToggle.toggleClass("hidden"),this.teamDialog.resize()},CalendarEditDialog.prototype.toggleLimitSection=function(e){e.target.value.length?this.$limitedGroups.show():this.$limitedGroups.hide(),this.teamDialog.resize()},CalendarEditDialog.prototype.removeErrors=function(e){e=s(e.target);e.hasClass(this.classes.has_error_class)&&e.removeClass(this.classes.classes.has_error_class).closest(".value").find(".state-error-hint").remove()},CalendarEditDialog.prototype.setStyleToggle=function(e){var t=this,e=s(e.target),i=e.css("color"),a=e.css("background-color"),n=t.colorConvert(a,-15).hex,o=t.colorConvert(a,40).hex;t.$selectedStyleButton.removeClass(t.classes.selected_class),t.setStyleData(i,a),e.addClass(t.classes.selected_class),t.$selectedStyleButton=e,t.$styleWrapper.find(".js-custom-color-check").addClass("hidden"),t.$colorToggle.addClass("hidden"),t.$badge_status.css({color:i,"background-color":a}),t.$badge_event.css({color:n,"background-color":o})},CalendarEditDialog.prototype.setStyleData=function(e,t){var i=this;function a(e){let t;return"#"+(t=(t=e.split("(")[1].split(")")[0]).split(",").splice(0,3)).map(function(e){return 1===(e=parseInt(e).toString(16)).length?"0"+e:e}).join("")}e.includes("#")||(e=a(e)),t.includes("#")||(t=a(t)),i.$badge_event[0].style.removeProperty("box-shadow"),i.$inputStatusBg.val(t).trigger("change"),i.$inputStatusFont.val(e).trigger("change"),i.$inputEventBg.val(i.colorConvert(t,40).hex).trigger("change"),i.$inputEventFont.val(i.colorConvert(t,-15).hex).trigger("change"),i.$pickerBgColor.css("background-color",t)},CalendarEditDialog.prototype.showDeleteConfirm=function(e){e.preventDefault();const t=this;t.is_locked||(e={id:t.calendar_id},t.is_locked=!0,t.xhr&&(t.xhr.abort(),t.xhr=!1),t.xhr=s.get(t.options.api.showDeleteConfirm,e,function(e){s.waDialog({html:e}),t.is_locked=!1,t.teamDialog.close()}))},CalendarEditDialog.prototype.initColorPicker=function(){let a=this;var e;(e=function(e){var t=this;t.$wrapper=e.$wrapper,t.$field=t.$wrapper.querySelector(".t-color-field"),t.$pick_color_btn=t.$wrapper.querySelector(".js-show-color-picker"),t.pickr_options={el:t.$pick_color_btn,theme:"classic",appClass:"wa-pcr-app small",lockOpacity:!0,position:"right-start",useAsButton:!0,container:a.$wrapper[0],default:t.$field.value||"#42445a",components:{palette:!0,hue:!0}},t.initClass()}).prototype.initClass=function(){let i=this;Pickr.create(i.pickr_options).on("change",e=>t(e));function t(e){let t;t=e.hasOwnProperty("toHEXA")?e.toHEXA().toString(0):e.target.value,i.$field.value=t,i.$pick_color_btn.style.backgroundColor=t,i.$pick_color_btn.classList.contains("js-bg-color")&&(a.$badge_status.css("background-color",t),a.$badge_event.css("background-color",a.colorConvert(t,40).hex),a.$badge_event.css("color",t),a.$form.find('[name="data[status_bg_color]"]').val(t),a.$form.find('[name="data[bg_color]"]').val(a.colorConvert(t,40).hex),a.$form.find('[name="data[font_color]"]').val(t)),i.$pick_color_btn.classList.contains("js-font-color")&&(a.$badge_status.css("color",t),a.$form.find('[name="data[status_font_color]"]').val(t)),a.$styleWrapper.find(".js-custom-color-check").removeClass("hidden"),a.$selectedStyleButton.removeClass(a.classes.selected_class)}(i.$wrapper.dataset.colorPicker=i).$field.addEventListener("keyup",t,!1)};a.$styleWrapper.find(".t-color-toggle .t-toggle").each(function(){new e({$wrapper:this})})},CalendarEditDialog.prototype.setPreviewName=function(e){e=e.target.value.length?e.target.value:this.options.locales.preview;this.$badgeName.text(e)},CalendarEditDialog.prototype.colorConvert=function(e,t=0){let i=0,a=0,n=0;e.includes("#")?4===e.length?(i="0x"+e[1]+e[1],a="0x"+e[2]+e[2],n="0x"+e[3]+e[3]):7===e.length&&(i="0x"+e[1]+e[2],a="0x"+e[3]+e[4],n="0x"+e[5]+e[6]):(e=e.split("(")[1].split(")")[0].split(",").splice(0,3),i=e[0],a=e[1],n=e[2]),i/=255,a/=255,n/=255;var e=Math.min(i,a,n),o=Math.max(i,a,n),s=o-e;let r=0;let l=0;r=0==s?0:o===i?(a-n)/s%6:o==a?(n-i)/s+2:(i-a)/s+4,(r=Math.round(60*r))<0&&(r+=360),l=(o+e)/2,o=+(100*(0==s?0:s/(1-Math.abs(2*l-1)))).toFixed(),l=+(100*l).toFixed(),0!==t&&(50<=l&&(l-=20),0<t?100<=(l+=parseInt(t,10))&&(l-=10):t<0&&(l+=parseInt(t,10)));e={hsl:`hsl(${r},${o}%,${l}%)`};l/=100;const d=o*Math.min(l,1-l)/100;s=e=>{e=(e+r/30)%12,e=l-d*Math.max(Math.min(e-3,9-e,1),-1);return Math.round(255*e).toString(16).padStart(2,"0")};return e.hex="#"+s(0)+s(8)+s(4),e},CalendarEditDialog.prototype.save=function(e){e.preventDefault();const a=this;a.is_locked||((e=function(e){let i={};var t=[];s.each(e,function(e,t){i[t.name]=t.value}),i["data[is_limited]"]||delete i["data[is_limited]"];s.trim(i["data[name]"]).length||t.push({field:"data[name]",locale:"empty"});if(t.length)return function(e){a.$form.find(".state-error-hint").remove(),s.each(e,function(e,t){var i=a.$form.find(`[name="${t.field}"]`);i.length&&i.addClass(a.classes.has_error_class).after(`<div class="state-error-hint custom-mt-4">${a.options.locales[t.locale]}</div>`)})}(t),!1;return i}(a.$form.serializeArray()))?(a.is_locked=!0,s.post(a.options.api.save,e,function(e){"ok"!==e.status?console.warn(e):(a.is_locked=!1,s.team.content.reload(),s.team.sidebar.reload(),a.teamDialog.close())})):(console.warn("have no data to save"),a.is_locked=!1,a.teamDialog.close()))},CalendarEditDialog}(jQuery),CalendarDeleteDialog=function(i){return(CalendarDeleteDialog=function(e,t){var i=this;i.$wrapper=e,i.$block=i.$wrapper.find(".dialog-body"),i.$deleteButton=i.$block.find(".js-delete-calendar"),i.options=t,i.is_locked=!1,i.initClass()}).prototype.initClass=function(){this.$deleteButton.on("click",i.proxy(this.deleteCalendar,this))},CalendarDeleteDialog.prototype.deleteCalendar=function(e){e.preventDefault();const t=this;t.is_locked||(e={id:t.options.calendar_id},t.is_locked=!0,i.post(t.options.api.delete,e,function(e){"ok"!==e.status?console.warn(e):(i.team.content.reload(),t.$wrapper.data("dialog").close())},"json"))},CalendarDeleteDialog}(jQuery),Sidebar=function(c){return(Sidebar=function(e,t){this.$wrapper=e,this.options=t,this.initClass()}).prototype.initClass=function(){var e=this;e.$body=e.$wrapper.find(".sidebar-body"),e.$addUserLink=e.$wrapper.find("#t-new-user-link"),e.$groupsWrapper=e.$wrapper.find(".t-groups-list"),e.$groups=e.$groupsWrapper.find("> li"),e.$locationsWrapper=e.$wrapper.find(".t-locations-list"),e.$locations=e.$locationsWrapper.find("> li"),e.$searchForm=e.$wrapper.find(".t-search-form"),e.$addGroupLink=e.$wrapper.find(".js-add-user-group"),e.$addOfficeLink=e.$wrapper.find(".js-add-user-location");c.extend(e.options,{storage_count_name:"team/sidebar_counts",link_count_update_date:!1,counters:{},storageCount:!1,xhr:!1,timer:0}),e.$activeMenuItem=e.$wrapper.find(`li.${e.options.classes.selected}:first`)||!1,e.groupDialog={},e.setCounts(),e.options.can_sort&&e.initSortable(),e.initDroppable(),e.$activeMenuItem.length||e.selectLink(),e.initUpdater(),e.bindEvents()},Sidebar.prototype.bindEvents=function(){var e=this;e.unBindEvents(),e.$wrapper.on("click","li > a",c.proxy(e.onLinkClick,e)),e.$addGroupLink.on("click",c.proxy(e.showGroupDialog,e)),e.$addOfficeLink.on("click",c.proxy(e.showGroupDialog,e)),e.$searchForm.on("submit",c.proxy(e.showSearch,e)),e.$addUserLink.on("click",c.proxy(e.showInviteDialog,e))},Sidebar.prototype.unBindEvents=function(){var e=this;e.$wrapper.off("click","li > a"),e.$addGroupLink.off("click"),e.$addOfficeLink.off("click"),e.$searchForm.off("submit"),e.$addUserLink.off("click")},Sidebar.prototype.onLinkClick=function(e){var e=c(e.target).closest("a"),t=e.attr("href");t&&"javascript:"!==t.substr(0,11)&&!e.hasClass(this.options.classes.noHighlight)&&(this.setItem(e.closest("li")),c.team.setTitle(e.text()))},Sidebar.prototype.setItem=function(e){var t=this;t.$activeMenuItem&&t.$activeMenuItem[0]===e[0]||(t.$activeMenuItem&&t.$activeMenuItem.removeClass(t.options.classes.selected),e.addClass(t.options.classes.selected),t.$activeMenuItem=e)},Sidebar.prototype.selectLink=function(e){var t=this;let i;if(e)i=t.$wrapper.find(`a[href="${e}"]:first`);else if(!1===e)return void(t.$activeMenuItem&&(t.$activeMenuItem.removeClass(t.options.classes.selected),t.$activeMenuItem=null));if(i&&i.length)t.setItem(i.closest("li"));else{e=t.$wrapper.find(`a[href^="${t.options.app_url}"]`);const o=location.pathname;let a=0,n=0;e.each(function(e){var t=c(this).attr("href"),i=t.length;0<=o.indexOf(t)&&i>a&&(a=i,n=e)}),!n&&0!==n||(i=e.eq(n),t.setItem(i.closest("li")))}},Sidebar.prototype.reload=function(e){const t=this;let i=c.team.app_url+t.options.api.reload;e&&(i+="&background_process=1"),clearTimeout(t.options.timer),t.options.xhr&&t.options.xhr.abort(),c.contains(document,t.$body[0])&&(t.options.xhr=c.get(i,{is_reload:1},function(e){t.options.xhr=!1,c.contains(document,t.$body[0])&&(t.$body.replaceWith(e),t.$wrapper.find(".sidebar-header").css("display",""),t.$wrapper.find(".sidebar-body").css("display",""),t.$wrapper.find(".sidebar-footer").css("display",""))}))},Sidebar.prototype.showInviteDialog=function(e){e.preventDefault();e=c.team.app_url+this.options.api.inviteDialog;c.get(e,function(e){c.waDialog({html:e})})},Sidebar.prototype.showGroupDialog=function(e){e.preventDefault();const t=this,i=c(e.target).hasClass(t.options.classes.initGroupDialog)?"group":"location";var a;t.groupDialog[i]?t.groupDialog[i].show():(e=c.team.app_url+t.options.api.group,a={type:i},c.get(e,a,function(e){t.groupDialog[i]=c.waDialog({html:e,onOpen(e,t){t.$content.find(".js-edit-group-name").focus()},onClose(e){return e.hide(),!1}})}))},Sidebar.prototype.setCounts=function(){const l=this,d=function(){let a={};const e=l.$wrapper.find("li .js-count"),n=function(){var e=new Date,t=parseInt(e.getUTCDate()),i=parseInt(e.getUTCMonth())+1,a=parseInt(e.getUTCFullYear()),n=parseInt(e.getUTCHours()),o=parseInt(e.getUTCMinutes()),e=parseInt(e.getUTCSeconds());return result={year:a,month:i,day:t,hours:n,minutes:o,seconds:e}}();return e.each(function(){var e=c(this),t=parseInt(e.text()),i=e.closest("li").find("> a");0<=t&&(l.options.counters[i.attr("href")]=e,a[i.attr("href")]={count:t,date:n})}),a}();var e=function(e){let t={};e=localStorage.getItem(e);e&&(t=JSON.parse(e));return t}(l.options.storage_count_name);l.options.storageCount=c.extend(!0,{},d),e&&c.each(e,function(e,t){var i=e in d&&0<=d[e].count&&d[e].count!==t.count;if(0<=t.count&&i){l.options.storageCount[e].count=t.count,l.options.storageCount[e].date=t.date;var a=e,n=d[e].count,i=t.count,o=t.date,e=0<=a.indexOf(l.options.app_url),t=l.$wrapper.find(`a[href="${a}"]`);if(e&&t.length){e=n-i;if(!(e<0)){const s=c(`<strong class="highlighted small js-sidebar-counter" style="height: fit-content;">+ ${e}</strong>`),r=t.find(".js-sidebar-counter");r.length?r.text("+ "+e):t.append(s),t.one("click",function(e){e.preventDefault(),s.remove(),l.saveCount(a,n),l.options.link_count_update_date=o,c(document).one("wa_loaded",function(){l.options.link_count_update_date=!1})})}}}}),l.setStorage()},Sidebar.prototype.saveCount=function(e,t){e in this.options.storageCount&&(this.options.storageCount[e].count=t),this.setStorage()},Sidebar.prototype.updateCount=function(e,t){var i;e&&(t||0===t)&&(i=this.options.counters[e]||!1,this.saveCount(e,t),i.length?i.text(t):this.reload())},Sidebar.prototype.setStorage=function(){localStorage.setItem(this.options.storage_count_name,JSON.stringify(this.options.storageCount))},Sidebar.prototype.initUpdater=function(){const e=this;var t=e.options.updateTime;e.options.timer=setTimeout(function(){c.contains(document,e.$body[0])&&e.reload(!0)},t)},Sidebar.prototype.initSortable=function(){const t=this,a=c.team.app_url+t.options.api.sort;let i=!1;function n(e){const t=[];return e.find("> li").each(function(){var e=c(this).data("group-id");e&&0<e&&t.push(e)}),t}function o(e,t){i&&(i.abort(),i=!1),i=c.post(e,t,function(){i=!1})}1<t.$groups.length&&t.$groupsWrapper.sortable({animation:150,handle:"."+t.options.classes.drop,direction:"vertical",onEnd(e){if(e.oldIndex!==e.newIndex){e=n(t.$groupsWrapper);const i=[];c.each(e,function(e,t){i.push({name:"groups[]",value:t})}),o(a,i)}}}),1<t.$locations.length&&t.$locationsWrapper.sortable({animation:150,handle:"."+t.options.classes.drop,direction:"vertical",onEnd(e){e.oldIndex!==e.newIndex&&(e=n(t.$locationsWrapper),o(a,{locations:e}))}})},Sidebar.prototype.initDroppable=function(){const a=this;let n=!1;function o(e,t){var e=parseInt(e.data("group-id")),t=parseInt(t.data("user-id")),i=c.team.app_url+a.options.api.moveUser;0<e&&0<t&&(t={user_id:t,group_id:e},n&&n.abort(),n=c.post(i,t,function(e){n=!1,"ok"!==e.status?console.warn(e):c.team.sidebar.reload()}))}a.$groups.each(function(){const i=c(this);i.hasClass(a.options.classes.drop)&&i.droppable({tolerance:"pointer",hoverClass:a.options.classes.highlighted,over:function(e,t){t.draggable.hasClass(a.options.classes.uiDraggable)||i.removeClass(a.options.classes.highlighted)},drop:function(e,t){o(c(this),t.draggable)}})}),a.$locations.each(function(){const i=c(this);i.hasClass(a.options.classes.drop)&&i.droppable({tolerance:"pointer",hoverClass:a.options.classes.highlighted,over:function(e,t){t.draggable.hasClass(a.options.classes.uiDraggable)||i.removeClass(a.options.classes.highlighted)},drop:function(e,t){o(c(this),t.draggable)}})})},Sidebar.prototype.showSearch=function(e){e.preventDefault();var e=c(e.target).find(".t-search-field").val();e&&(e=encodeURIComponent(e),e=c.team.app_url+`search/${e}/`,c.team.content.load(e),this.$wrapper.find(".sidebar-mobile-toggle").trigger("click"))},Sidebar.prototype.setSelected=function(e){var t=this;let i;switch(e.type){case"invited":i=t.$body.find("[data-invited-item]");break;case"inactive":i=t.$body.find("[data-inactive-item]");break;case"no-access":i=t.$body.find("[data-no-access-item]");break;case"search":i=t.$body.find("#all-users-sidebar-link");break;case"group":i=t.$body.find(`[data-group-id="${e.groupId}"]`)}t.setItem(c(i))},Sidebar}(jQuery);class SwiperSlider{constructor(e){this.container=e.selector||".swiper-container",this.containerParent=document.querySelector(this.container).closest("#t-access-page"),this.params=e.params||{},this.params.on=e.params.on||{},this.events=e.events||{},this.calculate_group_size=e.calculateGroupSize||!1,this.watch_nav=e.watchNav||!1,this.set_container_width=e.setContainerWidth||!1,this.swiper={},this.init()}init(){const t=this;t.params.on.beforeInit=function(e){t.calculate_group_size&&(e.params.slidesPerGroup=t.calculateGroupSize(e),e.params.slidesPerView=t.calculateGroupSize(e)),t.set_container_width&&t.setContainerWidth(e)},t.swiper=new Swiper(t.container,t.params),t.bindEvents(),t.watch_nav&&t.showNavigation(),t.set_container_width&&t.setContainerWidth(t.swiper)}setContainerWidth(i){const e=this;i.onAny(()=>{e.set_container_width.forEach(e=>{var t=document.body.clientWidth;t<=e?i.$el.css("width",t+"px"):i.$el.css("width","")})})}showNavigation(){const t=this,i=t.swiper.navigation.prevEl,a=t.swiper.navigation.nextEl;t.containerParent&&t.swiper.on("slideChange sliderMove",function(e){e.isEnd?(t.containerParent.classList.add("reachend"),a.children[0].classList.add("hidden")):e.isBeginning?(t.containerParent.classList.add("reachstart"),i.children[0].classList.add("hidden")):(t.containerParent.classList.remove("reachend"),t.containerParent.classList.remove("reachstart"),a.children[0].classList.remove("hidden"),i.children[0].classList.remove("hidden"))}),i&&a&&(i.classList.toggle("hidden",t.swiper.isLocked),a.classList.toggle("hidden",t.swiper.isLocked),t.swiper.on("lock unlock",()=>{i.classList.toggle("hidden",t.swiper.isLocked),a.classList.toggle("hidden",t.swiper.isLocked)}))}calculateGroupSize(e){var t=e.params.slidesOffsetBefore||0,i=e.params.slidesOffsetAfter||0,t=e.el.clientWidth-t-i,i=e.wrapperEl.querySelector("."+e.params.slideClass).clientWidth;return Math.round(t/i)}bindEvents(){for(var e in this.events)this.events.hasOwnProperty(e)&&this.swiper.on(e,this.events[e])}}!function(r){r.team={app_url:!1,content:!1,sidebar:!1,calendar:!1,profile:!1,title_pattern:"Team — %s",init:function(t){"is_debug|app_url|locales".split("|").forEach(function(e){r.team[e]=t[e]}),r(document).ajaxSend(function(e,t,i){var a;i.crossDomain||"POST"!==(i.type||"").toUpperCase()||(a=(a=document.cookie.match(new RegExp("(?:^|; )_csrf=([^;]*)")))?decodeURIComponent(a[1]):"",i.data=i.data||"","string"==typeof i.data?-1==i.data.indexOf("_csrf=")&&(i.data+=(0<i.data.length?"&":"")+"_csrf="+a,t.setRequestHeader("Content-type","application/x-www-form-urlencoded")):"object"==typeof i.data&&(i.data._csrf=a))}),r.team.content=new ContentRouter({$content:r("#t-content")}),r.team.setSync()},setTitle:function(e){var t;e&&((t=history.state)&&(t.title=e),document.title=r.team.title_pattern.replace("%s",e))},confirmContactDelete:function(e,s){r.post("?module=users&action=prepareDelete",{id:e},function(e){r.waDialog({html:e,onOpen(i,a){const n=i.data("allowed-ids"),o=i.find(".js-delete-button");a.$document.trigger("wa_confirm_contact_delete_dialog"),n&&o.on("click",function(){let e=o.text();var t=i.find('[name="delete_forever"]:checked').attr("value");o.attr("disabled",!0).html(e+' <i class="fas fa-spin fa-spinner wa-animation-spin speed-1000"></i>'),r.post("?module=users&action=delete",{delete_forever:t,id:n},function(){a.close(),r.team.sidebar.reload(),s?r.team.content.reload():r.team.content.load(r.team.app_url)}).always(function(){o.attr("disabled",!1).html(e)})})}})})},setSync:function(){var t=3e4+3e4*(Math.floor(100*Math.random())/100);setTimeout(function e(){r.post(r.team.app_url+"?module=calendarExternal&action=sync&background_process=1").always(function(){setTimeout(e,t)}).error(function(){return!1})},r.team.is_debug?100:t/2)},notification(e){var t,i=e.appendTo||document.body,a=e.isCloseable??!0,n=e.alertTimeout||!1;let o=i.querySelector("#t-notifications");const s=document.createElement("div");s.classList.add("alert",e.alertClass||"info"),s.innerHTML=e.alertContent||"",a&&(a=e.alertCloseClass||"js-alert-error-close",(t=document.createElement("a")).classList.add("alert-close",a),t.setAttribute("href","javascript:void(0)"),t.innerHTML='<i class="fas fa-times"></i>',s.insertAdjacentElement("afterbegin",t),t.addEventListener("click",function(){this.closest(".alert").remove()})),o||((o=document.createElement("div")).className="alert-fixed-box",e.alertPlacement&&o.classList.add(e.alertPlacement),e.alertSize&&o.classList.add(e.alertSize),o.id="t-notifications",i.append(o)),e.alertPlacement?o.prepend(s):o.append(s),n&&setTimeout(()=>s.remove(),n)}}}(jQuery);var ContentRouter=function(n){return(ContentRouter=function(e){var t=this;t.$window=n(window),t.$content=e.$content,t.$app=n("#wa-app"),t.api_enabled=window.history&&window.history.pushState,t.scrollTop=e.scrollTop||!0,t.xhr=!1,t.is_enabled=!0,t.waLoading=n.waLoading(),t.initClass()}).prototype.initClass=function(){this.bindEvents()},ContentRouter.prototype.bindEvents=function(){var i=this,a=window.location.origin+n.team.app_url;i.$app.on("click","a",function(e){var t;n(this)[0].hasAttribute("data-disable-routing")||(t=i.is_enabled&&this.href.substr(0,a.length)==a,e.ctrlKey)||e.shiftKey||e.metaKey||t&&(e.preventDefault(),i.load(this.href))}),n("#wa-app-team").on("click","a",function(e){e.stopPropagation()}),i.api_enabled&&(window.onpopstate=function(e){e.stopPropagation(),i.onPopState(e)})},ContentRouter.prototype.load=function(t,i){var a=this;if(!(0<=t.indexOf(n.team.app_url)))return alert("Determine the path error"),!1;a.xhr&&a.xhr.abort(),n(document).trigger("wa_before_load",{content_uri:t}),a.animate(!0),a.xhr=n.get(t,function(e){!i&&a.api_enabled&&history.pushState({reload:!0,content_uri:t},"",t),a.setContent(e),a.animate(!1),a.xhr=!1,n(document).trigger("wa_loaded")})},ContentRouter.prototype.reload=function(e){let t=!!(this.api_enabled&&history.state&&history.state?.content_uri)&&history.state.content_uri;((t=e?location.href:t)||e)&&this.load(t,!0)},ContentRouter.prototype.setContent=function(e){this.$content.html(e),this.scrollTop&&window.scrollTo(0,0)},ContentRouter.prototype.onPopState=function(e){e=e.state||!1;if(e){if(!e.content_uri)return alert("Determine the path error"),!1;n(document).trigger("wa_before_load",{content_uri:e.content_uri}),e.reload?this.reload(e.content_uri):e.content&&this.setContent(e.content),e.title&&n.team.setTitle(e.title),n.team.sidebar.selectLink(e.content_uri),n(document).trigger("wa_loaded")}else location.reload()},ContentRouter.prototype.animate=function(e){e?this.waLoading.animate(3e3,96,!1):this.waLoading.done()},ContentRouter}(jQuery),TeamDialog=function(r){return(TeamDialog=function(e){var t=this;t.$wrapper=r(e.html),t.$block=!1,t.is_full_screen=t.$wrapper.hasClass("is-full-screen"),t.is_full_screen&&(t.$block=t.$wrapper.find(".t-dialog-block")),t.position=e.position||!1,t.is_closed=!1,t.userPosition=e.setPosition||!1,t.onBgClick=e.onBgClick||!1,t.onOpen=e.onOpen||function(){},t.onClose=e.onClose||function(){},t.onRefresh=e.onRefresh||!1,t.onResize=e.onResize||!1,t.initClass()}).prototype.initClass=function(){this.$wrapper.data("teamDialog",this),this.show(),this.bindEvents()},TeamDialog.prototype.bindEvents=function(){var i=this,t=r(document),a=i.$block||i.$wrapper;setTimeout(function(){function e(){i.is_closed||i.close(),t.off("click",e),t.off("wa_before_load",e)}t.on("click",e),t.on("wa_before_load",e),i.$wrapper.on("close",e),i.is_full_screen&&i.$wrapper.on("click",".t-dialog-background",function(e){i.onBgClick?i.onBgClick(e):e.stopPropagation()}),a.on("click",function(e){e.stopPropagation()}),r(document).on("keyup",function(e){27===e.keyCode&&i.close()}),a.on("click",".js-close-dialog",function(){e()}),i.is_full_screen&&r(window).on("resize",function e(){var t=r.contains(document,i.$wrapper[0]);t?i.resize():r(window).off("resize",e)})},0)},TeamDialog.prototype.show=function(){var e=this;r("body").append(e.$wrapper),e.setPosition(),e.onOpen(e.$wrapper,e)},TeamDialog.prototype.setPosition=function(){var e,t=this,i=r(window),a=i.width(),n=(t.is_full_screen?i:r(document)).height(),i=t.$block||t.$wrapper,o=i.outerWidth(),s=i.outerHeight();0<(e=t.position||(t.userPosition||function(e){return{left:parseInt((a-e.width)/2),top:parseInt((n-e.height)/2)}})({width:o,height:s})).left&&e.left+o>a&&(e.left=a-o-10),0<e.top?e.top+s>n&&(e.top=n-s-10):(e.top=10,t.is_full_screen&&((o=i.find(".t-dialog-content")).hide(),s=i.outerHeight(),o.height(n-s-20).addClass("is-long-content").show())),i.css(e)},TeamDialog.prototype.close=function(){var e=this;e.is_closed=!0,e.$wrapper.remove(),e.onClose(e.$wrapper,e)},TeamDialog.prototype.refresh=function(){this.onRefresh&&(this.onRefresh(),this.close())},TeamDialog.prototype.resize=function(){var e=this;e.$block.addClass("is-animated"),e.setPosition(),e.onResize&&e.onResize(e.$wrapper,e)},TeamDialog}(jQuery),TeamEditable=function(a){return(TeamEditable=function(e,t){this.$wrapper=e,this.options=t,this.initClass()}).prototype.initClass=function(){this.bindEvents()},TeamEditable.prototype.bindEvents=function(){var e=this;e.$wrapper.on("keydown",a.proxy(e.checkPressEnter,e)),e.$wrapper.on("focus",a.proxy(e.enableEditor,e)),e.$wrapper.on("blur",a.proxy(e.disableEditor,e)),e.$wrapper.on("paste",a.proxy(e.clearHtml,e))},TeamEditable.prototype.checkPressEnter=function(e){13===e.keyCode&&(e.preventDefault(),this.$wrapper.blur())},TeamEditable.prototype.cacheText=function(){this.cachedText=this.$wrapper.text()},TeamEditable.prototype.enableEditor=function(){this.cacheText(),this.$wrapper.addClass("editable-highlight")},TeamEditable.prototype.disableEditor=function(){this.$wrapper.removeClass("editable-highlight"),this.$wrapper.text()!==this.cachedText&&this.save()},TeamEditable.prototype.clearHtml=function(e){e.preventDefault();let t=e.originalEvent.clipboardData.getData("text/plain");t=t.replace(/<[^>]*>?/gm,""),document.queryCommandSupported("insertText")?document.execCommand("insertText",!1,t):document.execCommand("paste",!1,t)},TeamEditable.prototype.save=function(){const e=this;var t={"data[id]":e.options.groupId,[e.options.target]:e.$wrapper.text()};const i=a('<span class="smaller text-gray custom-ml-4"><i class="fas fa-spin fa-spinner wa-animation-spin speed-1000"></i></span>');e.$wrapper.append(i),a.post(e.options.api.save,t,function(){i.remove(),e.options.reloadSidebar&&a.team.sidebar.reload()})},TeamEditable}($),UserList=function(o){return(UserList=function(e){var t=this;t.$wrapper=e.$wrapper,t.$items=t.$wrapper.find(".t-user-wrapper"),t.$draggableItems=t.$wrapper.find(".js-move-user"),t.initClass()}).prototype.initClass=function(){this.initHightlight(),this.initDraggable()},UserList.prototype.initDraggable=function(){let a;const n="t-drop-here";o(".js-move-user").mousedown(function(){document.activeElement.blur()}),this.$draggableItems.draggable({helper:"clone",delay:200,handle:".userpic, .details",appendTo:document.body,start:function(e,t){t.helper.addClass("is-clone align-center list").find(" > *:not(.userpic, .image)").addClass("hidden").end().find(" > a").css({border:"0.1875rem solid var(--thumbs-highlighted-color)","border-radius":"50%",display:"inline-block"}),(a=o.team.sidebar.$wrapper.find(".js-drop-block"))&&a.addClass(n)},stop:function(e,t){t=t.helper;const i=t.clone();i.insertAfter(t).fadeOut(270),setTimeout(function(){i.remove()},300),a&&a.removeClass(n)}})},UserList.prototype.initHightlight=function(){let a=o.team.sidebar.options.link_count_update_date;function n(e){return new Date(e.year,e.month-1,e.day,e.hours,e.minutes,e.seconds)}a&&(a=n(a),this.$items.each(function(){var e,t=o(this),i=t.data("update-datetime");i&&i.length&&n((i=(i=i).split(" "),e=i[0].split("-"),i=i[1].split(":"),{year:parseInt(e[0]),month:parseInt(e[1]),day:parseInt(e[2]),hours:parseInt(i[0]),minutes:parseInt(i[1]),seconds:parseInt(i[2])}))>a&&t.find(".userpic").addClass("t-users-avatar-highlight")}))},UserList}(jQuery);
//# sourceMappingURL=team.min.js.map
